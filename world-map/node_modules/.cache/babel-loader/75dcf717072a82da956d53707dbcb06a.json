{"ast":null,"code":"import { findMidPointOfPolygon, Rect, filter, getTemplateFunction, getZoomTranslate, getTranslate, RectOption, convertElementFromLabel, Point, TextOption, renderTextElement, textTrim, measureText, Internalize } from '../utils/helper';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { dataLabelRendering } from '../model/constants';\n/**\n * DataLabel Module used to render the maps datalabel\n */\n\nvar DataLabel =\n/** @class */\nfunction () {\n  function DataLabel(maps) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    this.value = {\n      rightWidth: 0,\n      leftWidth: 0,\n      heightTop: 0,\n      heightBottom: 0\n    };\n    this.maps = maps;\n    this.dataLabelCollections = [];\n  } // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  DataLabel.prototype.getDataLabel = function (dataSource, labelPath, shapeName, shapeDataPath) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    var text;\n    var shapeNameValue;\n\n    for (var i = 0; i < dataSource.length; i++) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      var data = dataSource[i];\n      var dataShapePathValue = !isNullOrUndefined(data[shapeDataPath]) && isNaN(data[shapeDataPath]) ? data[shapeDataPath].toLowerCase() : data[shapeDataPath];\n      shapeName = !isNullOrUndefined(shapeName) ? shapeName.toString() : shapeName;\n      shapeNameValue = !isNullOrUndefined(shapeName) ? shapeName.toLowerCase() : shapeName;\n\n      if (dataShapePathValue === shapeNameValue) {\n        text = data;\n        break;\n      }\n    }\n\n    return text;\n  };\n  /**\n   * To render label for maps\n   *\n   * @param {LayerSettings} layer - Specifies the layer settings\n   * @param {number} layerIndex - Specifies the layer index.\n   * @param {any} shape - Specifies the shape.\n   * @param {any[]} layerData - Specifies the layer data.\n   * @param {Element} group Specifies the element.\n   * @param {HTMLElement} labelTemplateElement - Specifies the template element.\n   * @param {number} index - Specifies the index number.\n   * @param {any[]} intersect - Specifies the intersect.\n   * @returns {void}\n   */\n\n\n  DataLabel.prototype.renderLabel = function ( // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  layer, layerIndex, shape, // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  layerData, group, labelTemplateElement, index, intersect) {\n    var _this = this;\n\n    var dataLabel = layer.dataLabelSettings;\n    var style = layer.dataLabelSettings.textStyle;\n    var markerEle; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var templateFn;\n    var options;\n    var dataLabelSettings = layer.dataLabelSettings;\n    var labelpath = layer.dataLabelSettings.labelPath;\n    var shapePoint = [[]];\n    var midIndex = 0;\n    var pointsLength = 0; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var shapeData = shape;\n    var element; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var data;\n    var text = ''; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var datasrcObj;\n    var currentLength = 0;\n    var oldIndex; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var location;\n    var sublayerIndexLabel = false; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var shapeProperties = shape['properties'];\n    var labelId = this.maps.element.id + '_LayerIndex_' + layerIndex + '_shapeIndex_' + index + '_LabelIndex_' + index;\n    var textLocation = new Point(0, 0); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var shapes = layerData[index];\n    var locationX;\n    var locationY;\n    style.fontFamily = this.maps.theme.toLowerCase() !== 'material' ? this.maps.themeStyle.labelFontFamily : style.fontFamily;\n    shape = shapes['property'];\n    var properties = Object.prototype.toString.call(layer.shapePropertyPath) === '[object Array]' ? layer.shapePropertyPath : [layer.shapePropertyPath];\n    var propertyPath;\n    var isPoint = false;\n    var animate = layer.animationDuration !== 0 || isNullOrUndefined(this.maps.zoomModule); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var translate = this.maps.isTileMap ? new Object() : this.maps.zoomSettings.zoomFactor > 1 && !isNullOrUndefined(this.maps.zoomModule) ? getZoomTranslate(this.maps, layer, animate) : getTranslate(this.maps, layer, animate);\n    var scale = this.maps.isTileMap ? this.maps.scale : translate['scale'];\n    var transPoint = this.maps.isTileMap ? this.maps.translatePoint : translate['location'];\n    var zoomTransPoint = this.maps.zoomTranslatePoint;\n    var shapeWidth;\n    var scaleZoomValue = !isNullOrUndefined(this.maps.scale) ? Math.floor(this.maps.scale) : 1;\n    var zoomLabelsPosition = this.maps.zoomSettings.enable ? !isNullOrUndefined(this.maps.zoomShapeCollection) && this.maps.zoomShapeCollection.length > 0 : this.maps.zoomSettings.enable;\n    this.maps.translateType = 'labels';\n\n    for (var j = 0; j < properties.length; j++) {\n      if (shapeProperties[properties[j]]) {\n        propertyPath = properties[j];\n        datasrcObj = this.getDataLabel( // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        layer.dataSource, layer.shapeDataPath, shapeData['properties'][propertyPath], layer.shapeDataPath);\n\n        if (datasrcObj) {\n          break;\n        }\n      }\n    }\n\n    datasrcObj = this.getDataLabel( // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    layer.dataSource, layer.shapeDataPath, shapeData['properties'][propertyPath], layer.shapeDataPath);\n\n    if (!isNullOrUndefined(shapes['property'])) {\n      shapePoint = [[]];\n\n      if (!layerData[index]['_isMultiPolygon'] && layerData[index]['type'] !== 'Point') {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        shapePoint.push(this.getPoint(layerData[index], []));\n        currentLength = shapePoint[shapePoint.length - 1].length;\n\n        if (pointsLength < currentLength) {\n          pointsLength = currentLength;\n          midIndex = shapePoint.length - 1;\n        }\n      } else {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var layer_1 = layerData[index];\n\n        if (layer_1['type'] === 'Point') {\n          isPoint = true; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n          var layerPoints = [];\n          layerPoints.push(this.getPoint(layerData, []));\n          shapePoint = layerPoints;\n          currentLength = shapePoint[shapePoint.length - 1].length;\n\n          if (pointsLength < currentLength) {\n            pointsLength = currentLength;\n            midIndex = shapePoint.length - 1;\n          }\n        }\n\n        for (var j = 0; j < layer_1.length; j++) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          shapePoint.push(this.getPoint(layer_1[j], []));\n          currentLength = shapePoint[shapePoint.length - 1].length;\n\n          if (pointsLength < currentLength) {\n            pointsLength = currentLength;\n            midIndex = shapePoint.length - 1;\n          }\n        }\n      }\n    }\n\n    text = !isNullOrUndefined(datasrcObj) ? !isNullOrUndefined(datasrcObj[labelpath]) ? datasrcObj[labelpath].toString() : datasrcObj[layer.shapeDataPath] : shapeData['properties'][labelpath];\n\n    if (Object.prototype.toString.call(layer.shapePropertyPath) === '[object Array]' && isNullOrUndefined(text) && layer.dataSource['length'] === 0) {\n      for (var l = 0; l < layer.shapePropertyPath.length; l++) {\n        if (shapeData['properties'][layer.shapePropertyPath[l]]) {\n          text = shapeData['properties'][layer.shapePropertyPath[l]];\n          break;\n        }\n      }\n    }\n\n    if (isNullOrUndefined(text) && layer.dataLabelSettings.template !== '' && layer.dataSource['length'] === 0) {\n      text = shapeData['properties'][layer.shapePropertyPath];\n    }\n\n    var dataLabelText = text;\n    var projectionType = this.maps.projectionType;\n\n    if (isPoint) {\n      location = {\n        x: shapePoint[midIndex][index]['x'],\n        y: shapePoint[midIndex][index]['y'],\n        rightMin: 0,\n        rightMax: 0,\n        leftMin: 0,\n        leftMax: 0,\n        points: shapePoint[midIndex][index],\n        topMax: 0,\n        topMin: 0,\n        bottomMax: 0,\n        bottomMin: 0,\n        height: 0\n      };\n    } else {\n      location = findMidPointOfPolygon(shapePoint[midIndex], projectionType, layer.geometryType);\n    } // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n    var firstLevelMapLocation = location;\n\n    if (!isNullOrUndefined(text) && !isNullOrUndefined(location)) {\n      if (zoomLabelsPosition && scaleZoomValue > 1 && !this.maps.zoomNotApplied && dataLabel.template === '') {\n        if (layerIndex > 0) {\n          for (var k = 0; k < this.maps.zoomLabelPositions.length; k++) {\n            if (this.maps.zoomLabelPositions[k]['dataLabelText'] === text) {\n              oldIndex = index;\n              index = k;\n              sublayerIndexLabel = true;\n              break;\n            }\n          }\n        }\n\n        locationX = location['x'];\n        locationY = location['y'];\n        location['x'] = (location['x'] + zoomTransPoint['x']) * scale;\n        location['y'] = (location['y'] + zoomTransPoint['y']) * scale;\n      }\n\n      location['y'] = this.maps.projectionType === 'Mercator' || layer.geometryType === 'Normal' ? location['y'] : -location['y'];\n      data = location;\n\n      if (!isNullOrUndefined(this.maps.format) && !isNaN(parseFloat(text))) {\n        if (this.maps.useGroupingSeparator) {\n          text = Internalize(this.maps, parseFloat(text));\n\n          if (!isNullOrUndefined(datasrcObj)) {\n            datasrcObj[labelpath] = text;\n          }\n        }\n      }\n\n      var eventargs_1 = {\n        name: dataLabelRendering,\n        maps: this.maps,\n        cancel: false,\n        border: {\n          color: dataLabel.border.color,\n          width: dataLabel.border.width,\n          opacity: dataLabel.border.opacity\n        },\n        datalabel: dataLabel,\n        fill: dataLabel.fill,\n        template: dataLabel.template,\n        text: text\n      };\n      this.maps.trigger('dataLabelRendering', eventargs_1, function (labelArgs) {\n        if (eventargs_1.cancel) {\n          return;\n        } // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n        var border = {\n          color: 'yellow'\n        };\n        var position = [];\n        var width = zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied && _this.maps.zoomShapeCollection.length > index ? _this.maps.zoomShapeCollection[index]['width'] : (location['rightMax']['x'] - location['leftMax']['x']) * scale;\n\n        if (!isNullOrUndefined(_this.maps.dataLabelShape)) {\n          shapeWidth = firstLevelMapLocation['rightMax']['x'] - firstLevelMapLocation['leftMax']['x'];\n\n          _this.maps.dataLabelShape.push(shapeWidth);\n        }\n\n        if (eventargs_1.text !== text && !eventargs_1.cancel) {\n          text = eventargs_1.text;\n        }\n\n        var textSize = measureText(text, style);\n        var trimmedLable = text;\n        var elementSize = textSize;\n        var startY = location['y'] - textSize['height'] / 4;\n        var endY = location['y'] + textSize['height'] / 4;\n        var start = (location['y'] + transPoint['y']) * scale - textSize['height'] / 4;\n        var end = (location['y'] + transPoint['y']) * scale + textSize['height'] / 4;\n        position = filter(shapePoint[midIndex], startY, endY);\n\n        if (!isPoint && position.length > 5 && shapeData['geometry']['type'] !== 'MultiPolygon' && shapeData['type'] !== 'MultiPolygon') {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          var location1 = findMidPointOfPolygon(position, projectionType, layer.geometryType);\n\n          if (zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied && eventargs_1.template === '') {\n            location1['x'] = (_this.maps.zoomLabelPositions[index]['location']['x'] + zoomTransPoint['x']) * scale;\n            location1['y'] = (_this.maps.zoomLabelPositions[index]['location']['y'] + zoomTransPoint['y']) * scale;\n          }\n\n          locationX = location1['x'];\n          location['x'] = location1['x'];\n          width = zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied && _this.maps.zoomShapeCollection.length > index ? _this.maps.zoomShapeCollection[index]['width'] : (location1['rightMax']['x'] - location1['leftMax']['x']) * scale;\n        }\n\n        var xpositionEnds = (location['x'] + transPoint['x']) * scale + textSize['width'] / 2;\n        var xpositionStart = (location['x'] + transPoint['x']) * scale - textSize['width'] / 2;\n        _this.value[index] = {\n          rightWidth: xpositionEnds,\n          leftWidth: xpositionStart,\n          heightTop: start,\n          heightBottom: end\n        };\n        var labelElement;\n\n        if (eventargs_1.template !== '') {\n          templateFn = getTemplateFunction(eventargs_1.template);\n          var templateElement = templateFn ? templateFn(!isNullOrUndefined(datasrcObj) ? datasrcObj : shapeData['properties'], _this.maps, eventargs_1.template, _this.maps.element.id + '_LabelTemplate', false) : document.createElement('div');\n          templateElement.innerHTML = !templateFn ? eventargs_1.template : '';\n          labelElement = convertElementFromLabel(templateElement, labelId, !isNullOrUndefined(datasrcObj) ? datasrcObj : shapeData['properties'], index, _this.maps);\n          labelElement.style.left = Math.abs(_this.maps.baseMapRectBounds['min']['x'] - location['x']) * scale + 'px';\n          labelElement.style.top = Math.abs(_this.maps.baseMapRectBounds['min']['y'] - location['y']) * scale + 'px';\n          labelTemplateElement.appendChild(labelElement);\n        } else {\n          if (dataLabelSettings.smartLabelMode === 'Trim') {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var textType = typeof text === 'number' ? text.toString() : text;\n            trimmedLable = textTrim(width, textType, style);\n            elementSize = measureText(trimmedLable, style);\n            options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', trimmedLable, '', '');\n          }\n\n          if (dataLabelSettings.smartLabelMode === 'None') {\n            options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', text, '', '');\n          }\n\n          if (dataLabelSettings.smartLabelMode === 'Hide') {\n            text = width >= textSize['width'] ? text : '';\n            options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', text, '', '');\n          }\n\n          text = options['text'];\n\n          if (dataLabelSettings.intersectionAction === 'Hide') {\n            for (var i = 0; i < intersect.length; i++) {\n              if (!isNullOrUndefined(intersect[i])) {\n                if (!(_this.value[index]['leftWidth'] > intersect[i]['rightWidth'] || _this.value[index]['rightWidth'] < intersect[i]['leftWidth'] || _this.value[index]['heightTop'] > intersect[i]['heightBottom'] || _this.value[index]['heightBottom'] < intersect[i]['heightTop'])) {\n                  text = '';\n                  break;\n                }\n              }\n            }\n\n            intersect.push(_this.value[index]);\n            options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', text, '', '');\n          }\n\n          var difference = void 0;\n\n          if (dataLabelSettings.intersectionAction === 'Trim') {\n            for (var j = 0; j < intersect.length; j++) {\n              if (!isNullOrUndefined(intersect[j])) {\n                if (intersect[j]['rightWidth'] < _this.value[index]['leftWidth'] || intersect[j]['leftWidth'] > _this.value[index]['rightWidth'] || intersect[j]['heightBottom'] < _this.value[index]['heightTop'] || intersect[j]['heightTop'] > _this.value[index]['heightBottom']) {\n                  trimmedLable = text;\n                  difference = 0;\n                } else {\n                  if (_this.value[index]['leftWidth'] > intersect[j]['leftWidth']) {\n                    width = intersect[j]['rightWidth'] - _this.value[index]['leftWidth'];\n                    difference = width - (_this.value[index]['rightWidth'] - _this.value[index]['leftWidth']);\n                    trimmedLable = textTrim(difference, text, style);\n                    break;\n                  }\n\n                  if (_this.value[index]['leftWidth'] < intersect[j]['leftWidth']) {\n                    width = _this.value[index]['rightWidth'] - intersect[j]['leftWidth'];\n                    difference = Math.abs(width - (_this.value[index]['rightWidth'] - _this.value[index]['leftWidth']));\n                    trimmedLable = textTrim(difference, text, style);\n                    break;\n                  }\n                }\n              }\n            }\n\n            elementSize = measureText(trimmedLable, style);\n            intersect.push(_this.value[index]);\n            options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', trimmedLable, '', '');\n          }\n\n          if (dataLabelSettings.intersectionAction === 'None') {\n            options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', text, '', '');\n          }\n\n          if (trimmedLable.length > 1) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var border_1 = eventargs_1.border;\n\n            if (border_1['width'] > 1) {\n              var fill = eventargs_1.fill;\n              var opacity = dataLabelSettings.opacity;\n              var rx = dataLabelSettings.rx;\n              var ry = dataLabelSettings.ry;\n              var x = void 0;\n              var y = void 0;\n              var padding = 5;\n\n              if (zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied) {\n                x = location['x'] - textSize['width'] / 2;\n                y = location['y'] - textSize['height'] / 2 - padding;\n              } else {\n                x = (location['x'] + transPoint['x']) * scale - textSize['width'] / 2;\n                y = (location['y'] + transPoint['y']) * scale - textSize['height'] / 2;\n              }\n\n              border_1.opacity = isNullOrUndefined(border_1.opacity) ? opacity : border_1.opacity;\n              var rectOptions = new RectOption(_this.maps.element.id + '_LayerIndex_' + layerIndex + '_shapeIndex_' + index + '_rectIndex_' + index, fill, border_1, opacity, new Rect(x, y, textSize['width'], textSize['height']), rx, ry);\n\n              var rect = _this.maps.renderer.drawRectangle(rectOptions);\n\n              group.appendChild(rect);\n            }\n          }\n\n          element = renderTextElement(options, style, style.color || _this.maps.themeStyle.dataLabelFontColor, group);\n\n          if (zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied) {\n            element.setAttribute('transform', 'translate( ' + location['x'] + ' ' + location['y'] + ' )');\n            location['x'] = locationX;\n            location['y'] = locationY;\n          } else {\n            element.setAttribute('transform', 'translate( ' + (location['x'] + transPoint.x) * scale + ' ' + ((location['y'] + transPoint.y) * scale + elementSize.height / 4) + ' )');\n          }\n\n          group.appendChild(element);\n        }\n\n        _this.dataLabelCollections.push({\n          location: {\n            x: location['x'],\n            y: location['y']\n          },\n          element: isNullOrUndefined(labelElement) ? element : labelElement,\n          layerIndex: layerIndex,\n          shapeIndex: sublayerIndexLabel ? oldIndex : index,\n          labelIndex: sublayerIndexLabel ? oldIndex : index,\n          dataLabelText: dataLabelText\n        });\n\n        if (labelTemplateElement.childElementCount > 0 && !_this.maps.element.contains(labelTemplateElement)) {\n          document.getElementById(_this.maps.element.id + '_Secondary_Element').appendChild(labelTemplateElement); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n          _this.maps.renderReactTemplates();\n        }\n      });\n    }\n  }; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  DataLabel.prototype.getPoint = function (shapes, points) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    shapes.map(function (current, index) {\n      points.push(new Point(current['point']['x'], current['point']['y']));\n    });\n    return points;\n  };\n  /**\n   * Get module name.\n   *\n   * @returns {string} - Returns the module name.\n   */\n\n\n  DataLabel.prototype.getModuleName = function () {\n    return 'DataLabel';\n  };\n  /**\n   * To destroy the layers.\n   *\n   * @param {Maps} maps - Specifies the instance of the maps.\n   * @returns {void}\n   * @private\n   */\n\n\n  DataLabel.prototype.destroy = function (maps) {\n    /**\n     * Destroy method performed here\n     */\n  };\n\n  return DataLabel;\n}();\n\nexport { DataLabel };","map":{"version":3,"sources":["C:/Users/vinay/Desktop/world-map-dashboard/world-map/node_modules/@syncfusion/ej2-maps/src/maps/layers/data-label.js"],"names":["findMidPointOfPolygon","Rect","filter","getTemplateFunction","getZoomTranslate","getTranslate","RectOption","convertElementFromLabel","Point","TextOption","renderTextElement","textTrim","measureText","Internalize","isNullOrUndefined","dataLabelRendering","DataLabel","maps","value","rightWidth","leftWidth","heightTop","heightBottom","dataLabelCollections","prototype","getDataLabel","dataSource","labelPath","shapeName","shapeDataPath","text","shapeNameValue","i","length","data","dataShapePathValue","isNaN","toLowerCase","toString","renderLabel","layer","layerIndex","shape","layerData","group","labelTemplateElement","index","intersect","_this","dataLabel","dataLabelSettings","style","textStyle","markerEle","templateFn","options","labelpath","shapePoint","midIndex","pointsLength","shapeData","element","datasrcObj","currentLength","oldIndex","location","sublayerIndexLabel","shapeProperties","labelId","id","textLocation","shapes","locationX","locationY","fontFamily","theme","themeStyle","labelFontFamily","properties","Object","call","shapePropertyPath","propertyPath","isPoint","animate","animationDuration","zoomModule","translate","isTileMap","zoomSettings","zoomFactor","scale","transPoint","translatePoint","zoomTransPoint","zoomTranslatePoint","shapeWidth","scaleZoomValue","Math","floor","zoomLabelsPosition","enable","zoomShapeCollection","translateType","j","push","getPoint","layer_1","layerPoints","l","template","dataLabelText","projectionType","x","y","rightMin","rightMax","leftMin","leftMax","points","topMax","topMin","bottomMax","bottomMin","height","geometryType","firstLevelMapLocation","zoomNotApplied","k","zoomLabelPositions","format","parseFloat","useGroupingSeparator","eventargs_1","name","cancel","border","color","width","opacity","datalabel","fill","trigger","labelArgs","position","dataLabelShape","textSize","trimmedLable","elementSize","startY","endY","start","end","location1","xpositionEnds","xpositionStart","labelElement","templateElement","document","createElement","innerHTML","left","abs","baseMapRectBounds","top","appendChild","smartLabelMode","textType","intersectionAction","difference","border_1","rx","ry","padding","rectOptions","rect","renderer","drawRectangle","dataLabelFontColor","setAttribute","shapeIndex","labelIndex","childElementCount","contains","getElementById","renderReactTemplates","map","current","getModuleName","destroy"],"mappings":"AAAA,SAASA,qBAAT,EAAgCC,IAAhC,EAAsCC,MAAtC,EAA8CC,mBAA9C,EAAmEC,gBAAnE,EAAqFC,YAArF,EAAmGC,UAAnG,EAA+GC,uBAA/G,EAAwIC,KAAxI,EAA+IC,UAA/I,EAA2JC,iBAA3J,EAA8KC,QAA9K,EAAwLC,WAAxL,EAAqMC,WAArM,QAAwN,iBAAxN;AACA,SAASC,iBAAT,QAAkC,sBAAlC;AACA,SAASC,kBAAT,QAAmC,oBAAnC;AACA;AACA;AACA;;AACA,IAAIC,SAAS;AAAG;AAAe,YAAY;AACvC,WAASA,SAAT,CAAmBC,IAAnB,EAAyB;AACrB;AACA,SAAKC,KAAL,GAAa;AAAEC,MAAAA,UAAU,EAAE,CAAd;AAAiBC,MAAAA,SAAS,EAAE,CAA5B;AAA+BC,MAAAA,SAAS,EAAE,CAA1C;AAA6CC,MAAAA,YAAY,EAAE;AAA3D,KAAb;AACA,SAAKL,IAAL,GAAYA,IAAZ;AACA,SAAKM,oBAAL,GAA4B,EAA5B;AACH,GANsC,CAOvC;;;AACAP,EAAAA,SAAS,CAACQ,SAAV,CAAoBC,YAApB,GAAmC,UAAUC,UAAV,EAAsBC,SAAtB,EAAiCC,SAAjC,EAA4CC,aAA5C,EAA2D;AAC1F;AACA,QAAIC,IAAJ;AACA,QAAIC,cAAJ;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGN,UAAU,CAACO,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AACxC;AACA,UAAIE,IAAI,GAAGR,UAAU,CAACM,CAAD,CAArB;AACA,UAAIG,kBAAkB,GAAG,CAACrB,iBAAiB,CAACoB,IAAI,CAACL,aAAD,CAAL,CAAlB,IAA2CO,KAAK,CAACF,IAAI,CAACL,aAAD,CAAL,CAAhD,GACrBK,IAAI,CAACL,aAAD,CAAJ,CAAoBQ,WAApB,EADqB,GACeH,IAAI,CAACL,aAAD,CAD5C;AAEAD,MAAAA,SAAS,GAAG,CAACd,iBAAiB,CAACc,SAAD,CAAlB,GAAgCA,SAAS,CAACU,QAAV,EAAhC,GAAuDV,SAAnE;AACAG,MAAAA,cAAc,GAAG,CAACjB,iBAAiB,CAACc,SAAD,CAAlB,GAAgCA,SAAS,CAACS,WAAV,EAAhC,GAA0DT,SAA3E;;AACA,UAAKO,kBAAD,KAAyBJ,cAA7B,EAA6C;AACzCD,QAAAA,IAAI,GAAGI,IAAP;AACA;AACH;AACJ;;AACD,WAAOJ,IAAP;AACH,GAjBD;AAkBA;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACId,EAAAA,SAAS,CAACQ,SAAV,CAAoBe,WAApB,GAAkC,WAClC;AACAC,EAAAA,KAFkC,EAE3BC,UAF2B,EAEfC,KAFe,EAGlC;AACAC,EAAAA,SAJkC,EAIvBC,KAJuB,EAIhBC,oBAJgB,EAIMC,KAJN,EAIaC,SAJb,EAIwB;AACtD,QAAIC,KAAK,GAAG,IAAZ;;AACA,QAAIC,SAAS,GAAGT,KAAK,CAACU,iBAAtB;AACA,QAAIC,KAAK,GAAGX,KAAK,CAACU,iBAAN,CAAwBE,SAApC;AACA,QAAIC,SAAJ,CAJsD,CAKtD;;AACA,QAAIC,UAAJ;AACA,QAAIC,OAAJ;AACA,QAAIL,iBAAiB,GAAGV,KAAK,CAACU,iBAA9B;AACA,QAAIM,SAAS,GAAGhB,KAAK,CAACU,iBAAN,CAAwBvB,SAAxC;AACA,QAAI8B,UAAU,GAAG,CAAC,EAAD,CAAjB;AACA,QAAIC,QAAQ,GAAG,CAAf;AACA,QAAIC,YAAY,GAAG,CAAnB,CAZsD,CAatD;;AACA,QAAIC,SAAS,GAAGlB,KAAhB;AACA,QAAImB,OAAJ,CAfsD,CAgBtD;;AACA,QAAI3B,IAAJ;AACA,QAAIJ,IAAI,GAAG,EAAX,CAlBsD,CAmBtD;;AACA,QAAIgC,UAAJ;AACA,QAAIC,aAAa,GAAG,CAApB;AACA,QAAIC,QAAJ,CAtBsD,CAuBtD;;AACA,QAAIC,QAAJ;AACA,QAAIC,kBAAkB,GAAG,KAAzB,CAzBsD,CA0BtD;;AACA,QAAIC,eAAe,GAAGzB,KAAK,CAAC,YAAD,CAA3B;AACA,QAAI0B,OAAO,GAAG,KAAKnD,IAAL,CAAU4C,OAAV,CAAkBQ,EAAlB,GAAuB,cAAvB,GAAwC5B,UAAxC,GAAqD,cAArD,GAAsEK,KAAtE,GAA8E,cAA9E,GAA+FA,KAA7G;AACA,QAAIwB,YAAY,GAAG,IAAI9D,KAAJ,CAAU,CAAV,EAAa,CAAb,CAAnB,CA7BsD,CA8BtD;;AACA,QAAI+D,MAAM,GAAG5B,SAAS,CAACG,KAAD,CAAtB;AACA,QAAI0B,SAAJ;AACA,QAAIC,SAAJ;AACAtB,IAAAA,KAAK,CAACuB,UAAN,GAAmB,KAAKzD,IAAL,CAAU0D,KAAV,CAAgBtC,WAAhB,OAAkC,UAAlC,GAA+C,KAAKpB,IAAL,CAAU2D,UAAV,CAAqBC,eAApE,GAAsF1B,KAAK,CAACuB,UAA/G;AACAhC,IAAAA,KAAK,GAAG6B,MAAM,CAAC,UAAD,CAAd;AACA,QAAIO,UAAU,GAAIC,MAAM,CAACvD,SAAP,CAAiBc,QAAjB,CAA0B0C,IAA1B,CAA+BxC,KAAK,CAACyC,iBAArC,MAA4D,gBAA5D,GACdzC,KAAK,CAACyC,iBADQ,GACY,CAACzC,KAAK,CAACyC,iBAAP,CAD9B;AAEA,QAAIC,YAAJ;AACA,QAAIC,OAAO,GAAG,KAAd;AACA,QAAIC,OAAO,GAAG5C,KAAK,CAAC6C,iBAAN,KAA4B,CAA5B,IAAiCvE,iBAAiB,CAAC,KAAKG,IAAL,CAAUqE,UAAX,CAAhE,CAxCsD,CAyCtD;;AACA,QAAIC,SAAS,GAAI,KAAKtE,IAAL,CAAUuE,SAAX,GAAwB,IAAIT,MAAJ,EAAxB,GAAyC,KAAK9D,IAAL,CAAUwE,YAAV,CAAuBC,UAAvB,GAAoC,CAApC,IACrD,CAAC5E,iBAAiB,CAAC,KAAKG,IAAL,CAAUqE,UAAX,CADkC,GACRlF,gBAAgB,CAAC,KAAKa,IAAN,EAAYuB,KAAZ,EAAmB4C,OAAnB,CADR,GAEpD/E,YAAY,CAAC,KAAKY,IAAN,EAAYuB,KAAZ,EAAmB4C,OAAnB,CAFhB;AAGA,QAAIO,KAAK,GAAI,KAAK1E,IAAL,CAAUuE,SAAX,GAAwB,KAAKvE,IAAL,CAAU0E,KAAlC,GAA0CJ,SAAS,CAAC,OAAD,CAA/D;AACA,QAAIK,UAAU,GAAI,KAAK3E,IAAL,CAAUuE,SAAX,GAAwB,KAAKvE,IAAL,CAAU4E,cAAlC,GAAmDN,SAAS,CAAC,UAAD,CAA7E;AACA,QAAIO,cAAc,GAAG,KAAK7E,IAAL,CAAU8E,kBAA/B;AACA,QAAIC,UAAJ;AACA,QAAIC,cAAc,GAAG,CAACnF,iBAAiB,CAAC,KAAKG,IAAL,CAAU0E,KAAX,CAAlB,GAAsCO,IAAI,CAACC,KAAL,CAAW,KAAKlF,IAAL,CAAU0E,KAArB,CAAtC,GAAoE,CAAzF;AACA,QAAIS,kBAAkB,GAAG,KAAKnF,IAAL,CAAUwE,YAAV,CAAuBY,MAAvB,GAAgC,CAACvF,iBAAiB,CAAC,KAAKG,IAAL,CAAUqF,mBAAX,CAAlB,IACrD,KAAKrF,IAAL,CAAUqF,mBAAV,CAA8BrE,MAA9B,GAAuC,CADlB,GACsB,KAAKhB,IAAL,CAAUwE,YAAV,CAAuBY,MADtE;AAEA,SAAKpF,IAAL,CAAUsF,aAAV,GAA0B,QAA1B;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG1B,UAAU,CAAC7C,MAA/B,EAAuCuE,CAAC,EAAxC,EAA4C;AACxC,UAAIrC,eAAe,CAACW,UAAU,CAAC0B,CAAD,CAAX,CAAnB,EAAoC;AAChCtB,QAAAA,YAAY,GAAGJ,UAAU,CAAC0B,CAAD,CAAzB;AACA1C,QAAAA,UAAU,GAAG,KAAKrC,YAAL,EACb;AACAe,QAAAA,KAAK,CAACd,UAFO,EAEKc,KAAK,CAACX,aAFX,EAE0B+B,SAAS,CAAC,YAAD,CAAT,CAAwBsB,YAAxB,CAF1B,EAEiE1C,KAAK,CAACX,aAFvE,CAAb;;AAGA,YAAIiC,UAAJ,EAAgB;AACZ;AACH;AACJ;AACJ;;AACDA,IAAAA,UAAU,GAAG,KAAKrC,YAAL,EACb;AACAe,IAAAA,KAAK,CAACd,UAFO,EAEKc,KAAK,CAACX,aAFX,EAE0B+B,SAAS,CAAC,YAAD,CAAT,CAAwBsB,YAAxB,CAF1B,EAEiE1C,KAAK,CAACX,aAFvE,CAAb;;AAGA,QAAI,CAACf,iBAAiB,CAACyD,MAAM,CAAC,UAAD,CAAP,CAAtB,EAA4C;AACxCd,MAAAA,UAAU,GAAG,CAAC,EAAD,CAAb;;AACA,UAAI,CAACd,SAAS,CAACG,KAAD,CAAT,CAAiB,iBAAjB,CAAD,IAAwCH,SAAS,CAACG,KAAD,CAAT,CAAiB,MAAjB,MAA6B,OAAzE,EAAkF;AAC9E;AACAW,QAAAA,UAAU,CAACgD,IAAX,CAAgB,KAAKC,QAAL,CAAc/D,SAAS,CAACG,KAAD,CAAvB,EAAgC,EAAhC,CAAhB;AACAiB,QAAAA,aAAa,GAAGN,UAAU,CAACA,UAAU,CAACxB,MAAX,GAAoB,CAArB,CAAV,CAAkCA,MAAlD;;AACA,YAAI0B,YAAY,GAAGI,aAAnB,EAAkC;AAC9BJ,UAAAA,YAAY,GAAGI,aAAf;AACAL,UAAAA,QAAQ,GAAGD,UAAU,CAACxB,MAAX,GAAoB,CAA/B;AACH;AACJ,OARD,MASK;AACD;AACA,YAAI0E,OAAO,GAAGhE,SAAS,CAACG,KAAD,CAAvB;;AACA,YAAI6D,OAAO,CAAC,MAAD,CAAP,KAAoB,OAAxB,EAAiC;AAC7BxB,UAAAA,OAAO,GAAG,IAAV,CAD6B,CAE7B;;AACA,cAAIyB,WAAW,GAAG,EAAlB;AACAA,UAAAA,WAAW,CAACH,IAAZ,CAAiB,KAAKC,QAAL,CAAc/D,SAAd,EAAyB,EAAzB,CAAjB;AACAc,UAAAA,UAAU,GAAGmD,WAAb;AACA7C,UAAAA,aAAa,GAAGN,UAAU,CAACA,UAAU,CAACxB,MAAX,GAAoB,CAArB,CAAV,CAAkCA,MAAlD;;AACA,cAAI0B,YAAY,GAAGI,aAAnB,EAAkC;AAC9BJ,YAAAA,YAAY,GAAGI,aAAf;AACAL,YAAAA,QAAQ,GAAGD,UAAU,CAACxB,MAAX,GAAoB,CAA/B;AACH;AACJ;;AACD,aAAK,IAAIuE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGG,OAAO,CAAC1E,MAA5B,EAAoCuE,CAAC,EAArC,EAAyC;AACrC;AACA/C,UAAAA,UAAU,CAACgD,IAAX,CAAgB,KAAKC,QAAL,CAAcC,OAAO,CAACH,CAAD,CAArB,EAA0B,EAA1B,CAAhB;AACAzC,UAAAA,aAAa,GAAGN,UAAU,CAACA,UAAU,CAACxB,MAAX,GAAoB,CAArB,CAAV,CAAkCA,MAAlD;;AACA,cAAI0B,YAAY,GAAGI,aAAnB,EAAkC;AAC9BJ,YAAAA,YAAY,GAAGI,aAAf;AACAL,YAAAA,QAAQ,GAAGD,UAAU,CAACxB,MAAX,GAAoB,CAA/B;AACH;AACJ;AACJ;AACJ;;AACDH,IAAAA,IAAI,GAAI,CAAChB,iBAAiB,CAACgD,UAAD,CAAnB,GAAmC,CAAChD,iBAAiB,CAACgD,UAAU,CAACN,SAAD,CAAX,CAAlB,GACtCM,UAAU,CAACN,SAAD,CAAV,CAAsBlB,QAAtB,EADsC,GACHwB,UAAU,CAACtB,KAAK,CAACX,aAAP,CAD1C,GACkE+B,SAAS,CAAC,YAAD,CAAT,CAAwBJ,SAAxB,CADzE;;AAEA,QAAKuB,MAAM,CAACvD,SAAP,CAAiBc,QAAjB,CAA0B0C,IAA1B,CAA+BxC,KAAK,CAACyC,iBAArC,MAA4D,gBAA7D,IACCnE,iBAAiB,CAACgB,IAAD,CAAjB,IAA2BU,KAAK,CAACd,UAAN,CAAiB,QAAjB,MAA+B,CAD/D,EACmE;AAC/D,WAAK,IAAImF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGrE,KAAK,CAACyC,iBAAN,CAAwBhD,MAA5C,EAAoD4E,CAAC,EAArD,EAAyD;AACrD,YAAIjD,SAAS,CAAC,YAAD,CAAT,CAAwBpB,KAAK,CAACyC,iBAAN,CAAwB4B,CAAxB,CAAxB,CAAJ,EAAyD;AACrD/E,UAAAA,IAAI,GAAG8B,SAAS,CAAC,YAAD,CAAT,CAAwBpB,KAAK,CAACyC,iBAAN,CAAwB4B,CAAxB,CAAxB,CAAP;AACA;AACH;AACJ;AACJ;;AACD,QAAI/F,iBAAiB,CAACgB,IAAD,CAAjB,IAA4BU,KAAK,CAACU,iBAAN,CAAwB4D,QAAxB,KAAqC,EAArC,IAA2CtE,KAAK,CAACd,UAAN,CAAiB,QAAjB,MAA+B,CAA1G,EAA8G;AAC1GI,MAAAA,IAAI,GAAG8B,SAAS,CAAC,YAAD,CAAT,CAAwBpB,KAAK,CAACyC,iBAA9B,CAAP;AACH;;AACD,QAAI8B,aAAa,GAAGjF,IAApB;AACA,QAAIkF,cAAc,GAAG,KAAK/F,IAAL,CAAU+F,cAA/B;;AACA,QAAI7B,OAAJ,EAAa;AACTlB,MAAAA,QAAQ,GAAG;AACPgD,QAAAA,CAAC,EAAExD,UAAU,CAACC,QAAD,CAAV,CAAqBZ,KAArB,EAA4B,GAA5B,CADI;AAC8BoE,QAAAA,CAAC,EAAEzD,UAAU,CAACC,QAAD,CAAV,CAAqBZ,KAArB,EAA4B,GAA5B,CADjC;AAEPqE,QAAAA,QAAQ,EAAE,CAFH;AAEMC,QAAAA,QAAQ,EAAE,CAFhB;AAEmBC,QAAAA,OAAO,EAAE,CAF5B;AAE+BC,QAAAA,OAAO,EAAE,CAFxC;AAGPC,QAAAA,MAAM,EAAE9D,UAAU,CAACC,QAAD,CAAV,CAAqBZ,KAArB,CAHD;AAG8B0E,QAAAA,MAAM,EAAE,CAHtC;AAGyCC,QAAAA,MAAM,EAAE,CAHjD;AAIPC,QAAAA,SAAS,EAAE,CAJJ;AAIOC,QAAAA,SAAS,EAAE,CAJlB;AAIqBC,QAAAA,MAAM,EAAE;AAJ7B,OAAX;AAMH,KAPD,MAQK;AACD3D,MAAAA,QAAQ,GAAGjE,qBAAqB,CAACyD,UAAU,CAACC,QAAD,CAAX,EAAuBsD,cAAvB,EAAuCxE,KAAK,CAACqF,YAA7C,CAAhC;AACH,KAlIqD,CAmItD;;;AACA,QAAIC,qBAAqB,GAAG7D,QAA5B;;AACA,QAAI,CAACnD,iBAAiB,CAACgB,IAAD,CAAlB,IAA4B,CAAChB,iBAAiB,CAACmD,QAAD,CAAlD,EAA8D;AAC1D,UAAImC,kBAAkB,IAAIH,cAAc,GAAG,CAAvC,IAA4C,CAAC,KAAKhF,IAAL,CAAU8G,cAAvD,IAAyE9E,SAAS,CAAC6D,QAAV,KAAuB,EAApG,EAAwG;AACpG,YAAIrE,UAAU,GAAG,CAAjB,EAAoB;AAChB,eAAK,IAAIuF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK/G,IAAL,CAAUgH,kBAAV,CAA6BhG,MAAjD,EAAyD+F,CAAC,EAA1D,EAA8D;AAC1D,gBAAI,KAAK/G,IAAL,CAAUgH,kBAAV,CAA6BD,CAA7B,EAAgC,eAAhC,MAAqDlG,IAAzD,EAA+D;AAC3DkC,cAAAA,QAAQ,GAAGlB,KAAX;AACAA,cAAAA,KAAK,GAAGkF,CAAR;AACA9D,cAAAA,kBAAkB,GAAG,IAArB;AACA;AACH;AACJ;AACJ;;AACDM,QAAAA,SAAS,GAAGP,QAAQ,CAAC,GAAD,CAApB;AACAQ,QAAAA,SAAS,GAAGR,QAAQ,CAAC,GAAD,CAApB;AACAA,QAAAA,QAAQ,CAAC,GAAD,CAAR,GAAiB,CAACA,QAAQ,CAAC,GAAD,CAAR,GAAgB6B,cAAc,CAAC,GAAD,CAA/B,IAAwCH,KAAzD;AACA1B,QAAAA,QAAQ,CAAC,GAAD,CAAR,GAAiB,CAACA,QAAQ,CAAC,GAAD,CAAR,GAAgB6B,cAAc,CAAC,GAAD,CAA/B,IAAwCH,KAAzD;AACH;;AACD1B,MAAAA,QAAQ,CAAC,GAAD,CAAR,GAAiB,KAAKhD,IAAL,CAAU+F,cAAV,KAA6B,UAA9B,IAA6CxE,KAAK,CAACqF,YAAN,KAAuB,QAApE,GAA+E5D,QAAQ,CAAC,GAAD,CAAvF,GAAgG,CAACA,QAAQ,CAAC,GAAD,CAAzH;AACA/B,MAAAA,IAAI,GAAG+B,QAAP;;AACA,UAAI,CAACnD,iBAAiB,CAAC,KAAKG,IAAL,CAAUiH,MAAX,CAAlB,IAAwC,CAAC9F,KAAK,CAAC+F,UAAU,CAACrG,IAAD,CAAX,CAAlD,EAAsE;AAClE,YAAI,KAAKb,IAAL,CAAUmH,oBAAd,EAAoC;AAChCtG,UAAAA,IAAI,GAAGjB,WAAW,CAAC,KAAKI,IAAN,EAAYkH,UAAU,CAACrG,IAAD,CAAtB,CAAlB;;AACA,cAAI,CAAChB,iBAAiB,CAACgD,UAAD,CAAtB,EAAoC;AAChCA,YAAAA,UAAU,CAACN,SAAD,CAAV,GAAwB1B,IAAxB;AACH;AACJ;AACJ;;AACD,UAAIuG,WAAW,GAAG;AACdC,QAAAA,IAAI,EAAEvH,kBADQ;AACYE,QAAAA,IAAI,EAAE,KAAKA,IADvB;AAC6BsH,QAAAA,MAAM,EAAE,KADrC;AAC4CC,QAAAA,MAAM,EAAE;AAAEC,UAAAA,KAAK,EAAExF,SAAS,CAACuF,MAAV,CAAiBC,KAA1B;AAC9DC,UAAAA,KAAK,EAAEzF,SAAS,CAACuF,MAAV,CAAiBE,KADsC;AAC/BC,UAAAA,OAAO,EAAE1F,SAAS,CAACuF,MAAV,CAAiBG;AADK,SADpD;AAE0DC,QAAAA,SAAS,EAAE3F,SAFrE;AAGd4F,QAAAA,IAAI,EAAE5F,SAAS,CAAC4F,IAHF;AAGQ/B,QAAAA,QAAQ,EAAE7D,SAAS,CAAC6D,QAH5B;AAGsChF,QAAAA,IAAI,EAAEA;AAH5C,OAAlB;AAKA,WAAKb,IAAL,CAAU6H,OAAV,CAAkB,oBAAlB,EAAwCT,WAAxC,EAAqD,UAAUU,SAAV,EAAqB;AACtE,YAAIV,WAAW,CAACE,MAAhB,EAAwB;AACpB;AACH,SAHqE,CAItE;;;AACA,YAAIC,MAAM,GAAG;AAAEC,UAAAA,KAAK,EAAE;AAAT,SAAb;AACA,YAAIO,QAAQ,GAAG,EAAf;AACA,YAAIN,KAAK,GAAGtC,kBAAkB,IAAIH,cAAc,GAAG,CAAvC,IAA4C,CAACjD,KAAK,CAAC/B,IAAN,CAAW8G,cAAxD,IACL/E,KAAK,CAAC/B,IAAN,CAAWqF,mBAAX,CAA+BrE,MAA/B,GAAwCa,KADnC,GAC2CE,KAAK,CAAC/B,IAAN,CAAWqF,mBAAX,CAA+BxD,KAA/B,EAAsC,OAAtC,CAD3C,GAER,CAACmB,QAAQ,CAAC,UAAD,CAAR,CAAqB,GAArB,IAA4BA,QAAQ,CAAC,SAAD,CAAR,CAAoB,GAApB,CAA7B,IAAyD0B,KAF7D;;AAGA,YAAI,CAAC7E,iBAAiB,CAACkC,KAAK,CAAC/B,IAAN,CAAWgI,cAAZ,CAAtB,EAAmD;AAC/CjD,UAAAA,UAAU,GAAG8B,qBAAqB,CAAC,UAAD,CAArB,CAAkC,GAAlC,IAAyCA,qBAAqB,CAAC,SAAD,CAArB,CAAiC,GAAjC,CAAtD;;AACA9E,UAAAA,KAAK,CAAC/B,IAAN,CAAWgI,cAAX,CAA0BxC,IAA1B,CAA+BT,UAA/B;AACH;;AACD,YAAIqC,WAAW,CAACvG,IAAZ,KAAqBA,IAArB,IAA6B,CAACuG,WAAW,CAACE,MAA9C,EAAsD;AAClDzG,UAAAA,IAAI,GAAGuG,WAAW,CAACvG,IAAnB;AACH;;AACD,YAAIoH,QAAQ,GAAGtI,WAAW,CAACkB,IAAD,EAAOqB,KAAP,CAA1B;AACA,YAAIgG,YAAY,GAAGrH,IAAnB;AACA,YAAIsH,WAAW,GAAGF,QAAlB;AACA,YAAIG,MAAM,GAAGpF,QAAQ,CAAC,GAAD,CAAR,GAAgBiF,QAAQ,CAAC,QAAD,CAAR,GAAqB,CAAlD;AACA,YAAII,IAAI,GAAGrF,QAAQ,CAAC,GAAD,CAAR,GAAgBiF,QAAQ,CAAC,QAAD,CAAR,GAAqB,CAAhD;AACA,YAAIK,KAAK,GAAI,CAACtF,QAAQ,CAAC,GAAD,CAAR,GAAgB2B,UAAU,CAAC,GAAD,CAA3B,IAAoCD,KAArC,GAA8CuD,QAAQ,CAAC,QAAD,CAAR,GAAqB,CAA/E;AACA,YAAIM,GAAG,GAAI,CAACvF,QAAQ,CAAC,GAAD,CAAR,GAAgB2B,UAAU,CAAC,GAAD,CAA3B,IAAoCD,KAArC,GAA8CuD,QAAQ,CAAC,QAAD,CAAR,GAAqB,CAA7E;AACAF,QAAAA,QAAQ,GAAG9I,MAAM,CAACuD,UAAU,CAACC,QAAD,CAAX,EAAuB2F,MAAvB,EAA+BC,IAA/B,CAAjB;;AACA,YAAI,CAACnE,OAAD,IAAY6D,QAAQ,CAAC/G,MAAT,GAAkB,CAA9B,IAAoC2B,SAAS,CAAC,UAAD,CAAT,CAAsB,MAAtB,MAAkC,cAAtE,IACCA,SAAS,CAAC,MAAD,CAAT,KAAsB,cAD3B,EAC4C;AACxC;AACA,cAAI6F,SAAS,GAAGzJ,qBAAqB,CAACgJ,QAAD,EAAWhC,cAAX,EAA2BxE,KAAK,CAACqF,YAAjC,CAArC;;AACA,cAAIzB,kBAAkB,IAAIH,cAAc,GAAG,CAAvC,IAA4C,CAACjD,KAAK,CAAC/B,IAAN,CAAW8G,cAAxD,IAA0EM,WAAW,CAACvB,QAAZ,KAAyB,EAAvG,EAA2G;AACvG2C,YAAAA,SAAS,CAAC,GAAD,CAAT,GAAkB,CAACzG,KAAK,CAAC/B,IAAN,CAAWgH,kBAAX,CAA8BnF,KAA9B,EAAqC,UAArC,EAAiD,GAAjD,IAAwDgD,cAAc,CAAC,GAAD,CAAvE,IAAgFH,KAAlG;AACA8D,YAAAA,SAAS,CAAC,GAAD,CAAT,GAAkB,CAACzG,KAAK,CAAC/B,IAAN,CAAWgH,kBAAX,CAA8BnF,KAA9B,EAAqC,UAArC,EAAiD,GAAjD,IAAwDgD,cAAc,CAAC,GAAD,CAAvE,IAAgFH,KAAlG;AACH;;AACDnB,UAAAA,SAAS,GAAGiF,SAAS,CAAC,GAAD,CAArB;AACAxF,UAAAA,QAAQ,CAAC,GAAD,CAAR,GAAgBwF,SAAS,CAAC,GAAD,CAAzB;AACAf,UAAAA,KAAK,GAAGtC,kBAAkB,IAAIH,cAAc,GAAG,CAAvC,IAA4C,CAACjD,KAAK,CAAC/B,IAAN,CAAW8G,cAAxD,IACD/E,KAAK,CAAC/B,IAAN,CAAWqF,mBAAX,CAA+BrE,MAA/B,GAAwCa,KADvC,GAC+CE,KAAK,CAAC/B,IAAN,CAAWqF,mBAAX,CAA+BxD,KAA/B,EAAsC,OAAtC,CAD/C,GAEJ,CAAC2G,SAAS,CAAC,UAAD,CAAT,CAAsB,GAAtB,IAA6BA,SAAS,CAAC,SAAD,CAAT,CAAqB,GAArB,CAA9B,IAA2D9D,KAF/D;AAGH;;AACD,YAAI+D,aAAa,GAAI,CAACzF,QAAQ,CAAC,GAAD,CAAR,GAAgB2B,UAAU,CAAC,GAAD,CAA3B,IAAoCD,KAArC,GAA8CuD,QAAQ,CAAC,OAAD,CAAR,GAAoB,CAAtF;AACA,YAAIS,cAAc,GAAI,CAAC1F,QAAQ,CAAC,GAAD,CAAR,GAAgB2B,UAAU,CAAC,GAAD,CAA3B,IAAoCD,KAArC,GAA8CuD,QAAQ,CAAC,OAAD,CAAR,GAAoB,CAAvF;AACAlG,QAAAA,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,IAAqB;AAAE3B,UAAAA,UAAU,EAAEuI,aAAd;AAA6BtI,UAAAA,SAAS,EAAEuI,cAAxC;AAAwDtI,UAAAA,SAAS,EAAEkI,KAAnE;AAA0EjI,UAAAA,YAAY,EAAEkI;AAAxF,SAArB;AACA,YAAII,YAAJ;;AACA,YAAIvB,WAAW,CAACvB,QAAZ,KAAyB,EAA7B,EAAiC;AAC7BxD,UAAAA,UAAU,GAAGnD,mBAAmB,CAACkI,WAAW,CAACvB,QAAb,CAAhC;AACA,cAAI+C,eAAe,GAAGvG,UAAU,GAAGA,UAAU,CAAC,CAACxC,iBAAiB,CAACgD,UAAD,CAAlB,GAC1CA,UAD0C,GAC7BF,SAAS,CAAC,YAAD,CADmB,EACHZ,KAAK,CAAC/B,IADH,EACSoH,WAAW,CAACvB,QADrB,EAC+B9D,KAAK,CAAC/B,IAAN,CAAW4C,OAAX,CAAmBQ,EAAnB,GAAwB,gBADvD,EACyE,KADzE,CAAb,GAC+FyF,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAD/H;AAEAF,UAAAA,eAAe,CAACG,SAAhB,GAA4B,CAAC1G,UAAD,GAAc+E,WAAW,CAACvB,QAA1B,GAAqC,EAAjE;AACA8C,UAAAA,YAAY,GAAGrJ,uBAAuB,CAACsJ,eAAD,EAAkBzF,OAAlB,EAA2B,CAACtD,iBAAiB,CAACgD,UAAD,CAAlB,GAAiCA,UAAjC,GAA8CF,SAAS,CAAC,YAAD,CAAlF,EAAkGd,KAAlG,EAAyGE,KAAK,CAAC/B,IAA/G,CAAtC;AACA2I,UAAAA,YAAY,CAACzG,KAAb,CAAmB8G,IAAnB,GAA4B/D,IAAI,CAACgE,GAAL,CAASlH,KAAK,CAAC/B,IAAN,CAAWkJ,iBAAX,CAA6B,KAA7B,EAAoC,GAApC,IAA2ClG,QAAQ,CAAC,GAAD,CAA5D,CAAD,GAAuE0B,KAAxE,GAAiF,IAA3G;AACAiE,UAAAA,YAAY,CAACzG,KAAb,CAAmBiH,GAAnB,GAA2BlE,IAAI,CAACgE,GAAL,CAASlH,KAAK,CAAC/B,IAAN,CAAWkJ,iBAAX,CAA6B,KAA7B,EAAoC,GAApC,IAA2ClG,QAAQ,CAAC,GAAD,CAA5D,CAAD,GAAuE0B,KAAxE,GAAiF,IAA1G;AACA9C,UAAAA,oBAAoB,CAACwH,WAArB,CAAiCT,YAAjC;AACH,SATD,MAUK;AACD,cAAI1G,iBAAiB,CAACoH,cAAlB,KAAqC,MAAzC,EAAiD;AAC7C;AACA,gBAAIC,QAAQ,GAAG,OAAOzI,IAAP,KAAgB,QAAhB,GAA2BA,IAAI,CAACQ,QAAL,EAA3B,GAA6CR,IAA5D;AACAqH,YAAAA,YAAY,GAAGxI,QAAQ,CAAC+H,KAAD,EAAQ6B,QAAR,EAAkBpH,KAAlB,CAAvB;AACAiG,YAAAA,WAAW,GAAGxI,WAAW,CAACuI,YAAD,EAAehG,KAAf,CAAzB;AACAI,YAAAA,OAAO,GAAG,IAAI9C,UAAJ,CAAe2D,OAAf,EAAwBE,YAAY,CAAC2C,CAArC,EAAwC3C,YAAY,CAAC4C,CAArD,EAAwD,QAAxD,EAAkEiC,YAAlE,EAAgF,EAAhF,EAAoF,EAApF,CAAV;AACH;;AACD,cAAIjG,iBAAiB,CAACoH,cAAlB,KAAqC,MAAzC,EAAiD;AAC7C/G,YAAAA,OAAO,GAAG,IAAI9C,UAAJ,CAAe2D,OAAf,EAAyBE,YAAY,CAAC2C,CAAtC,EAA0C3C,YAAY,CAAC4C,CAAvD,EAA0D,QAA1D,EAAoEpF,IAApE,EAA0E,EAA1E,EAA8E,EAA9E,CAAV;AACH;;AACD,cAAIoB,iBAAiB,CAACoH,cAAlB,KAAqC,MAAzC,EAAiD;AAC7CxI,YAAAA,IAAI,GAAI4G,KAAK,IAAIQ,QAAQ,CAAC,OAAD,CAAlB,GAA+BpH,IAA/B,GAAsC,EAA7C;AACAyB,YAAAA,OAAO,GAAG,IAAI9C,UAAJ,CAAe2D,OAAf,EAAyBE,YAAY,CAAC2C,CAAtC,EAA2C3C,YAAY,CAAC4C,CAAxD,EAA4D,QAA5D,EAAsEpF,IAAtE,EAA4E,EAA5E,EAAgF,EAAhF,CAAV;AACH;;AACDA,UAAAA,IAAI,GAAGyB,OAAO,CAAC,MAAD,CAAd;;AACA,cAAIL,iBAAiB,CAACsH,kBAAlB,KAAyC,MAA7C,EAAqD;AACjD,iBAAK,IAAIxI,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGe,SAAS,CAACd,MAA9B,EAAsCD,CAAC,EAAvC,EAA2C;AACvC,kBAAI,CAAClB,iBAAiB,CAACiC,SAAS,CAACf,CAAD,CAAV,CAAtB,EAAsC;AAClC,oBAAI,EAAEgB,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,WAAnB,IAAkCC,SAAS,CAACf,CAAD,CAAT,CAAa,YAAb,CAAlC,IACCgB,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,YAAnB,IAAmCC,SAAS,CAACf,CAAD,CAAT,CAAa,WAAb,CADpC,IAECgB,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,WAAnB,IAAkCC,SAAS,CAACf,CAAD,CAAT,CAAa,cAAb,CAFnC,IAGCgB,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,cAAnB,IAAqCC,SAAS,CAACf,CAAD,CAAT,CAAa,WAAb,CAHxC,CAAJ,EAGwE;AACpEF,kBAAAA,IAAI,GAAG,EAAP;AACA;AACH;AACJ;AACJ;;AACDiB,YAAAA,SAAS,CAAC0D,IAAV,CAAezD,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,CAAf;AACAS,YAAAA,OAAO,GAAG,IAAI9C,UAAJ,CAAe2D,OAAf,EAAwBE,YAAY,CAAC2C,CAArC,EAAwC3C,YAAY,CAAC4C,CAArD,EAAwD,QAAxD,EAAkEpF,IAAlE,EAAwE,EAAxE,EAA4E,EAA5E,CAAV;AACH;;AACD,cAAI2I,UAAU,GAAG,KAAK,CAAtB;;AACA,cAAIvH,iBAAiB,CAACsH,kBAAlB,KAAyC,MAA7C,EAAqD;AACjD,iBAAK,IAAIhE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGzD,SAAS,CAACd,MAA9B,EAAsCuE,CAAC,EAAvC,EAA2C;AACvC,kBAAI,CAAC1F,iBAAiB,CAACiC,SAAS,CAACyD,CAAD,CAAV,CAAtB,EAAsC;AAClC,oBAAIzD,SAAS,CAACyD,CAAD,CAAT,CAAa,YAAb,IAA6BxD,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,WAAnB,CAA7B,IACGC,SAAS,CAACyD,CAAD,CAAT,CAAa,WAAb,IAA4BxD,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,YAAnB,CAD/B,IAEGC,SAAS,CAACyD,CAAD,CAAT,CAAa,cAAb,IAA+BxD,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,WAAnB,CAFlC,IAGGC,SAAS,CAACyD,CAAD,CAAT,CAAa,WAAb,IAA4BxD,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,cAAnB,CAHnC,EAGuE;AACnEqG,kBAAAA,YAAY,GAAGrH,IAAf;AACA2I,kBAAAA,UAAU,GAAG,CAAb;AACH,iBAND,MAOK;AACD,sBAAIzH,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,WAAnB,IAAkCC,SAAS,CAACyD,CAAD,CAAT,CAAa,WAAb,CAAtC,EAAiE;AAC7DkC,oBAAAA,KAAK,GAAG3F,SAAS,CAACyD,CAAD,CAAT,CAAa,YAAb,IAA6BxD,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,WAAnB,CAArC;AACA2H,oBAAAA,UAAU,GAAG/B,KAAK,IAAI1F,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,YAAnB,IAAmCE,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,WAAnB,CAAvC,CAAlB;AACAqG,oBAAAA,YAAY,GAAGxI,QAAQ,CAAC8J,UAAD,EAAa3I,IAAb,EAAmBqB,KAAnB,CAAvB;AACA;AACH;;AACD,sBAAIH,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,WAAnB,IAAkCC,SAAS,CAACyD,CAAD,CAAT,CAAa,WAAb,CAAtC,EAAiE;AAC7DkC,oBAAAA,KAAK,GAAG1F,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,YAAnB,IAAmCC,SAAS,CAACyD,CAAD,CAAT,CAAa,WAAb,CAA3C;AACAiE,oBAAAA,UAAU,GAAGvE,IAAI,CAACgE,GAAL,CAASxB,KAAK,IAAI1F,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,YAAnB,IAAmCE,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,EAAmB,WAAnB,CAAvC,CAAd,CAAb;AACAqG,oBAAAA,YAAY,GAAGxI,QAAQ,CAAC8J,UAAD,EAAa3I,IAAb,EAAmBqB,KAAnB,CAAvB;AACA;AACH;AACJ;AACJ;AACJ;;AACDiG,YAAAA,WAAW,GAAGxI,WAAW,CAACuI,YAAD,EAAehG,KAAf,CAAzB;AACAJ,YAAAA,SAAS,CAAC0D,IAAV,CAAezD,KAAK,CAAC9B,KAAN,CAAY4B,KAAZ,CAAf;AACAS,YAAAA,OAAO,GAAG,IAAI9C,UAAJ,CAAe2D,OAAf,EAAwBE,YAAY,CAAC2C,CAArC,EAAyC3C,YAAY,CAAC4C,CAAtD,EAA0D,QAA1D,EAAoEiC,YAApE,EAAkF,EAAlF,EAAsF,EAAtF,CAAV;AACH;;AACD,cAAIjG,iBAAiB,CAACsH,kBAAlB,KAAyC,MAA7C,EAAqD;AACjDjH,YAAAA,OAAO,GAAG,IAAI9C,UAAJ,CAAe2D,OAAf,EAAyBE,YAAY,CAAC2C,CAAtC,EAA2C3C,YAAY,CAAC4C,CAAxD,EAA4D,QAA5D,EAAsEpF,IAAtE,EAA4E,EAA5E,EAAgF,EAAhF,CAAV;AACH;;AACD,cAAIqH,YAAY,CAAClH,MAAb,GAAsB,CAA1B,EAA6B;AACzB;AACA,gBAAIyI,QAAQ,GAAGrC,WAAW,CAACG,MAA3B;;AACA,gBAAIkC,QAAQ,CAAC,OAAD,CAAR,GAAoB,CAAxB,EAA2B;AACvB,kBAAI7B,IAAI,GAAGR,WAAW,CAACQ,IAAvB;AACA,kBAAIF,OAAO,GAAGzF,iBAAiB,CAACyF,OAAhC;AACA,kBAAIgC,EAAE,GAAGzH,iBAAiB,CAACyH,EAA3B;AACA,kBAAIC,EAAE,GAAG1H,iBAAiB,CAAC0H,EAA3B;AACA,kBAAI3D,CAAC,GAAG,KAAK,CAAb;AACA,kBAAIC,CAAC,GAAG,KAAK,CAAb;AACA,kBAAI2D,OAAO,GAAG,CAAd;;AACA,kBAAIzE,kBAAkB,IAAIH,cAAc,GAAG,CAAvC,IAA4C,CAACjD,KAAK,CAAC/B,IAAN,CAAW8G,cAA5D,EAA4E;AACxEd,gBAAAA,CAAC,GAAKhD,QAAQ,CAAC,GAAD,CAAV,GAAoBiF,QAAQ,CAAC,OAAD,CAAR,GAAoB,CAA5C;AACAhC,gBAAAA,CAAC,GAAKjD,QAAQ,CAAC,GAAD,CAAV,GAAoBiF,QAAQ,CAAC,QAAD,CAAR,GAAqB,CAAzC,GAA6C2B,OAAjD;AACH,eAHD,MAIK;AACD5D,gBAAAA,CAAC,GAAI,CAAChD,QAAQ,CAAC,GAAD,CAAR,GAAgB2B,UAAU,CAAC,GAAD,CAA3B,IAAoCD,KAArC,GAA8CuD,QAAQ,CAAC,OAAD,CAAR,GAAoB,CAAtE;AACAhC,gBAAAA,CAAC,GAAI,CAACjD,QAAQ,CAAC,GAAD,CAAR,GAAgB2B,UAAU,CAAC,GAAD,CAA3B,IAAoCD,KAArC,GAA8CuD,QAAQ,CAAC,QAAD,CAAR,GAAqB,CAAvE;AACH;;AACDwB,cAAAA,QAAQ,CAAC/B,OAAT,GAAmB7H,iBAAiB,CAAC4J,QAAQ,CAAC/B,OAAV,CAAjB,GAAsCA,OAAtC,GAAgD+B,QAAQ,CAAC/B,OAA5E;AACA,kBAAImC,WAAW,GAAG,IAAIxK,UAAJ,CAAe0C,KAAK,CAAC/B,IAAN,CAAW4C,OAAX,CAAmBQ,EAAnB,GAAwB,cAAxB,GAAyC5B,UAAzC,GAAsD,cAAtD,GAAuEK,KAAvE,GAA+E,aAA/E,GAA+FA,KAA9G,EAAqH+F,IAArH,EAA2H6B,QAA3H,EAAqI/B,OAArI,EAA8I,IAAI1I,IAAJ,CAASgH,CAAT,EAAYC,CAAZ,EAAegC,QAAQ,CAAC,OAAD,CAAvB,EAAkCA,QAAQ,CAAC,QAAD,CAA1C,CAA9I,EAAqMyB,EAArM,EAAyMC,EAAzM,CAAlB;;AACA,kBAAIG,IAAI,GAAG/H,KAAK,CAAC/B,IAAN,CAAW+J,QAAX,CAAoBC,aAApB,CAAkCH,WAAlC,CAAX;;AACAlI,cAAAA,KAAK,CAACyH,WAAN,CAAkBU,IAAlB;AACH;AACJ;;AACDlH,UAAAA,OAAO,GAAGnD,iBAAiB,CAAC6C,OAAD,EAAUJ,KAAV,EAAiBA,KAAK,CAACsF,KAAN,IAAezF,KAAK,CAAC/B,IAAN,CAAW2D,UAAX,CAAsBsG,kBAAtD,EAA0EtI,KAA1E,CAA3B;;AACA,cAAIwD,kBAAkB,IAAIH,cAAc,GAAG,CAAvC,IAA4C,CAACjD,KAAK,CAAC/B,IAAN,CAAW8G,cAA5D,EAA4E;AACxElE,YAAAA,OAAO,CAACsH,YAAR,CAAqB,WAArB,EAAkC,gBAAkBlH,QAAQ,CAAC,GAAD,CAA1B,GAAoC,GAApC,GACzBA,QAAQ,CAAC,GAAD,CADiB,GACN,IAD5B;AAEAA,YAAAA,QAAQ,CAAC,GAAD,CAAR,GAAgBO,SAAhB;AACAP,YAAAA,QAAQ,CAAC,GAAD,CAAR,GAAgBQ,SAAhB;AACH,WALD,MAMK;AACDZ,YAAAA,OAAO,CAACsH,YAAR,CAAqB,WAArB,EAAkC,gBAAiB,CAAClH,QAAQ,CAAC,GAAD,CAAR,GAAgB2B,UAAU,CAACqB,CAA5B,IAAiCtB,KAAlD,GAA2D,GAA3D,IAC1B,CAAC1B,QAAQ,CAAC,GAAD,CAAR,GAAgB2B,UAAU,CAACsB,CAA5B,IAAiCvB,KAAlC,GAA4CyD,WAAW,CAACxB,MAAZ,GAAqB,CADtC,IAC4C,IAD9E;AAEH;;AACDhF,UAAAA,KAAK,CAACyH,WAAN,CAAkBxG,OAAlB;AACH;;AACDb,QAAAA,KAAK,CAACzB,oBAAN,CAA2BkF,IAA3B,CAAgC;AAC5BxC,UAAAA,QAAQ,EAAE;AAAEgD,YAAAA,CAAC,EAAEhD,QAAQ,CAAC,GAAD,CAAb;AAAoBiD,YAAAA,CAAC,EAAEjD,QAAQ,CAAC,GAAD;AAA/B,WADkB;AAE5BJ,UAAAA,OAAO,EAAE/C,iBAAiB,CAAC8I,YAAD,CAAjB,GAAkC/F,OAAlC,GAA4C+F,YAFzB;AAG5BnH,UAAAA,UAAU,EAAEA,UAHgB;AAI5B2I,UAAAA,UAAU,EAAElH,kBAAkB,GAAGF,QAAH,GAAclB,KAJhB;AAK5BuI,UAAAA,UAAU,EAAEnH,kBAAkB,GAAGF,QAAH,GAAclB,KALhB;AAM5BiE,UAAAA,aAAa,EAAEA;AANa,SAAhC;;AAQA,YAAIlE,oBAAoB,CAACyI,iBAArB,GAAyC,CAAzC,IAA8C,CAACtI,KAAK,CAAC/B,IAAN,CAAW4C,OAAX,CAAmB0H,QAAnB,CAA4B1I,oBAA5B,CAAnD,EAAsG;AAClGiH,UAAAA,QAAQ,CAAC0B,cAAT,CAAwBxI,KAAK,CAAC/B,IAAN,CAAW4C,OAAX,CAAmBQ,EAAnB,GAAwB,oBAAhD,EAAsEgG,WAAtE,CAAkFxH,oBAAlF,EADkG,CAElG;;AACAG,UAAAA,KAAK,CAAC/B,IAAN,CAAWwK,oBAAX;AACH;AACJ,OAzKD;AA0KH;AACJ,GApVD,CAvCuC,CA4XvC;;;AACAzK,EAAAA,SAAS,CAACQ,SAAV,CAAoBkF,QAApB,GAA+B,UAAUnC,MAAV,EAAkBgD,MAAlB,EAA0B;AACrD;AACAhD,IAAAA,MAAM,CAACmH,GAAP,CAAW,UAAUC,OAAV,EAAmB7I,KAAnB,EAA0B;AACjCyE,MAAAA,MAAM,CAACd,IAAP,CAAY,IAAIjG,KAAJ,CAAUmL,OAAO,CAAC,OAAD,CAAP,CAAiB,GAAjB,CAAV,EAAiCA,OAAO,CAAC,OAAD,CAAP,CAAiB,GAAjB,CAAjC,CAAZ;AACH,KAFD;AAGA,WAAOpE,MAAP;AACH,GAND;AAOA;AACJ;AACA;AACA;AACA;;;AACIvG,EAAAA,SAAS,CAACQ,SAAV,CAAoBoK,aAApB,GAAoC,YAAY;AAC5C,WAAO,WAAP;AACH,GAFD;AAGA;AACJ;AACA;AACA;AACA;AACA;AACA;;;AACI5K,EAAAA,SAAS,CAACQ,SAAV,CAAoBqK,OAApB,GAA8B,UAAU5K,IAAV,EAAgB;AAC1C;AACR;AACA;AACK,GAJD;;AAKA,SAAOD,SAAP;AACH,CAzZ8B,EAA/B;;AA0ZA,SAASA,SAAT","sourcesContent":["import { findMidPointOfPolygon, Rect, filter, getTemplateFunction, getZoomTranslate, getTranslate, RectOption, convertElementFromLabel, Point, TextOption, renderTextElement, textTrim, measureText, Internalize } from '../utils/helper';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { dataLabelRendering } from '../model/constants';\n/**\n * DataLabel Module used to render the maps datalabel\n */\nvar DataLabel = /** @class */ (function () {\n    function DataLabel(maps) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        this.value = { rightWidth: 0, leftWidth: 0, heightTop: 0, heightBottom: 0 };\n        this.maps = maps;\n        this.dataLabelCollections = [];\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    DataLabel.prototype.getDataLabel = function (dataSource, labelPath, shapeName, shapeDataPath) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var text;\n        var shapeNameValue;\n        for (var i = 0; i < dataSource.length; i++) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var data = dataSource[i];\n            var dataShapePathValue = !isNullOrUndefined(data[shapeDataPath]) && isNaN(data[shapeDataPath]) ?\n                data[shapeDataPath].toLowerCase() : data[shapeDataPath];\n            shapeName = !isNullOrUndefined(shapeName) ? shapeName.toString() : shapeName;\n            shapeNameValue = !isNullOrUndefined(shapeName) ? shapeName.toLowerCase() : shapeName;\n            if ((dataShapePathValue) === shapeNameValue) {\n                text = data;\n                break;\n            }\n        }\n        return text;\n    };\n    /**\n     * To render label for maps\n     *\n     * @param {LayerSettings} layer - Specifies the layer settings\n     * @param {number} layerIndex - Specifies the layer index.\n     * @param {any} shape - Specifies the shape.\n     * @param {any[]} layerData - Specifies the layer data.\n     * @param {Element} group Specifies the element.\n     * @param {HTMLElement} labelTemplateElement - Specifies the template element.\n     * @param {number} index - Specifies the index number.\n     * @param {any[]} intersect - Specifies the intersect.\n     * @returns {void}\n     */\n    DataLabel.prototype.renderLabel = function (\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    layer, layerIndex, shape, \n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    layerData, group, labelTemplateElement, index, intersect) {\n        var _this = this;\n        var dataLabel = layer.dataLabelSettings;\n        var style = layer.dataLabelSettings.textStyle;\n        var markerEle;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var templateFn;\n        var options;\n        var dataLabelSettings = layer.dataLabelSettings;\n        var labelpath = layer.dataLabelSettings.labelPath;\n        var shapePoint = [[]];\n        var midIndex = 0;\n        var pointsLength = 0;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var shapeData = shape;\n        var element;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var data;\n        var text = '';\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var datasrcObj;\n        var currentLength = 0;\n        var oldIndex;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var location;\n        var sublayerIndexLabel = false;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var shapeProperties = shape['properties'];\n        var labelId = this.maps.element.id + '_LayerIndex_' + layerIndex + '_shapeIndex_' + index + '_LabelIndex_' + index;\n        var textLocation = new Point(0, 0);\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var shapes = layerData[index];\n        var locationX;\n        var locationY;\n        style.fontFamily = this.maps.theme.toLowerCase() !== 'material' ? this.maps.themeStyle.labelFontFamily : style.fontFamily;\n        shape = shapes['property'];\n        var properties = (Object.prototype.toString.call(layer.shapePropertyPath) === '[object Array]' ?\n            layer.shapePropertyPath : [layer.shapePropertyPath]);\n        var propertyPath;\n        var isPoint = false;\n        var animate = layer.animationDuration !== 0 || isNullOrUndefined(this.maps.zoomModule);\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var translate = (this.maps.isTileMap) ? new Object() : ((this.maps.zoomSettings.zoomFactor > 1 &&\n            !isNullOrUndefined(this.maps.zoomModule)) ? getZoomTranslate(this.maps, layer, animate) :\n            getTranslate(this.maps, layer, animate));\n        var scale = (this.maps.isTileMap) ? this.maps.scale : translate['scale'];\n        var transPoint = (this.maps.isTileMap) ? this.maps.translatePoint : translate['location'];\n        var zoomTransPoint = this.maps.zoomTranslatePoint;\n        var shapeWidth;\n        var scaleZoomValue = !isNullOrUndefined(this.maps.scale) ? Math.floor(this.maps.scale) : 1;\n        var zoomLabelsPosition = this.maps.zoomSettings.enable ? !isNullOrUndefined(this.maps.zoomShapeCollection) &&\n            this.maps.zoomShapeCollection.length > 0 : this.maps.zoomSettings.enable;\n        this.maps.translateType = 'labels';\n        for (var j = 0; j < properties.length; j++) {\n            if (shapeProperties[properties[j]]) {\n                propertyPath = properties[j];\n                datasrcObj = this.getDataLabel(\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                layer.dataSource, layer.shapeDataPath, shapeData['properties'][propertyPath], layer.shapeDataPath);\n                if (datasrcObj) {\n                    break;\n                }\n            }\n        }\n        datasrcObj = this.getDataLabel(\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        layer.dataSource, layer.shapeDataPath, shapeData['properties'][propertyPath], layer.shapeDataPath);\n        if (!isNullOrUndefined(shapes['property'])) {\n            shapePoint = [[]];\n            if (!layerData[index]['_isMultiPolygon'] && layerData[index]['type'] !== 'Point') {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                shapePoint.push(this.getPoint(layerData[index], []));\n                currentLength = shapePoint[shapePoint.length - 1].length;\n                if (pointsLength < currentLength) {\n                    pointsLength = currentLength;\n                    midIndex = shapePoint.length - 1;\n                }\n            }\n            else {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                var layer_1 = layerData[index];\n                if (layer_1['type'] === 'Point') {\n                    isPoint = true;\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    var layerPoints = [];\n                    layerPoints.push(this.getPoint(layerData, []));\n                    shapePoint = layerPoints;\n                    currentLength = shapePoint[shapePoint.length - 1].length;\n                    if (pointsLength < currentLength) {\n                        pointsLength = currentLength;\n                        midIndex = shapePoint.length - 1;\n                    }\n                }\n                for (var j = 0; j < layer_1.length; j++) {\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    shapePoint.push(this.getPoint(layer_1[j], []));\n                    currentLength = shapePoint[shapePoint.length - 1].length;\n                    if (pointsLength < currentLength) {\n                        pointsLength = currentLength;\n                        midIndex = shapePoint.length - 1;\n                    }\n                }\n            }\n        }\n        text = (!isNullOrUndefined(datasrcObj)) ? !isNullOrUndefined(datasrcObj[labelpath]) ?\n            datasrcObj[labelpath].toString() : datasrcObj[layer.shapeDataPath] : shapeData['properties'][labelpath];\n        if ((Object.prototype.toString.call(layer.shapePropertyPath) === '[object Array]') &&\n            (isNullOrUndefined(text) && layer.dataSource['length'] === 0)) {\n            for (var l = 0; l < layer.shapePropertyPath.length; l++) {\n                if (shapeData['properties'][layer.shapePropertyPath[l]]) {\n                    text = shapeData['properties'][layer.shapePropertyPath[l]];\n                    break;\n                }\n            }\n        }\n        if (isNullOrUndefined(text) && (layer.dataLabelSettings.template !== '' && layer.dataSource['length'] === 0)) {\n            text = shapeData['properties'][layer.shapePropertyPath];\n        }\n        var dataLabelText = text;\n        var projectionType = this.maps.projectionType;\n        if (isPoint) {\n            location = {\n                x: shapePoint[midIndex][index]['x'], y: shapePoint[midIndex][index]['y'],\n                rightMin: 0, rightMax: 0, leftMin: 0, leftMax: 0,\n                points: shapePoint[midIndex][index], topMax: 0, topMin: 0,\n                bottomMax: 0, bottomMin: 0, height: 0\n            };\n        }\n        else {\n            location = findMidPointOfPolygon(shapePoint[midIndex], projectionType, layer.geometryType);\n        }\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var firstLevelMapLocation = location;\n        if (!isNullOrUndefined(text) && !isNullOrUndefined(location)) {\n            if (zoomLabelsPosition && scaleZoomValue > 1 && !this.maps.zoomNotApplied && dataLabel.template === '') {\n                if (layerIndex > 0) {\n                    for (var k = 0; k < this.maps.zoomLabelPositions.length; k++) {\n                        if (this.maps.zoomLabelPositions[k]['dataLabelText'] === text) {\n                            oldIndex = index;\n                            index = k;\n                            sublayerIndexLabel = true;\n                            break;\n                        }\n                    }\n                }\n                locationX = location['x'];\n                locationY = location['y'];\n                location['x'] = ((location['x'] + zoomTransPoint['x']) * scale);\n                location['y'] = ((location['y'] + zoomTransPoint['y']) * scale);\n            }\n            location['y'] = (this.maps.projectionType === 'Mercator') || layer.geometryType === 'Normal' ? location['y'] : (-location['y']);\n            data = location;\n            if (!isNullOrUndefined(this.maps.format) && !isNaN(parseFloat(text))) {\n                if (this.maps.useGroupingSeparator) {\n                    text = Internalize(this.maps, parseFloat(text));\n                    if (!isNullOrUndefined(datasrcObj)) {\n                        datasrcObj[labelpath] = text;\n                    }\n                }\n            }\n            var eventargs_1 = {\n                name: dataLabelRendering, maps: this.maps, cancel: false, border: { color: dataLabel.border.color,\n                    width: dataLabel.border.width, opacity: dataLabel.border.opacity }, datalabel: dataLabel,\n                fill: dataLabel.fill, template: dataLabel.template, text: text\n            };\n            this.maps.trigger('dataLabelRendering', eventargs_1, function (labelArgs) {\n                if (eventargs_1.cancel) {\n                    return;\n                }\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                var border = { color: 'yellow' };\n                var position = [];\n                var width = zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied\n                    && _this.maps.zoomShapeCollection.length > index ? _this.maps.zoomShapeCollection[index]['width'] :\n                    (location['rightMax']['x'] - location['leftMax']['x']) * scale;\n                if (!isNullOrUndefined(_this.maps.dataLabelShape)) {\n                    shapeWidth = firstLevelMapLocation['rightMax']['x'] - firstLevelMapLocation['leftMax']['x'];\n                    _this.maps.dataLabelShape.push(shapeWidth);\n                }\n                if (eventargs_1.text !== text && !eventargs_1.cancel) {\n                    text = eventargs_1.text;\n                }\n                var textSize = measureText(text, style);\n                var trimmedLable = text;\n                var elementSize = textSize;\n                var startY = location['y'] - textSize['height'] / 4;\n                var endY = location['y'] + textSize['height'] / 4;\n                var start = ((location['y'] + transPoint['y']) * scale) - textSize['height'] / 4;\n                var end = ((location['y'] + transPoint['y']) * scale) + textSize['height'] / 4;\n                position = filter(shapePoint[midIndex], startY, endY);\n                if (!isPoint && position.length > 5 && (shapeData['geometry']['type'] !== 'MultiPolygon') &&\n                    (shapeData['type'] !== 'MultiPolygon')) {\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    var location1 = findMidPointOfPolygon(position, projectionType, layer.geometryType);\n                    if (zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied && eventargs_1.template === '') {\n                        location1['x'] = ((_this.maps.zoomLabelPositions[index]['location']['x'] + zoomTransPoint['x']) * scale);\n                        location1['y'] = ((_this.maps.zoomLabelPositions[index]['location']['y'] + zoomTransPoint['y']) * scale);\n                    }\n                    locationX = location1['x'];\n                    location['x'] = location1['x'];\n                    width = zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied\n                        && _this.maps.zoomShapeCollection.length > index ? _this.maps.zoomShapeCollection[index]['width'] :\n                        (location1['rightMax']['x'] - location1['leftMax']['x']) * scale;\n                }\n                var xpositionEnds = ((location['x'] + transPoint['x']) * scale) + textSize['width'] / 2;\n                var xpositionStart = ((location['x'] + transPoint['x']) * scale) - textSize['width'] / 2;\n                _this.value[index] = { rightWidth: xpositionEnds, leftWidth: xpositionStart, heightTop: start, heightBottom: end };\n                var labelElement;\n                if (eventargs_1.template !== '') {\n                    templateFn = getTemplateFunction(eventargs_1.template);\n                    var templateElement = templateFn ? templateFn(!isNullOrUndefined(datasrcObj) ?\n                        datasrcObj : shapeData['properties'], _this.maps, eventargs_1.template, _this.maps.element.id + '_LabelTemplate', false) : document.createElement('div');\n                    templateElement.innerHTML = !templateFn ? eventargs_1.template : '';\n                    labelElement = convertElementFromLabel(templateElement, labelId, !isNullOrUndefined(datasrcObj) ? datasrcObj : shapeData['properties'], index, _this.maps);\n                    labelElement.style.left = ((Math.abs(_this.maps.baseMapRectBounds['min']['x'] - location['x'])) * scale) + 'px';\n                    labelElement.style.top = ((Math.abs(_this.maps.baseMapRectBounds['min']['y'] - location['y'])) * scale) + 'px';\n                    labelTemplateElement.appendChild(labelElement);\n                }\n                else {\n                    if (dataLabelSettings.smartLabelMode === 'Trim') {\n                        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                        var textType = typeof text === 'number' ? text.toString() : text;\n                        trimmedLable = textTrim(width, textType, style);\n                        elementSize = measureText(trimmedLable, style);\n                        options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', trimmedLable, '', '');\n                    }\n                    if (dataLabelSettings.smartLabelMode === 'None') {\n                        options = new TextOption(labelId, (textLocation.x), textLocation.y, 'middle', text, '', '');\n                    }\n                    if (dataLabelSettings.smartLabelMode === 'Hide') {\n                        text = (width >= textSize['width']) ? text : '';\n                        options = new TextOption(labelId, (textLocation.x), (textLocation.y), 'middle', text, '', '');\n                    }\n                    text = options['text'];\n                    if (dataLabelSettings.intersectionAction === 'Hide') {\n                        for (var i = 0; i < intersect.length; i++) {\n                            if (!isNullOrUndefined(intersect[i])) {\n                                if (!(_this.value[index]['leftWidth'] > intersect[i]['rightWidth']\n                                    || _this.value[index]['rightWidth'] < intersect[i]['leftWidth']\n                                    || _this.value[index]['heightTop'] > intersect[i]['heightBottom']\n                                    || _this.value[index]['heightBottom'] < intersect[i]['heightTop'])) {\n                                    text = '';\n                                    break;\n                                }\n                            }\n                        }\n                        intersect.push(_this.value[index]);\n                        options = new TextOption(labelId, textLocation.x, textLocation.y, 'middle', text, '', '');\n                    }\n                    var difference = void 0;\n                    if (dataLabelSettings.intersectionAction === 'Trim') {\n                        for (var j = 0; j < intersect.length; j++) {\n                            if (!isNullOrUndefined(intersect[j])) {\n                                if (intersect[j]['rightWidth'] < _this.value[index]['leftWidth']\n                                    || intersect[j]['leftWidth'] > _this.value[index]['rightWidth']\n                                    || intersect[j]['heightBottom'] < _this.value[index]['heightTop']\n                                    || intersect[j]['heightTop'] > _this.value[index]['heightBottom']) {\n                                    trimmedLable = text;\n                                    difference = 0;\n                                }\n                                else {\n                                    if (_this.value[index]['leftWidth'] > intersect[j]['leftWidth']) {\n                                        width = intersect[j]['rightWidth'] - _this.value[index]['leftWidth'];\n                                        difference = width - (_this.value[index]['rightWidth'] - _this.value[index]['leftWidth']);\n                                        trimmedLable = textTrim(difference, text, style);\n                                        break;\n                                    }\n                                    if (_this.value[index]['leftWidth'] < intersect[j]['leftWidth']) {\n                                        width = _this.value[index]['rightWidth'] - intersect[j]['leftWidth'];\n                                        difference = Math.abs(width - (_this.value[index]['rightWidth'] - _this.value[index]['leftWidth']));\n                                        trimmedLable = textTrim(difference, text, style);\n                                        break;\n                                    }\n                                }\n                            }\n                        }\n                        elementSize = measureText(trimmedLable, style);\n                        intersect.push(_this.value[index]);\n                        options = new TextOption(labelId, textLocation.x, (textLocation.y), 'middle', trimmedLable, '', '');\n                    }\n                    if (dataLabelSettings.intersectionAction === 'None') {\n                        options = new TextOption(labelId, (textLocation.x), (textLocation.y), 'middle', text, '', '');\n                    }\n                    if (trimmedLable.length > 1) {\n                        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                        var border_1 = eventargs_1.border;\n                        if (border_1['width'] > 1) {\n                            var fill = eventargs_1.fill;\n                            var opacity = dataLabelSettings.opacity;\n                            var rx = dataLabelSettings.rx;\n                            var ry = dataLabelSettings.ry;\n                            var x = void 0;\n                            var y = void 0;\n                            var padding = 5;\n                            if (zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied) {\n                                x = ((location['x'])) - textSize['width'] / 2;\n                                y = ((location['y'])) - textSize['height'] / 2 - padding;\n                            }\n                            else {\n                                x = ((location['x'] + transPoint['x']) * scale) - textSize['width'] / 2;\n                                y = ((location['y'] + transPoint['y']) * scale) - textSize['height'] / 2;\n                            }\n                            border_1.opacity = isNullOrUndefined(border_1.opacity) ? opacity : border_1.opacity;\n                            var rectOptions = new RectOption(_this.maps.element.id + '_LayerIndex_' + layerIndex + '_shapeIndex_' + index + '_rectIndex_' + index, fill, border_1, opacity, new Rect(x, y, textSize['width'], textSize['height']), rx, ry);\n                            var rect = _this.maps.renderer.drawRectangle(rectOptions);\n                            group.appendChild(rect);\n                        }\n                    }\n                    element = renderTextElement(options, style, style.color || _this.maps.themeStyle.dataLabelFontColor, group);\n                    if (zoomLabelsPosition && scaleZoomValue > 1 && !_this.maps.zoomNotApplied) {\n                        element.setAttribute('transform', 'translate( ' + ((location['x'])) + ' '\n                            + (((location['y']))) + ' )');\n                        location['x'] = locationX;\n                        location['y'] = locationY;\n                    }\n                    else {\n                        element.setAttribute('transform', 'translate( ' + ((location['x'] + transPoint.x) * scale) + ' '\n                            + (((location['y'] + transPoint.y) * scale) + (elementSize.height / 4)) + ' )');\n                    }\n                    group.appendChild(element);\n                }\n                _this.dataLabelCollections.push({\n                    location: { x: location['x'], y: location['y'] },\n                    element: isNullOrUndefined(labelElement) ? element : labelElement,\n                    layerIndex: layerIndex,\n                    shapeIndex: sublayerIndexLabel ? oldIndex : index,\n                    labelIndex: sublayerIndexLabel ? oldIndex : index,\n                    dataLabelText: dataLabelText\n                });\n                if (labelTemplateElement.childElementCount > 0 && !_this.maps.element.contains(labelTemplateElement)) {\n                    document.getElementById(_this.maps.element.id + '_Secondary_Element').appendChild(labelTemplateElement);\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    _this.maps.renderReactTemplates();\n                }\n            });\n        }\n    };\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    DataLabel.prototype.getPoint = function (shapes, points) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        shapes.map(function (current, index) {\n            points.push(new Point(current['point']['x'], current['point']['y']));\n        });\n        return points;\n    };\n    /**\n     * Get module name.\n     *\n     * @returns {string} - Returns the module name.\n     */\n    DataLabel.prototype.getModuleName = function () {\n        return 'DataLabel';\n    };\n    /**\n     * To destroy the layers.\n     *\n     * @param {Maps} maps - Specifies the instance of the maps.\n     * @returns {void}\n     * @private\n     */\n    DataLabel.prototype.destroy = function (maps) {\n        /**\n         * Destroy method performed here\n         */\n    };\n    return DataLabel;\n}());\nexport { DataLabel };\n"]},"metadata":{},"sourceType":"module"}