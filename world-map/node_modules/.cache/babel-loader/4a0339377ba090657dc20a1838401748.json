{"ast":null,"code":"import { click, legendRendering } from '../index';\nimport { Rect, measureText, PathOption, textTrim, drawBalloon, removeClass, querySelector, getTemplateFunction, maintainStyleClass, getValueFromObject } from '../utils/helper';\nimport { RectOption, Size, TextOption, Point, renderTextElement, drawSymbol, checkPropertyPath, getElement } from '../utils/helper';\nimport { isNullOrUndefined, Browser, EventHandler, remove, extend } from '@syncfusion/ej2-base';\n/**\n * Legend module is used to render legend for the maps\n */\n\nvar Legend =\n/** @class */\nfunction () {\n  function Legend(maps) {\n    /**\n     * @private\n     */\n    this.legendBorderRect = new Rect(0, 0, 0, 0);\n    /**\n     * @private\n     */\n\n    this.legendTotalRect = new Rect(0, 0, 0, 0);\n    /**\n     * @private\n     */\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    this.totalPages = [];\n    this.page = 0;\n    /**\n     * @private\n     */\n\n    this.currentPage = 0;\n    this.legendItemRect = new Rect(0, 0, 0, 0);\n    this.heightIncrement = 0;\n    this.widthIncrement = 0;\n    this.textMaxWidth = 0; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    this.shapeHighlightCollection = [];\n    /**\n     * @private\n     */\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    this.legendHighlightCollection = [];\n    /**\n     * @private\n     */\n\n    this.shapePreviousColor = [];\n    /**\n     * @private\n     */\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    this.selectedNonLegendShapes = [];\n    /**\n     * @private\n     */\n\n    this.shapeToggled = true;\n    /**\n     * @private\n     */\n\n    this.legendElement = null;\n    this.maps = maps;\n    this.addEventListener();\n  }\n  /**\n   * To calculate legend bounds and draw the legend shape and text.\n   *\n   * @returns {void}\n   */\n\n\n  Legend.prototype.renderLegend = function () {\n    this.legendRenderingCollections = [];\n    this.legendCollection = [];\n    this.totalPages = [];\n    this.widthIncrement = 0;\n    this.heightIncrement = 0;\n    this.defsElement = this.maps.renderer.createDefs();\n    this.maps.svgObject.appendChild(this.defsElement);\n    this.calculateLegendBounds();\n    this.drawLegend();\n  };\n\n  Legend.prototype.calculateLegendBounds = function () {\n    var _this = this;\n\n    var map = this.maps;\n    var legend = map.legendSettings;\n    this.legendCollection = [];\n    var spacing = 10;\n    var leftPadding = 10;\n    var topPadding = map.mapAreaRect.y;\n    this.legendRenderingCollections = [];\n    Array.prototype.forEach.call(map.layersCollection, function (layer, layerIndex) {\n      if (!isNullOrUndefined(layer.shapeData)) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var layerData = layer.shapeData['features'];\n        var dataPath = layer.shapeDataPath;\n        var propertyPath = layer.shapePropertyPath; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n        var dataSource = layer.dataSource;\n        var colorValuePath = void 0;\n        var colorMapping = void 0;\n\n        if (legend.type === 'Layers' && layer.visible) {\n          colorValuePath = layer.shapeSettings.colorValuePath;\n          colorMapping = layer.shapeSettings.colorMapping;\n\n          _this.getLegends(layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath);\n        } else if (legend.type === 'Bubbles') {\n          for (var _i = 0, _a = layer.bubbleSettings; _i < _a.length; _i++) {\n            var bubble = _a[_i];\n\n            if (bubble.visible) {\n              colorValuePath = bubble.colorValuePath;\n              colorMapping = bubble.colorMapping; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n              dataSource = bubble.dataSource;\n\n              _this.getLegends(layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath);\n            }\n          }\n        } else {\n          _this.getMarkersLegendCollections(layerIndex, layer.markerSettings);\n        }\n      }\n    });\n\n    if (this.legendCollection.length > 0) {\n      for (var i = 0; i < this.legendCollection.length; i++) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var legendItem = this.legendCollection[i];\n        var eventArgs = {\n          name: legendRendering,\n          cancel: false,\n          fill: legendItem['fill'],\n          shape: legend.shape,\n          shapeBorder: legend.shapeBorder,\n          text: typeof legendItem['text'] === 'number' ? legendItem['text'].toString() : legendItem['text']\n        };\n        map.trigger('legendRendering', eventArgs);\n        legendItem['fill'] = eventArgs.fill;\n        legendItem['shape'] = eventArgs.shape;\n        legendItem['shapeBorder'] = eventArgs.shapeBorder;\n        legendItem['text'] = eventArgs.text;\n\n        if (eventArgs.cancel) {\n          this.legendCollection.splice(i, 1);\n          i--;\n        }\n      }\n    }\n\n    var defaultSize = 25;\n    var legendTitle = map.legendSettings.title.text;\n    var titleTextStyle = map.legendSettings.titleStyle;\n\n    if (this.legendCollection.length > 0) {\n      var legendMode = legend.mode;\n      var shapeX = 0;\n      var shapeY = 0;\n      var textX = 0;\n      var textY = 0;\n      var shapePadding = legend.shapePadding;\n      var textPadding = 10;\n      var shapeHeight = legend.shapeHeight;\n      var shapeWidth = legend.shapeWidth;\n      var shapeLocation = [];\n      var textLocation = [];\n      var legendRectCollection = [];\n      var location_1;\n      var position = legend.position;\n      var labelAction = legend.labelDisplayMode;\n      var arrangement = legend.orientation === 'None' ? position === 'Top' || position === 'Bottom' ? 'Horizontal' : 'Vertical' : legend.orientation;\n      var legendWidth = legend.width.length > 1 ? legend.width.indexOf('%') > -1 ? map.availableSize.width / 100 * parseInt(legend.width, 10) : parseInt(legend.width, 10) : null;\n      var legendHeight = legend.height.length > 1 ? legend.height.indexOf('%') > -1 ? map.availableSize.height / 100 * parseInt(legend.height, 10) : parseInt(legend.height, 10) : null;\n      var legendItemStartX_1;\n      var legendItemStartY_1;\n      var startX = 0;\n      var startY = 0;\n      var legendtitleSize = measureText(legendTitle, titleTextStyle);\n\n      if (legendMode === 'Interactive') {\n        var itemTextStyle = legend.textStyle;\n        var legendLength = this.legendCollection.length;\n        var rectWidth = arrangement === 'Horizontal' ? isNullOrUndefined(legendWidth) ? map.mapAreaRect.width / legendLength : legendWidth / legendLength : isNullOrUndefined(legendWidth) ? defaultSize : legendWidth;\n        var rectHeight = arrangement === 'Horizontal' ? isNullOrUndefined(legendHeight) ? defaultSize : legendHeight : isNullOrUndefined(legendHeight) ? map.mapAreaRect.height / legendLength : legendHeight / legendLength;\n        startX = 0;\n        startY = legendtitleSize.height + spacing;\n        var position_1 = legend.labelPosition;\n        var textX_1 = 0;\n        var textY_1 = 0;\n        var textPadding_1 = 10;\n        var itemStartX = 0;\n        var itemStartY = 0;\n        var maxTextHeight = 0;\n        var maxTextWidth = 0;\n\n        for (var i = 0; i < this.legendCollection.length; i++) {\n          startX = arrangement === 'Horizontal' ? startX + rectWidth : startX;\n          startY = arrangement === 'Horizontal' ? startY : startY + rectHeight;\n          var legendText = this.legendCollection[i]['text'];\n          var itemTextSize = new Size(0, 0);\n\n          if (labelAction === 'None') {\n            itemTextSize = measureText(legendText, itemTextStyle);\n          } else if (labelAction === 'Trim') {\n            legendText = textTrim(arrangement === 'Horizontal' ? rectWidth : rectHeight, legendText, itemTextStyle);\n            itemTextSize = measureText(legendText, itemTextStyle);\n          } else {\n            legendText = '';\n          }\n\n          maxTextHeight = Math.max(maxTextHeight, itemTextSize.height);\n          maxTextWidth = Math.max(maxTextWidth, itemTextSize.width);\n\n          if (itemTextSize.width > 0 && itemTextSize.height > 0) {\n            if (arrangement === 'Horizontal') {\n              textX_1 = startX + rectWidth / 2;\n              textY_1 = position_1 === 'After' ? startY + rectHeight + itemTextSize.height / 2 + textPadding_1 : startY - textPadding_1;\n            } else {\n              textX_1 = position_1 === 'After' ? startX - itemTextSize.width / 2 - textPadding_1 : startX + rectWidth + itemTextSize.width / 2 + textPadding_1;\n              textY_1 = startY + rectHeight / 2 + itemTextSize.height / 4;\n            }\n          }\n\n          if (i === 0) {\n            itemStartX = arrangement === 'Horizontal' ? startX : position_1 === 'After' ? textX_1 - itemTextSize.width / 2 : startX;\n            itemStartY = arrangement === 'Horizontal' ? position_1 === 'After' ? startY : textY_1 - itemTextSize.height / 2 : startY;\n\n            if (this.legendCollection.length === 1) {\n              legendWidth = arrangement === 'Horizontal' ? Math.abs(startX + rectWidth - itemStartX) : rectWidth + maxTextWidth + textPadding_1;\n              legendHeight = arrangement === 'Horizontal' ? rectHeight + maxTextHeight / 2 + textPadding_1 : Math.abs(startY + rectHeight - itemStartY);\n            }\n          } else if (i === this.legendCollection.length - 1) {\n            legendWidth = arrangement === 'Horizontal' ? Math.abs(startX + rectWidth - itemStartX) : rectWidth + maxTextWidth + textPadding_1;\n            legendHeight = arrangement === 'Horizontal' ? rectHeight + maxTextHeight / 2 + textPadding_1 : Math.abs(startY + rectHeight - itemStartY);\n          }\n\n          this.legendRenderingCollections.push({\n            fill: this.legendCollection[i]['fill'],\n            x: startX,\n            y: startY,\n            width: rectWidth,\n            height: rectHeight,\n            text: legendText,\n            textX: textX_1,\n            textY: textY_1,\n            textWidth: itemTextSize.width,\n            textHeight: itemTextSize.height,\n            shapeBorder: this.legendCollection[i]['shapeBorder']\n          });\n        }\n\n        if (this.legendCollection.length === 1) {\n          legendHeight = rectHeight;\n          legendWidth = rectWidth;\n        }\n\n        this.legendItemRect = {\n          x: itemStartX,\n          y: itemStartY,\n          width: legendWidth,\n          height: legendHeight\n        };\n      } else {\n        legendWidth = isNullOrUndefined(legendWidth) ? map.mapAreaRect.width : legendWidth;\n        legendHeight = isNullOrUndefined(legendHeight) ? map.mapAreaRect.height : legendHeight;\n        var j = 0;\n        this.page = 0;\n\n        for (var i = 0; i < this.legendCollection.length; i++) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          var legendItem = this.legendCollection[i];\n\n          if (isNullOrUndefined(this.totalPages[this.page])) {\n            this.totalPages[this.page] = {\n              Page: this.page + 1,\n              Collection: []\n            };\n          }\n\n          var legendTextSize = measureText(legendItem['text'], legend.textStyle);\n          this.textMaxWidth = Math.max(this.textMaxWidth, legendTextSize.width);\n\n          if (i === 0) {\n            startX = shapeX = leftPadding + shapeWidth / 2;\n            startY = shapeY = topPadding + legendtitleSize.height + (shapeHeight > legendTextSize.height ? shapeHeight / 2 : legendTextSize.height / 4);\n          } else {\n            var maxSize = legendTextSize.height > shapeHeight ? legendTextSize.height : shapeHeight;\n\n            if (arrangement === 'Horizontal') {\n              var prvePositionX = textLocation[j - 1].x + textLocation[j - 1].width + textPadding + shapeWidth;\n\n              if (prvePositionX + shapePadding + legendTextSize.width > legendWidth) {\n                var nextPositionY = (textLocation[j - 1].y > shapeLocation[j - 1].y + shapeHeight / 2 ? textLocation[j - 1].y : shapeLocation[j - 1].y + shapeHeight / 2) + topPadding;\n\n                if (nextPositionY + maxSize > legendHeight) {\n                  this.getPageChanged();\n                  j = 0;\n                  shapeLocation = [];\n                  textLocation = [];\n                  legendRectCollection = [];\n                  shapeX = startX;\n                  shapeY = startY;\n                } else {\n                  shapeX = shapeLocation[0].x;\n                  shapeY = nextPositionY + maxSize / 2;\n                }\n              } else {\n                shapeX = prvePositionX - shapeWidth / 2;\n                shapeY = shapeLocation[j - 1].y;\n              }\n            } else {\n              var prevPositionY = textLocation[j - 1].y > shapeLocation[j - 1].y + shapeHeight / 2 ? textLocation[j - 1].y : shapeLocation[j - 1].y + shapeHeight / 2;\n\n              if (prevPositionY + topPadding + maxSize > legendHeight) {\n                var nextPositionX = textLocation[j - 1].x + this.textMaxWidth + textPadding;\n\n                if (nextPositionX + shapePadding + legendTextSize.width > legendWidth) {\n                  shapeX = startX;\n                  shapeY = startY;\n                  legendRectCollection = [];\n                  textLocation = [];\n                  shapeLocation = [];\n                  this.getPageChanged();\n                  j = 0;\n                } else {\n                  shapeX = nextPositionX + shapeWidth / 2;\n                  shapeY = shapeLocation[0].y;\n                }\n              } else {\n                shapeX = shapeLocation[j - 1].x;\n                shapeY = prevPositionY + topPadding + shapeHeight / 2;\n              }\n            }\n          }\n\n          textX = shapeX + shapeWidth / 2 + shapePadding;\n          textY = shapeY + legendTextSize.height / 4;\n          shapeLocation.push({\n            x: shapeX,\n            y: shapeY\n          });\n          textLocation.push({\n            x: textX,\n            y: textY,\n            width: legendTextSize.width,\n            height: legendTextSize.height / 2\n          }); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n          this.totalPages[this.page]['Collection'].push({\n            DisplayText: legendItem['text'],\n            ImageSrc: legendItem['imageSrc'],\n            Shape: {\n              x: shapeX,\n              y: shapeY\n            },\n            Text: {\n              x: textX,\n              y: textY\n            },\n            Fill: legendItem['fill'],\n            legendShape: legendItem['shape'],\n            shapeBorder: legendItem['shapeBorder'],\n            idIndex: i,\n            Rect: {\n              x: shapeLocation[j].x - shapeWidth / 2,\n              y: shapeLocation[j].y - shapeHeight / 2 < textY - legendTextSize.height ? shapeLocation[j].y - shapeHeight / 2 : textY - legendTextSize.height,\n              width: Math.abs(shapeLocation[j].x - shapeWidth / 2 - (textX + legendTextSize.width)),\n              height: shapeHeight > legendTextSize.height ? shapeHeight : legendTextSize.height\n            }\n          });\n          j++;\n        } // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n        var collection = this.totalPages[0]['Collection']; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n        Array.prototype.forEach.call(collection, function (legendObj, index) {\n          var legendRect = new Rect(legendObj['Rect']['x'], legendObj['Rect']['y'], legendObj['Rect']['width'], legendObj['Rect']['height']);\n\n          if (index === 0) {\n            legendItemStartX_1 = legendRect.x;\n            legendItemStartY_1 = legendRect.y;\n          }\n\n          _this.widthIncrement = Math.max(_this.widthIncrement, Math.abs(legendItemStartX_1 - (legendRect.x + legendRect.width)));\n          _this.heightIncrement = Math.max(_this.heightIncrement, Math.abs(legendItemStartY_1 - (legendRect.y + legendRect.height)));\n        });\n        legendWidth = this.widthIncrement < legendWidth ? this.widthIncrement : legendWidth;\n        legendHeight = this.heightIncrement < legendHeight ? this.heightIncrement : legendHeight;\n        this.legendItemRect = {\n          x: collection[0]['Rect']['x'],\n          y: collection[0]['Rect']['y'],\n          width: legendWidth,\n          height: legendHeight\n        };\n      }\n    }\n  };\n  /**\n   * Get the legend collections\n   *\n   * @param {number} layerIndex - Specifies the layer index\n   * @param {object[]} layerData - Specifies the layer data\n   * @param {ColorMappingSettings[]} colorMapping - Specifies the color mapping\n   * @param {object[]} dataSource - Specifies the data source\n   * @param {string} dataPath - Specifies the data path\n   * @param {string} colorValuePath - Specifies the color value path\n   * @param {string | string[]} propertyPath - Specifies the property path\n   * @returns {void}\n   */\n\n\n  Legend.prototype.getLegends = function ( // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath) {\n    this.getRangeLegendCollection(layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath);\n    this.getEqualLegendCollection(layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath);\n    this.getDataLegendCollection(layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath);\n  };\n\n  Legend.prototype.getPageChanged = function () {\n    this.page++;\n\n    if (isNullOrUndefined(this.totalPages[this.page])) {\n      this.totalPages[this.page] = {\n        Page: this.page + 1,\n        Collection: []\n      };\n    }\n  };\n\n  Legend.prototype.legendTextTrim = function (maxWidth, text, font, legendRectSize) {\n    var label = text;\n    var size = measureText(text, font).width;\n    var legendWithoutTextSize = legendRectSize - size;\n\n    if (legendRectSize > maxWidth) {\n      var textLength = text.length;\n\n      for (var i = textLength - 1; i >= 0; --i) {\n        label = text.substring(0, i) + '...';\n        size = measureText(label, font).width;\n        var totalSize = legendWithoutTextSize + size;\n\n        if (totalSize <= maxWidth || label.length < 4) {\n          if (label.length < 4) {\n            label = ' ';\n          }\n\n          return label;\n        }\n      }\n    }\n\n    return label;\n  }; // eslint-disable-next-line valid-jsdoc\n\n  /**\n   * To draw the legend shape and text.\n   */\n\n\n  Legend.prototype.drawLegend = function () {\n    var map = this.maps;\n    var legend = map.legendSettings;\n    var render = map.renderer;\n    var textOptions;\n    var textFont = legend.textStyle;\n    this.legendGroup = render.createGroup({\n      id: map.element.id + '_Legend_Group'\n    });\n\n    if (legend.mode === 'Interactive') {\n      for (var i = 0; i < this.legendRenderingCollections.length; i++) {\n        var itemId = map.element.id + '_Legend_Index_' + i;\n        var textId = map.element.id + '_Legend_Index_' + i + '_Text'; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n        var item = this.legendRenderingCollections[i];\n        var bounds = new Rect(item['x'], item['y'], item['width'], item['height']);\n\n        if (i === 0) {\n          this.renderLegendBorder();\n        }\n\n        var textLocation = new Point(item['textX'], item['textY']);\n        textFont.color = textFont.color !== null ? textFont.color : this.maps.themeStyle.legendTextColor;\n        var rectOptions = new RectOption(itemId, item['fill'], item['shapeBorder'], legend.opacity, bounds);\n        textOptions = new TextOption(textId, textLocation.x, textLocation.y, 'middle', item['text'], '', '');\n        textFont.fontFamily = map.themeStyle.fontFamily || textFont.fontFamily;\n        textFont.size = map.themeStyle.legendFontSize || textFont.size;\n        renderTextElement(textOptions, textFont, textFont.color, this.legendGroup);\n        this.legendGroup.appendChild(render.drawRectangle(rectOptions));\n        this.legendToggle();\n      }\n    } else {\n      this.drawLegendItem(this.currentPage);\n    }\n  };\n  /**\n   * @param {string} page - Specifies the legend page.\n   * @returns {void}\n   * @private\n   */\n\n\n  Legend.prototype.drawLegendItem = function (page) {\n    var map = this.maps;\n    var legend = map.legendSettings;\n    var spacing = 10;\n    var shapeSize = new Size(legend.shapeWidth, legend.shapeHeight);\n    var textOptions;\n    var renderOptions;\n    var render = map.renderer;\n    var legendShape = legend.shape;\n\n    if (page >= 0 && page < this.totalPages.length) {\n      if (querySelector(this.legendGroup.id, this.maps.element.id)) {\n        remove(querySelector(this.legendGroup.id, this.maps.element.id));\n      } // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n      for (var i = 0; i < this.totalPages[page]['Collection'].length; i++) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var collection = this.totalPages[page]['Collection'][i];\n        var shapeBorder = collection['shapeBorder'];\n        var legendElement = render.createGroup({\n          id: map.element.id + '_Legend_Index_' + collection['idIndex']\n        });\n        var legendText = collection['DisplayText'];\n        var pagingArrowPadding = 4;\n        var shape = legend.type === 'Markers' ? isNullOrUndefined(collection['ImageSrc']) ? legend.shape : 'Image' : collection['legendShape'];\n        var strokeColor = legend.shape === 'HorizontalLine' || legend.shape === 'VerticalLine' || legend.shape === 'Cross' ? isNullOrUndefined(legend.fill) ? '#000000' : legend.fill : shapeBorder.color;\n        var strokeWidth = legend.shape === 'HorizontalLine' || legend.shape === 'VerticalLine' || legend.shape === 'Cross' ? shapeBorder.width === 0 ? 1 : shapeBorder.width : shapeBorder.width;\n        var shapeId = map.element.id + '_Legend_Shape_Index_' + collection['idIndex'];\n        var textId = map.element.id + '_Legend_Text_Index_' + collection['idIndex'];\n        var shapeLocation = new Point(collection['Shape']['x'], collection['Shape']['y'] - pagingArrowPadding);\n        var textLocation = new Point(collection['Text']['x'], collection['Text']['y'] - pagingArrowPadding);\n        var imageUrl = isNullOrUndefined(collection['ImageSrc']) ? legend.shape : collection['ImageSrc'];\n        var renderOptions_1 = new PathOption(shapeId, collection['Fill'], strokeWidth, strokeColor, legend.opacity, isNullOrUndefined(shapeBorder.opacity) ? legend.opacity : shapeBorder.opacity, '');\n        var legendTextStyle = {\n          fontFamily: legend.textStyle.fontFamily,\n          fontStyle: legend.textStyle.fontStyle,\n          fontWeight: legend.textStyle.fontWeight,\n          size: legend.textStyle.size,\n          color: legend.textStyle.color,\n          opacity: legend.textStyle.opacity\n        };\n        legendTextStyle.color = legendTextStyle.color !== null ? legendTextStyle.color : this.maps.themeStyle.legendTextColor;\n        legendTextStyle.fontFamily = map.themeStyle.fontFamily || legendTextStyle.fontFamily;\n        legendTextStyle.size = map.themeStyle.legendFontSize || legendTextStyle.size;\n\n        if (i === 0) {\n          this.renderLegendBorder();\n        }\n\n        if (legend.type === 'Markers' && legend.useMarkerShape) {\n          var legendShapeData = this.legendCollection[collection['idIndex']].data[0];\n          var marker = map.layers[legendShapeData['layerIndex']].markerSettings[legendShapeData['markerIndex']];\n          legendShape = !isNullOrUndefined(marker.dataSource[legendShapeData['dataIndex']][marker['shapeValuePath']]) && marker.dataSource[legendShapeData['dataIndex']][marker['shapeValuePath']] !== '' ? marker.dataSource[legendShapeData['dataIndex']][marker['shapeValuePath']] : marker.shape;\n        }\n\n        if (legendShape === \"Balloon\") {\n          legendElement.appendChild(drawBalloon(map, renderOptions_1, shapeSize, {\n            x: shapeLocation.x,\n            y: shapeLocation.y + 5\n          }, 'Legend'));\n        } else {\n          legendElement.appendChild(drawSymbol(shapeLocation, legendShape, shapeSize, collection['ImageSrc'], renderOptions_1));\n        }\n\n        var legendRectSize = collection['Rect']['x'] + collection['Rect']['width'];\n\n        if (legendRectSize > this.legendBorderRect.width) {\n          var trimmedText = this.legendTextTrim(this.legendBorderRect.width, legendText, legendTextStyle, legendRectSize);\n          legendText = trimmedText;\n        }\n\n        textOptions = new TextOption(textId, textLocation.x, textLocation.y, 'start', legendText, '', '');\n        renderTextElement(textOptions, legendTextStyle, legendTextStyle.color, legendElement);\n        this.legendGroup.appendChild(legendElement); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n        if (i === this.totalPages[page]['Collection'].length - 1) {\n          var pagingGroup = void 0;\n          var width = spacing;\n          var height = spacing / 2;\n\n          if (this.page !== 0) {\n            var pagingText = page + 1 + '/' + this.totalPages.length;\n            var pagingFont = legend.textStyle;\n            var pagingTextSize = measureText(pagingText, pagingFont);\n            var leftPageX = this.legendItemRect.x + this.legendItemRect.width - pagingTextSize.width - width * 2 - spacing * 2 + pagingArrowPadding / 2;\n            var rightPageX = this.legendItemRect.x + this.legendItemRect.width;\n            var pageTextX = rightPageX - width - pagingTextSize.width / 2 - spacing / 2 - pagingArrowPadding;\n            var locY = this.legendItemRect.y + this.legendItemRect.height + height / 2 + spacing;\n            pagingGroup = render.createGroup({\n              id: map.element.id + '_Legend_Paging_Group'\n            });\n            var leftPageElement = render.createGroup({\n              id: map.element.id + '_Legend_Left_Paging_Group'\n            });\n            var rightPageElement = render.createGroup({\n              id: map.element.id + '_Legend_Right_Paging_Group'\n            });\n            var rightPath = ' M ' + rightPageX + ' ' + locY + ' L ' + (rightPageX - width) + ' ' + (locY - height) + ' L ' + (rightPageX - width) + ' ' + (locY + height) + ' z ';\n            var leftPath = ' M ' + leftPageX + ' ' + locY + ' L ' + (leftPageX + width) + ' ' + (locY - height) + ' L ' + (leftPageX + width) + ' ' + (locY + height) + ' z ';\n            var leftPageOptions = new PathOption(map.element.id + '_Left_Page', '#a6a6a6', 0, '#a6a6a6', page + 1 === 1 ? 0.5 : 1, 1, '', leftPath);\n            leftPageElement.appendChild(render.drawPath(leftPageOptions));\n            var leftRectPageOptions = new RectOption(map.element.id + '_Left_Page_Rect', 'transparent', {}, 1, new Rect(leftPageX - width / 2, locY - height * 2, width * 2, spacing * 2), null, null, '', '');\n            var pathEle = render.drawRectangle(leftRectPageOptions);\n            pathEle.setAttribute('tabindex', (page + 1 === 1 ? -1 : map.tabIndex + 1).toString());\n            leftPageElement.appendChild(pathEle);\n            this.wireEvents(leftPageElement);\n            var rightPageOptions = new PathOption(map.element.id + '_Right_Page', '#a6a6a6', 0, '#a6a6a6', page + 1 === this.totalPages.length ? 0.5 : 1, 1, '', rightPath);\n            rightPageElement.appendChild(render.drawPath(rightPageOptions));\n            var rightRectPageOptions = new RectOption(map.element.id + '_Right_Page_Rect', 'transparent', {}, 1, new Rect(rightPageX - spacing - width / 2, locY - height * 2, width * 2, spacing * 2), null, null, '', '');\n            pathEle = render.drawRectangle(rightRectPageOptions);\n            pathEle.setAttribute('tabindex', (page + 1 === this.totalPages.length ? -1 : map.tabIndex + 2).toString());\n            rightPageElement.appendChild(pathEle);\n            this.wireEvents(rightPageElement);\n            pagingGroup.appendChild(leftPageElement);\n            pagingGroup.appendChild(rightPageElement); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n            var pageTextOptions = {\n              'id': map.element.id + '_Paging_Text',\n              'x': pageTextX,\n              'y': locY + pagingTextSize.height / 4,\n              'fill': '#a6a6a6',\n              'font-size': '14px',\n              'font-style': pagingFont.fontStyle,\n              'font-family': pagingFont.fontFamily,\n              'font-weight': pagingFont.fontWeight,\n              'text-anchor': 'middle',\n              'transform': '',\n              'opacity': 1,\n              'dominant-baseline': ''\n            };\n            pagingGroup.appendChild(render.createText(pageTextOptions, pagingText));\n            this.legendGroup.appendChild(pagingGroup);\n          }\n\n          this.legendToggle();\n        }\n      }\n    }\n  };\n\n  Legend.prototype.legendHighLightAndSelection = function (targetElement, value) {\n    var shapeIndex;\n    var layerIndex;\n    var dataIndex;\n    var legend = this.maps.legendSettings;\n    var textEle = legend.mode === 'Default' ? document.getElementById(targetElement.id.replace('Shape', 'Text')) : document.getElementById(targetElement.id + '_Text'); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var collection = this.maps.legendModule.legendCollection;\n    var length;\n    var multiSelectEnable = !isNullOrUndefined(collection[0]['data'][0]['layerIndex']) ? this.maps.layers[collection[0]['data'][0]['layerIndex']].selectionSettings.enableMultiSelect : false;\n    var selectLength = 0;\n    var interactProcess = true;\n    var idIndex = parseFloat(targetElement.id.charAt(targetElement.id.length - 1));\n    this.updateLegendElement();\n    var toggleLegendCheck = this.maps.toggledLegendId.indexOf(idIndex);\n\n    if (this.maps.legendSettings.toggleLegendSettings.enable && value === 'highlight' && toggleLegendCheck !== -1) {\n      var collectionIndex = this.getIndexofLegend(this.legendHighlightCollection, targetElement);\n\n      if (collectionIndex !== -1) {\n        this.legendHighlightCollection.splice(collectionIndex, 1);\n      }\n\n      this.removeLegendHighlightCollection();\n      return null;\n    }\n\n    if (value === 'selection') {\n      this.shapeHighlightCollection = [];\n\n      if (!this.maps.shapeSelections && !multiSelectEnable) {\n        this.removeAllSelections();\n        this.maps.shapeSelections = true;\n      }\n\n      if (this.maps.legendSelectionCollection.length > 0 && (!multiSelectEnable ? this.maps.shapeSelections : true)) {\n        for (var k = 0; k < this.maps.legendSelectionCollection.length; k++) {\n          if (targetElement === this.maps.legendSelectionCollection[k]['legendElement']) {\n            this.maps.legendSelectionCollection[k]['legendElement'] = targetElement;\n            interactProcess = false;\n            this.removeLegendSelectionCollection(this.maps.legendSelectionCollection[k]['legendElement']);\n            this.maps.selectedLegendElementId.splice(this.maps.selectedLegendElementId.indexOf(idIndex), 1);\n            this.maps.legendSelectionCollection.splice(k, 1);\n            this.maps.legendSelection = this.maps.legendSelectionCollection.length > 0 ? false : true;\n            break;\n          } else if (!multiSelectEnable) {\n            if (this.maps.legendSelectionCollection.length > 1) {\n              for (var z = 0; z < this.maps.legendSelectionCollection.length; z++) {\n                this.removeLegendSelectionCollection(this.maps.legendSelectionCollection[z]['legendElement']);\n              }\n\n              this.maps.legendSelectionCollection = [];\n            } else {\n              this.removeLegendSelectionCollection(this.maps.legendSelectionCollection[k]['legendElement']);\n              this.maps.legendSelectionCollection.splice(k, 1);\n            }\n          }\n        }\n      }\n    } else {\n      if (this.maps.legendSelectionCollection.length > 0) {\n        for (var k = 0; k < this.maps.legendSelectionCollection.length; k++) {\n          if ((targetElement.id.indexOf('_Legend_Shape') > -1 || targetElement.id.indexOf('_Legend_Index')) && targetElement === this.maps.legendSelectionCollection[k]['legendElement']) {\n            interactProcess = false;\n            break;\n          } else {\n            this.removeLegendHighlightCollection();\n          }\n        }\n      }\n\n      this.removeLegendHighlightCollection();\n    }\n\n    if (interactProcess) {\n      for (var i = 0; i < collection.length; i++) {\n        var idIndex_1 = this.maps.legendSettings.mode === 'Interactive' ? parseFloat(targetElement.id.split('_Legend_Index_')[1]) : parseFloat(targetElement.id.split('_Legend_Shape_Index_')[1]);\n\n        if (textEle.textContent === collection[i]['text'] && collection[i]['data'].length > 0 && idIndex_1 === i) {\n          var layer = this.maps.layers[collection[i]['data'][0]['layerIndex']];\n          var enable = void 0;\n          var module = void 0; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n          var data = void 0;\n\n          if (!isNullOrUndefined(layer)) {\n            enable = value === 'selection' ? layer.selectionSettings.enable : layer.highlightSettings.enable;\n            module = void 0;\n            module = value === 'selection' ? layer.selectionSettings : layer.highlightSettings;\n            data = collection[i]['data'];\n          }\n\n          if (enable) {\n            for (var j = 0; j < data.length; j++) {\n              shapeIndex = data[j]['shapeIndex'];\n              layerIndex = data[j]['layerIndex'];\n              dataIndex = data[j]['dataIndex'];\n              var shapeEle = document.getElementById(this.maps.element.id + '_LayerIndex_' + layerIndex + '_shapeIndex_' + shapeIndex + '_dataIndex_' + dataIndex);\n\n              if (shapeEle !== null) {\n                var shapeMatch = true;\n\n                if (this.maps.legendSelectionCollection !== null) {\n                  for (var i_1 = 0; i_1 < this.maps.legendSelectionCollection.length; i_1++) {\n                    if (this.maps.legendSelectionCollection[i_1]['legendElement'] === targetElement) {\n                      shapeMatch = false;\n                      break;\n                    }\n                  }\n                }\n\n                if (value === 'highlight' && shapeMatch) {\n                  if (j === 0) {\n                    this.legendHighlightCollection = [];\n                    this.pushCollection(targetElement, this.legendHighlightCollection, collection[i], layer.shapeSettings);\n                  }\n\n                  length = this.legendHighlightCollection.length;\n                  var legendHighlightColor = this.legendHighlightCollection[length - 1]['legendOldFill'];\n                  this.legendHighlightCollection[length - 1]['MapShapeCollection']['Elements'].push(shapeEle);\n                  var shapeItemCount = this.legendHighlightCollection[length - 1]['MapShapeCollection']['Elements'].length - 1;\n                  var shapeOldFillColor = shapeEle.getAttribute('fill');\n                  this.legendHighlightCollection[length - 1]['shapeOldFillColor'].push(shapeOldFillColor);\n                  var shapeOldColor = this.legendHighlightCollection[length - 1]['shapeOldFillColor'][shapeItemCount];\n                  this.shapePreviousColor = this.legendHighlightCollection[length - 1]['shapeOldFillColor'];\n                  this.setColor(shapeEle, !isNullOrUndefined(module.fill) ? module.fill : shapeOldColor, module.opacity.toString(), module.border.color, module.border.width.toString(), 'highlight');\n                  this.setColor(targetElement, !isNullOrUndefined(module.fill) ? module.fill : legendHighlightColor, module.opacity.toString(), module.border.color, module.border.width.toString(), 'highlight');\n                } else if (value === 'selection') {\n                  this.legendHighlightCollection = [];\n                  this.maps.legendSelectionClass = module;\n\n                  if (j === 0) {\n                    this.pushCollection(targetElement, this.maps.legendSelectionCollection, collection[i], layer.shapeSettings);\n\n                    if (multiSelectEnable) {\n                      this.maps.selectedLegendElementId.push(i);\n                    } else {\n                      if (this.maps.selectedLegendElementId.length === 0) {\n                        this.maps.selectedLegendElementId.push(i);\n                      } else {\n                        this.maps.selectedLegendElementId = [];\n                        this.maps.selectedLegendElementId.push(i);\n                      }\n                    }\n                  }\n\n                  selectLength = this.maps.legendSelectionCollection.length;\n                  var legendSelectionColor = this.maps.legendSelectionCollection[selectLength - 1]['legendOldFill'];\n                  this.maps.legendSelectionCollection[selectLength - 1]['MapShapeCollection']['Elements'].push(shapeEle);\n                  this.maps.legendSelectionCollection[selectLength - 1]['shapeOldFillColor'] = this.shapePreviousColor;\n                  this.setColor(targetElement, !isNullOrUndefined(module.fill) ? module.fill : legendSelectionColor, module.opacity.toString(), module.border.color, module.border.width.toString(), 'selection');\n                  this.setColor(shapeEle, !isNullOrUndefined(module.fill) ? module.fill : legendSelectionColor, module.opacity.toString(), module.border.color, module.border.width.toString(), 'selection');\n\n                  if (this.maps.selectedElementId.indexOf(shapeEle.getAttribute('id')) === -1) {\n                    this.maps.selectedElementId.push(shapeEle.getAttribute('id'));\n                  }\n\n                  if (j === data.length - 1) {\n                    this.maps.legendSelection = false;\n                    this.removeLegend(this.maps.legendSelectionCollection);\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  };\n\n  Legend.prototype.setColor = function (element, fill, opacity, borderColor, borderWidth, type) {\n    if (type === 'selection') {\n      maintainStyleClass('ShapeselectionMap', 'ShapeselectionMapStyle', fill, opacity, borderColor, borderWidth, this.maps);\n      element.setAttribute('class', 'ShapeselectionMapStyle');\n    } else {\n      element.setAttribute('fill', fill);\n      element.setAttribute('fill-opacity', opacity);\n      element.setAttribute('stroke', borderColor);\n      element.setAttribute('stroke-width', (Number(borderWidth) / this.maps.scale).toString());\n    }\n  }; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  Legend.prototype.pushCollection = function (targetElement, collection, oldElement, shapeSettings) {\n    collection.push({\n      legendElement: targetElement,\n      legendOldFill: oldElement['fill'],\n      legendOldOpacity: oldElement['opacity'],\n      legendOldBorderColor: oldElement['borderColor'],\n      legendOldBorderWidth: oldElement['borderWidth'],\n      shapeOpacity: shapeSettings.opacity,\n      shapeOldBorderColor: shapeSettings.border.color,\n      shapeOldBorderWidth: shapeSettings.border.width\n    });\n    var length = collection.length;\n    collection[length - 1]['MapShapeCollection'] = {\n      Elements: []\n    };\n    collection[length - 1]['shapeOldFillColor'] = [];\n  }; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  Legend.prototype.removeLegend = function (collection) {\n    for (var i = 0; i < collection.length; i++) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      var item = collection[i];\n      this.setColor(item['legendElement'], item['legendOldFill'], item['legendOldOpacity'], item['legendOldBorderColor'], item['legendOldBorderWidth'], 'highlight');\n      var dataCount = item['MapShapeCollection']['Elements'].length;\n\n      for (var j = 0; j < dataCount; j++) {\n        var shapeFillColor = item['legendOldFill'].indexOf('url') !== -1 ? item['shapeOldFillColor'][j] : item['legendOldFill'];\n        this.setColor(item['MapShapeCollection']['Elements'][j], shapeFillColor, item['shapeOpacity'], item['shapeOldBorderColor'], item['shapeOldBorderWidth'], 'highlight');\n      }\n    }\n  };\n\n  Legend.prototype.removeLegendHighlightCollection = function () {\n    if (this.legendHighlightCollection.length > 0) {\n      this.removeLegend(this.legendHighlightCollection);\n      this.legendHighlightCollection = [];\n    }\n  };\n\n  Legend.prototype.removeLegendSelectionCollection = function (targetElement) {\n    if (this.maps.legendSelectionCollection.length > 0) {\n      removeClass(targetElement);\n      var shapeElements = this.shapesOfLegend(targetElement);\n      var dataCount = shapeElements.length;\n\n      for (var j = 0; j < dataCount; j++) {\n        var shapeElement = getElement(shapeElements[j]);\n\n        if (shapeElement.getAttribute('class') === 'ShapeselectionMapStyle') {\n          removeClass(shapeElement);\n          var selectedElementIdIndex = this.maps.selectedElementId.indexOf(shapeElement.id);\n\n          if (selectedElementIdIndex !== -1) {\n            this.maps.selectedElementId.splice(selectedElementIdIndex, 1);\n          }\n        }\n      }\n    }\n  };\n\n  Legend.prototype.removeShapeHighlightCollection = function () {\n    if (this.shapeHighlightCollection.length > 0) {\n      for (var i = 0; i < this.shapeHighlightCollection.length; i++) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var item = this.shapeHighlightCollection[i];\n        var removeFill = true;\n\n        for (var j = 0; j < this.maps.legendSelectionCollection.length; j++) {\n          if (this.maps.legendSelectionCollection[j]['legendElement'] === item['legendElement']) {\n            removeFill = false;\n          }\n        }\n\n        if (removeFill) {\n          this.setColor(item['legendElement'], item['legendOldFill'], item['legendOldOpacity'], item['legendOldBorderColor'], item['legendOldBorderWidth'], 'highlight');\n        }\n      }\n    }\n  };\n\n  Legend.prototype.shapeHighLightAndSelection = function ( // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  targetElement, data, module, getValue, layerIndex) {\n    if (data !== undefined) {\n      this.updateLegendElement();\n      this.shapeToggled = true; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n      var collection = this.maps.legendModule.legendCollection; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n      var indexes = this.legendIndexOnShape(data, layerIndex); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n      var shapeElement = this.shapeDataOnLegend(targetElement);\n      var toggleLegendCheck = this.maps.toggledLegendId.indexOf(indexes['actualIndex']);\n\n      if (this.maps.legendSettings.toggleLegendSettings.enable && toggleLegendCheck !== -1) {\n        this.shapeToggled = false;\n        this.legendHighlightCollection = [];\n        var collectionIndex = this.getIndexofLegend(this.shapeHighlightCollection, shapeElement['LegendEle']);\n\n        if (collectionIndex !== -1) {\n          this.shapeHighlightCollection.splice(collectionIndex, 1);\n        }\n\n        this.removeShapeHighlightCollection();\n        return null;\n      }\n\n      if (indexes['currentIndex'] === undefined && indexes['actualIndex'] === undefined) {\n        this.removeShapeHighlightCollection();\n        return null;\n      }\n\n      if (indexes['currentIndex'] === undefined && getValue === 'selection' && !this.maps.layers[layerIndex].selectionSettings.enableMultiSelect && targetElement.getAttribute('class') !== 'ShapeselectionMapStyle') {\n        this.maps.legendSelection = false;\n      }\n\n      if (getValue === 'selection' && !this.maps.layers[layerIndex].selectionSettings.enableMultiSelect && !this.maps.legendSelection) {\n        this.removeAllSelections();\n        this.maps.legendSelection = true;\n      }\n\n      if (indexes['currentIndex'] === undefined) {\n        if (getValue === 'selection' && indexes['actualIndex'] !== undefined) {\n          var checkSelection = 0;\n\n          for (var i = 0; i < shapeElement['Elements'].length; i++) {\n            if (shapeElement['Elements'][i].getAttribute('class') === 'ShapeselectionMapStyle') {\n              checkSelection++;\n            }\n          }\n\n          var selectionIndex = this.maps.selectedLegendElementId.indexOf(indexes['actualIndex']);\n\n          if (selectionIndex === -1) {\n            this.maps.selectedLegendElementId.push(indexes['actualIndex']);\n            this.maps.legendSelectionClass = module;\n          } else {\n            if (checkSelection <= 1 && targetElement.getAttribute('class') === 'ShapeselectionMapStyle') {\n              if (!this.maps.layers[layerIndex].selectionSettings.enableMultiSelect) {\n                this.maps.selectedLegendElementId.splice(selectionIndex, 1);\n              } else {\n                if (checkSelection <= 1 && targetElement.getAttribute('class') === 'ShapeselectionMapStyle') {\n                  this.maps.selectedLegendElementId.splice(selectionIndex, 1);\n                }\n              }\n            }\n          }\n        }\n\n        this.removeShapeHighlightCollection();\n        return null;\n      }\n\n      var text = collection[indexes['actualIndex']]['text'];\n      var content = void 0;\n      var legendShape = void 0;\n\n      if (this.maps.legendSettings.mode === 'Default') {\n        if (indexes['currentIndex'] !== undefined) {\n          content = document.getElementById(this.maps.element.id + '_Legend_Text_Index_' + indexes['actualIndex']).textContent;\n          legendShape = document.getElementById(this.maps.element.id + '_Legend_Shape_Index_' + indexes['actualIndex']);\n        }\n      } else {\n        content = document.getElementById(this.maps.element.id + '_Legend_Index_' + indexes['actualIndex'] + '_Text').textContent;\n        legendShape = document.getElementById(this.maps.element.id + '_Legend_Index_' + indexes['actualIndex']);\n      }\n\n      this.oldShapeElement = shapeElement['LegendEle'];\n      var length_1 = this.maps.legendSelectionCollection.length;\n\n      if (text === content) {\n        var shapeMatched = true;\n\n        if (this.maps.legendSelectionCollection) {\n          for (var i = 0; i < this.maps.legendSelectionCollection.length; i++) {\n            if (this.maps.legendSelectionCollection[i]['legendElement'] === shapeElement['LegendEle']) {\n              shapeMatched = false;\n              break;\n            }\n          }\n        }\n\n        if (getValue === 'highlight' && shapeMatched) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          var selectionEle = this.isTargetSelected(shapeElement, this.shapeHighlightCollection);\n\n          if (selectionEle === undefined || selectionEle && !selectionEle['IsSelected']) {\n            this.pushCollection(legendShape, this.shapeHighlightCollection, collection[indexes['actualIndex']], this.maps.layers[layerIndex].shapeSettings);\n          }\n\n          for (var j = 0; j < this.shapeHighlightCollection.length; j++) {\n            if (shapeElement['LegendEle'].id === this.shapeHighlightCollection[j]['legendElement'].id) {\n              this.shapeHighlightCollection[j]['legendElement'] = shapeElement['LegendEle'];\n            }\n          }\n\n          if (length_1 > 0) {\n            for (var j = 0; j < length_1; j++) {\n              if (shapeElement['LegendEle'] === this.maps.legendSelectionCollection[j]['legendElement']) {\n                this.maps.legendSelectionCollection[j]['legendElement'] = shapeElement['LegendEle'];\n                this.removeShapeHighlightCollection();\n                break;\n              } else if (j === length_1 - 1) {\n                this.removeShapeHighlightCollection();\n                this.setColor(legendShape, !isNullOrUndefined(module.fill) ? module.fill : legendShape.getAttribute('fill'), module.opacity.toString(), module.border.color, module.border.width.toString(), 'highlight');\n              }\n            }\n          } else {\n            this.removeShapeHighlightCollection();\n            this.setColor(legendShape, !isNullOrUndefined(module.fill) ? module.fill : legendShape.getAttribute('fill'), module.opacity.toString(), module.border.color, module.border.width.toString(), 'highlight');\n          }\n        } else if (getValue === 'selection') {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          var selectionEle = this.isTargetSelected(shapeElement, this.maps.legendSelectionCollection);\n\n          if (length_1 > 0) {\n            var j = 0;\n\n            while (j < this.maps.legendSelectionCollection.length) {\n              if (shapeElement['LegendEle'] !== this.maps.legendSelectionCollection[j]['legendElement'] && !module.enableMultiSelect) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                var element = this.maps.legendSelectionCollection[j];\n                var selectedLegendIndex = this.maps.selectedLegendElementId.indexOf(indexes['actualIndex']);\n                this.maps.selectedLegendElementId.splice(selectedLegendIndex, 1);\n                this.maps.legendSelectionCollection.splice(j, 1);\n                removeClass(element['legendElement']);\n                this.maps.shapeSelections = true;\n                j = 0;\n              } else {\n                j++;\n              }\n            }\n          }\n\n          if (selectionEle && selectionEle['IsSelected'] && targetElement.getAttribute('class') === 'ShapeselectionMapStyle') {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var element = this.maps.legendSelectionCollection[selectionEle['SelectionIndex']];\n            var multiSelection = 0;\n\n            if (module.enableMultiSelect) {\n              for (var i = 0; i < shapeElement['Elements'].length; i++) {\n                if (targetElement.getAttribute('class') === shapeElement['Elements'][i].getAttribute('class')) {\n                  multiSelection++;\n                }\n              }\n            }\n\n            if (multiSelection <= 1 && (!module.enableMultiSelect ? this.maps.legendSelection : true)) {\n              this.maps.selectedLegendElementId.splice(this.maps.selectedLegendElementId.indexOf(indexes['actualIndex']), 1);\n\n              if (!isNullOrUndefined(shapeElement['LegendEle'])) {\n                removeClass(shapeElement['LegendEle']);\n              }\n\n              this.maps.legendSelectionCollection.splice(selectionEle['SelectionIndex'], 1);\n              this.maps.shapeSelections = true;\n            }\n          } else {\n            if ((selectionEle === undefined || selectionEle && !selectionEle['IsSelected']) && !isNullOrUndefined(legendShape)) {\n              var legendSelectionIndex = this.getIndexofLegend(this.maps.legendSelectionCollection, legendShape);\n\n              if (legendSelectionIndex === -1) {\n                this.pushCollection(legendShape, this.maps.legendSelectionCollection, collection[indexes['actualIndex']], this.maps.layers[layerIndex].shapeSettings);\n              }\n            }\n\n            var addId = true;\n\n            for (var i = 0; i < this.maps.selectedLegendElementId.length; i++) {\n              if (indexes['actualIndex'] === this.maps.selectedLegendElementId[i]) {\n                addId = false;\n              }\n            }\n\n            if (addId) {\n              this.maps.selectedLegendElementId.push(indexes['actualIndex']);\n            }\n\n            this.maps.legendSelectionClass = module;\n            this.removeLegend(this.shapeHighlightCollection);\n\n            if (!isNullOrUndefined(legendShape)) {\n              this.setColor(legendShape, !isNullOrUndefined(module.fill) ? module.fill : legendShape.getAttribute('fill'), module.opacity.toString(), module.border.color, module.border.width.toString(), 'selection');\n              var legendSelectionIndex = this.getIndexofLegend(this.maps.legendSelectionCollection, legendShape);\n              this.maps.legendSelectionCollection[legendSelectionIndex]['MapShapeCollection']['Elements'].push(targetElement);\n            }\n\n            this.maps.shapeSelections = false;\n          }\n        } else if (document.getElementsByClassName('highlightMapStyle').length > 0) {\n          this.removeShapeHighlightCollection();\n          removeClass(document.getElementsByClassName('highlightMapStyle')[0]);\n        }\n      }\n    } else {\n      this.removeShapeHighlightCollection();\n    }\n  }; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  Legend.prototype.isTargetSelected = function (target, collection) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    var selectEle;\n\n    for (var i = 0; i < collection.length; i++) {\n      if (!isNullOrUndefined(target['LegendEle'].getAttribute('id')) && target['LegendEle'].getAttribute('id') === collection[i]['legendElement'].getAttribute('id')) {\n        selectEle = {\n          IsSelected: true,\n          SelectionIndex: i\n        };\n      }\n    }\n\n    return selectEle;\n  };\n\n  Legend.prototype.updateLegendElement = function () {\n    for (var i = 0; i < this.maps.legendSelectionCollection.length; i++) {\n      if (document.getElementById(this.maps.legendSelectionCollection[i]['legendElement'].id)) {\n        this.maps.legendSelectionCollection[i]['legendElement'] = document.getElementById(this.maps.legendSelectionCollection[i]['legendElement'].id);\n      }\n    }\n  }; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  Legend.prototype.getIndexofLegend = function (targetCollection, targetElement) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    var legendIndex = targetCollection.map(function (e) {\n      return e['legendElement'];\n    }).indexOf(targetElement);\n    return legendIndex;\n  };\n\n  Legend.prototype.removeAllSelections = function () {\n    for (var i = 0; i < this.maps.selectedElementId.length; i++) {\n      var selectedElement = document.getElementById(this.maps.selectedElementId[i]);\n      removeClass(selectedElement);\n    }\n\n    for (var j = 0; j < this.maps.selectedLegendElementId.length; j++) {\n      var idIndex = this.maps.legendSettings.mode === 'Interactive' ? 'container_Legend_Index_' : 'container_Legend_Shape_Index_';\n      var selectedElement = idIndex + this.maps.selectedLegendElementId[j];\n      var legendElement = document.getElementById(selectedElement);\n\n      if (!isNullOrUndefined(legendElement)) {\n        removeClass(document.getElementById(selectedElement));\n      }\n    }\n\n    this.maps.legendSelectionCollection = [];\n    this.maps.selectedLegendElementId = [];\n    this.maps.selectedElementId = [];\n  }; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  Legend.prototype.legendIndexOnShape = function (data, index) {\n    var legendIndex;\n    var actualIndex;\n    var path = this.maps.layers[index].shapeDataPath; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var value = data[path];\n    var legendType = this.maps.legendSettings.mode; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var collection = this.maps.legendModule.legendCollection; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var currentCollection;\n\n    if (legendType === 'Default' && !isNullOrUndefined(this.maps.legendModule.totalPages)) {\n      currentCollection = this.maps.legendModule.totalPages[this.maps.legendModule.currentPage]['Collection'];\n    }\n\n    var currentCollectionLength = legendType === 'Default' ? currentCollection['length'] : 1;\n\n    for (var i = 0; i < collection.length; i++) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      var dataValue = collection[i]['data'];\n\n      for (var k = 0; k < currentCollectionLength; k++) {\n        if (legendType !== 'Default' || collection[i]['text'] === currentCollection[k]['DisplayText']) {\n          for (var j = 0; j < dataValue.length; j++) {\n            if (value === dataValue[j]['name']) {\n              legendIndex = k;\n            }\n          }\n        }\n      }\n\n      for (var j = 0; j < dataValue.length; j++) {\n        if (value === dataValue[j]['name']) {\n          actualIndex = i;\n        }\n      }\n    }\n\n    return {\n      currentIndex: legendIndex,\n      actualIndex: actualIndex\n    };\n  }; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  Legend.prototype.shapeDataOnLegend = function (targetElement) {\n    var shapeIndex;\n    var layerIndex;\n    var dataIndex; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var collection = this.maps.legendModule.legendCollection;\n    var legend = this.maps.legendSettings;\n\n    for (var i = 0; i < collection.length; i++) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      var data = collection[i]['data'];\n      var process = false; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n      var elements = []; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n      var currentElement = {\n        Elements: []\n      };\n\n      for (var j = 0; j < data.length; j++) {\n        shapeIndex = data[j]['shapeIndex'];\n        layerIndex = data[j]['layerIndex'];\n        dataIndex = data[j]['dataIndex'];\n        var shapeEle = document.getElementById(this.maps.element.id + '_LayerIndex_' + layerIndex + '_shapeIndex_' + shapeIndex + '_dataIndex_' + dataIndex);\n\n        if (targetElement === shapeEle) {\n          process = true;\n        }\n\n        elements.push(shapeEle);\n      }\n\n      if (process) {\n        if (isNullOrUndefined(currentElement['LegendEle'])) {\n          currentElement['LegendEle'] = legend.mode === 'Default' ? document.getElementById(this.maps.element.id + '_Legend_Shape_Index_' + i) : document.getElementById(this.maps.element.id + '_Legend_Index_' + i);\n        }\n\n        currentElement['Elements'] = elements;\n        return currentElement;\n      }\n    }\n\n    return null;\n  };\n\n  Legend.prototype.shapesOfLegend = function (targetElement) {\n    var shapeIndex;\n    var layerIndex;\n    var dataIndex;\n    var idIndex = parseFloat(targetElement.id.charAt(targetElement.id.length - 1)); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var data = this.maps.legendModule.legendCollection[idIndex]['data'];\n    var legendShapeElements = [];\n\n    for (var i = 0; i < data.length; i++) {\n      shapeIndex = data[i]['shapeIndex'];\n      layerIndex = data[i]['layerIndex'];\n      dataIndex = data[i]['dataIndex'];\n      var shapeElement = document.getElementById(this.maps.element.id + '_LayerIndex_' + layerIndex + '_shapeIndex_' + shapeIndex + '_dataIndex_' + dataIndex);\n\n      if (!isNullOrUndefined(shapeElement)) {\n        legendShapeElements.push(shapeElement.id);\n      }\n    }\n\n    return legendShapeElements;\n  };\n\n  Legend.prototype.legendToggle = function () {\n    var map = this.maps;\n    var legend = map.legendSettings;\n\n    if (this.maps.selectedLegendElementId) {\n      // To maintain the state of legend selection during page resize.\n      for (var j = 0; j < this.maps.selectedLegendElementId.length; j++) {\n        var idIndex = legend.mode === 'Interactive' ? this.maps.element.id + '_Legend_Index_' : this.maps.element.id + '_Legend_Shape_Index_';\n        var selectedElement = map.svgObject.querySelector('#' + idIndex + this.maps.selectedLegendElementId[j]);\n\n        if (!isNullOrUndefined(selectedElement)) {\n          var fill = !isNullOrUndefined(this.maps.legendSelectionClass.fill) ? this.maps.legendSelectionClass.fill : selectedElement.getAttribute('fill');\n          this.setColor(selectedElement, fill, this.maps.legendSelectionClass.opacity.toString(), this.maps.legendSelectionClass.border.color, this.maps.legendSelectionClass.border.width.toString(), 'selection');\n\n          for (var i = 0; i < this.maps.legendSelectionCollection.length; i++) {\n            if (this.maps.legendSelectionCollection[i]['legendElement'].id === selectedElement.id) {\n              this.maps.legendSelectionCollection[i]['legendElement'] = selectedElement;\n            }\n          }\n\n          var legendSelectionIndex = this.getIndexofLegend(this.maps.legendSelectionCollection, selectedElement);\n\n          if (legendSelectionIndex === -1) {\n            var layerIndex = this.maps.legendModule.legendCollection[this.maps.selectedLegendElementId[j]]['data'][j]['layerIndex'];\n            this.pushCollection(selectedElement, this.maps.legendSelectionCollection, this.maps.legendModule.legendCollection[this.maps.selectedLegendElementId[j]], this.maps.layers[layerIndex].shapeSettings);\n          }\n        }\n      }\n    }\n\n    if (this.maps.toggledLegendId) {\n      for (var j = 0; j < this.maps.toggledLegendId.length; j++) {\n        var legendTextId = legend.mode === 'Interactive' ? '#' + this.maps.element.id + '_Legend_Index_' + this.maps.toggledLegendId[j] + '_Text' : '#' + this.maps.element.id + '_Legend_Text_Index_' + this.maps.toggledLegendId[j];\n        var textElement = map.svgObject.querySelector(legendTextId);\n\n        if (!isNullOrUndefined(textElement)) {\n          textElement.setAttribute('fill', '#E5E5E5');\n        }\n\n        var legendShapeId = legend.mode === 'Interactive' ? '#' + this.maps.element.id + '_Legend_Index_' + this.maps.toggledLegendId[j] : '#' + this.maps.element.id + '_Legend_Shape_Index_' + this.maps.toggledLegendId[j];\n        var legendElement = map.svgObject.querySelector(legendShapeId);\n\n        if (!isNullOrUndefined(legendElement)) {\n          legendElement.setAttribute('fill', '#E5E5E5');\n        }\n      }\n    }\n  };\n\n  Legend.prototype.renderLegendBorder = function () {\n    var map = this.maps;\n    var legend = map.legendSettings;\n    var legendTitle = legend.title.text;\n    var textStyle = {\n      fontFamily: legend.titleStyle.fontFamily,\n      fontStyle: legend.titleStyle.fontStyle,\n      fontWeight: legend.titleStyle.fontWeight,\n      size: legend.titleStyle.size,\n      color: legend.titleStyle.color,\n      opacity: legend.titleStyle.opacity\n    };\n    var textOptions;\n    var spacing = 10;\n    var trimTitle = textTrim(this.legendItemRect.width + spacing * 2, legendTitle, textStyle);\n    var textSize = measureText(trimTitle, textStyle);\n    this.legendBorderRect = new Rect(this.legendItemRect.x - spacing, this.legendItemRect.y - spacing - textSize.height, this.legendItemRect.width + spacing * 2, this.legendItemRect.height + spacing * 2 + textSize.height + (legend.mode === 'Interactive' ? 0 : this.page !== 0 ? spacing : 0));\n    var legendBorder = {\n      color: legend.border.color,\n      width: legend.border.width,\n      opacity: legend.border.opacity\n    };\n    legendBorder.opacity = isNullOrUndefined(legendBorder.opacity) ? 1 : legendBorder.opacity;\n    var renderOptions = new RectOption(map.element.id + '_Legend_Border', legend.background, legendBorder, 1, this.legendBorderRect, null, null, '', '');\n    this.legendGroup.appendChild(map.renderer.drawRectangle(renderOptions));\n    this.getLegendAlignment(map, this.legendBorderRect.width, this.legendBorderRect.height, legend);\n    this.legendGroup.setAttribute('transform', 'translate( ' + (this.translate.x + -this.legendBorderRect.x) + ' ' + (this.translate.y + -this.legendBorderRect.y) + ' )');\n    map.svgObject.appendChild(this.legendGroup);\n\n    if (legendTitle) {\n      textStyle.color = textStyle.color !== null ? textStyle.color : this.maps.themeStyle.legendTitleFontColor;\n      textStyle.fontFamily = !isNullOrUndefined(textStyle.fontFamily) ? textStyle.fontFamily : this.maps.themeStyle.fontFamily;\n      textOptions = new TextOption(map.element.id + '_LegendTitle', this.legendItemRect.x + this.legendItemRect.width / 2, this.legendItemRect.y - textSize.height / 2 - spacing / 2, 'middle', trimTitle, '');\n      renderTextElement(textOptions, textStyle, textStyle.color, this.legendGroup);\n    }\n  };\n\n  Legend.prototype.changeNextPage = function (e) {\n    this.currentPage = e.target.id.indexOf('_Left_Page_') > -1 ? this.currentPage - 1 : this.currentPage + 1;\n    this.legendGroup = this.maps.renderer.createGroup({\n      id: this.maps.element.id + '_Legend_Group'\n    });\n    this.drawLegendItem(this.currentPage);\n\n    if (querySelector(this.maps.element.id + '_Legend_Border', this.maps.element.id)) {\n      querySelector(this.maps.element.id + '_Legend_Border', this.maps.element.id).style.pointerEvents = 'none';\n    }\n  };\n\n  Legend.prototype.getLegendAlignment = function (map, width, height, legend) {\n    var x;\n    var y;\n    var spacing = 10;\n    var totalRect; // eslint-disable-next-line prefer-const\n\n    totalRect = extend({}, map.mapAreaRect, totalRect, true);\n    var areaX = totalRect.x;\n    var areaY = totalRect.y;\n    var areaHeight = totalRect.height;\n    var areaWidth = totalRect.width;\n    var totalWidth = map.availableSize.width;\n    var totalHeight = map.availableSize.height;\n\n    if (legend.position === 'Float') {\n      this.translate = legend.location;\n    } else {\n      switch (legend.position) {\n        case 'Top':\n        case 'Bottom':\n          totalRect.height = areaHeight - height;\n          x = totalWidth / 2 - width / 2;\n          y = legend.position === 'Top' ? areaY : areaY + totalRect.height;\n          totalRect.y = legend.position === 'Top' ? areaY + height + spacing : areaY;\n          break;\n\n        case 'Left':\n        case 'Right':\n          totalRect.width = areaWidth - width;\n          x = legend.position === 'Left' ? areaX : areaX + totalRect.width - spacing;\n          y = totalHeight / 2 - height / 2;\n          totalRect.x = legend.position === 'Left' ? areaX + width : areaX;\n          break;\n      }\n\n      switch (legend.alignment) {\n        case 'Near':\n          if (legend.position === 'Top' || legend.position === 'Bottom') {\n            x = totalRect.x;\n          } else {\n            y = totalRect.y;\n          }\n\n          break;\n\n        case 'Far':\n          if (legend.position === 'Top' || legend.position === 'Bottom') {\n            x = totalWidth - width - spacing;\n          } else {\n            y = totalHeight - height;\n          }\n\n          break;\n      }\n\n      if ((legend.height || legend.width) && legend.mode !== 'Interactive') {\n        this.legendTotalRect = map.totalRect = totalRect;\n      } else {\n        if ((legend.height || legend.width) && legend.mode === 'Interactive') {\n          map.totalRect = totalRect;\n        }\n\n        this.legendTotalRect = map.mapAreaRect = totalRect;\n      }\n\n      this.translate = new Point(x, y);\n    }\n  };\n\n  Legend.prototype.getMarkersLegendCollections = function (layerIndex, markers) {\n    var _this = this;\n\n    Array.prototype.forEach.call(markers, function (marker, markerIndex) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      var dataSource = marker.dataSource;\n      var field = marker.legendText; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n      var templateFn;\n      var isDuplicate; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n      Array.prototype.forEach.call(dataSource, function (data, dataIndex) {\n        var imageSrc = null;\n        var showLegend = isNullOrUndefined(data[_this.maps.legendSettings.showLegendPath]) ? true : data[_this.maps.legendSettings.showLegendPath];\n\n        if (marker.visible && showLegend && !isNullOrUndefined(data['latitude']) && !isNullOrUndefined(data['longitude'])) {\n          if (marker.template) {\n            templateFn = getTemplateFunction(marker.template);\n            var templateElement = templateFn(_this.maps);\n            var markerEle = isNullOrUndefined(templateElement.childElementCount) ? templateElement[0] : templateElement;\n            imageSrc = markerEle.querySelector('img').src;\n          }\n\n          var text = isNullOrUndefined(data[field]) ? '' : data[field];\n          var legendFill = !isNullOrUndefined(marker.colorValuePath) ? data[marker.colorValuePath] : marker.fill; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n          var newData = [];\n\n          if (_this.maps.legendSettings.removeDuplicateLegend) {\n            newData.push(_this.getMarkerLegendData(layerIndex, text, legendFill));\n\n            _this.getOverallLegendItemsCollection(text, legendFill, newData, showLegend);\n          } else {\n            newData.push({\n              layerIndex: layerIndex,\n              markerIndex: markerIndex,\n              dataIndex: dataIndex,\n              value: legendFill,\n              name: text,\n              shape: !isNullOrUndefined(marker.shapeValuePath) && !isNullOrUndefined(data[marker.shapeValuePath]) && data[marker.shapeValuePath] !== '' ? data[marker.shapeValuePath] : _this.maps.legendSettings.useMarkerShape ? marker.shape : _this.maps.legendSettings.shape\n            });\n\n            _this.getOverallLegendItemsCollection(text, legendFill, newData, showLegend);\n          }\n        }\n      });\n    });\n  }; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  Legend.prototype.getMarkerLegendData = function (layerIndex, text, legendFill) {\n    var _this = this; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n    var legendData = [];\n    this.maps.layers[layerIndex].markerSettings.map(function (markerSettings, markerIndex) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      var markerData = markerSettings.dataSource; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n      Array.prototype.forEach.call(markerData, function (data, dataIndex) {\n        var marker = _this.maps.layers[layerIndex].markerSettings[markerIndex];\n\n        if ((text === data[marker.legendText] || text === '') && legendFill === data[marker.colorValuePath]) {\n          legendData.push({\n            layerIndex: layerIndex,\n            markerIndex: markerIndex,\n            dataIndex: dataIndex,\n            value: legendFill,\n            name: text,\n            shape: !isNullOrUndefined(marker.shapeValuePath) ? data[marker.shapeValuePath] : marker.shape\n          });\n        }\n      });\n    });\n    return legendData;\n  };\n\n  Legend.prototype.getRangeLegendCollection = function ( // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath) {\n    var _this = this;\n\n    var legendText;\n    var legendIndex = 0; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var fill = this.maps.legendSettings.fill;\n    var rangeData = [];\n\n    var _loop_1 = function (colorMap) {\n      if (!isNullOrUndefined(colorMap.from) && !isNullOrUndefined(colorMap.to)) {\n        legendText = !isNullOrUndefined(colorMap.label) ? colorMap.label : colorMap.from + ' - ' + colorMap.to;\n        rangeData = [];\n        var colorMapProcess_1 = false; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n        Array.prototype.forEach.call(dataSource, function (data, dataIndex) {\n          var colorValue = colorValuePath.indexOf('.') > -1 ? Number(getValueFromObject(data, colorValuePath)) : parseFloat(data[colorValuePath]);\n\n          if (colorValue >= colorMap.from && colorValue <= colorMap.to) {\n            colorMapProcess_1 = true;\n            rangeData.push(_this.getLegendData(layerIndex, dataIndex, data, dataPath, layerData, propertyPath, colorValue));\n          }\n        });\n\n        if (!colorMapProcess_1) {\n          rangeData.push({\n            layerIndex: layerIndex,\n            shapeIndex: null,\n            dataIndex: null,\n            name: null,\n            value: null\n          });\n        }\n\n        var legendFill = isNullOrUndefined(fill) ? Object.prototype.toString.call(colorMap.color) === '[object Array]' ? !isNullOrUndefined(colorMap.value) ? colorMap.color[0] : this_1.legendGradientColor(colorMap, legendIndex) : colorMap.color : fill;\n        legendIndex++;\n        this_1.getOverallLegendItemsCollection(legendText, legendFill, rangeData, colorMap.showLegend);\n      }\n    };\n\n    var this_1 = this;\n\n    for (var _i = 0, colorMapping_1 = colorMapping; _i < colorMapping_1.length; _i++) {\n      var colorMap = colorMapping_1[_i];\n\n      _loop_1(colorMap);\n    }\n  }; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  Legend.prototype.getOverallLegendItemsCollection = function (legendText, legendFill, legendData, showLegend) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    var newColllection = [];\n    var legend = this.maps.legendSettings;\n\n    if (legendData.length > 0 && showLegend) {\n      for (var i = 0; i < legendData.length; i++) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var collection = legendData[i];\n\n        if (collection.length > 0) {\n          for (var j = 0; j < collection.length; j++) {\n            newColllection.push(collection[j]);\n          }\n        } else {\n          newColllection.push(legendData[i]);\n        }\n\n        newColllection['_isVisible'] = true;\n      }\n\n      var isDuplicate = this.maps.legendSettings.removeDuplicateLegend ? this.removeDuplicates(this.legendCollection, legendText, legendFill) : false;\n\n      if (!isDuplicate) {\n        this.legendCollection.push({\n          text: legendText,\n          fill: legendFill,\n          data: newColllection,\n          opacity: legend.opacity,\n          borderColor: legend.shapeBorder.color,\n          borderWidth: legend.shapeBorder.width\n        });\n      }\n    }\n  }; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n  Legend.prototype.removeDuplicates = function (legendCollection, text, legendFill) {\n    var isDuplicate = false;\n\n    for (var i = 0; i < legendCollection.length; i++) {\n      if ((legendCollection[i]['text'] === text || legendCollection[i]['text'] === '') && legendCollection[i]['fill'] === legendFill) {\n        isDuplicate = true;\n        break;\n      } else {\n        continue;\n      }\n    }\n\n    return isDuplicate;\n  };\n\n  Legend.prototype.getEqualLegendCollection = function ( // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath) {\n    var _this = this; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n    var fill = this.maps.legendSettings.fill;\n    var equalValues = []; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var legendText;\n    var legendIndex = 0;\n    var equalData = []; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n    var outOfRangeValues = [];\n    var outOfRange = [];\n\n    var _loop_2 = function (colorMap) {\n      if (!isNullOrUndefined(colorMap.value)) {\n        legendText = !isNullOrUndefined(colorMap.label) ? colorMap.label : colorMap.value;\n        equalData = [];\n        var eqaulColorProcess_1 = false; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n        Array.prototype.forEach.call(dataSource, function (data, dataIndex) {\n          var equalValue = colorValuePath.indexOf('.') > -1 ? getValueFromObject(data, colorValuePath) : data[colorValuePath];\n\n          if (equalValue === colorMap.value) {\n            eqaulColorProcess_1 = true;\n\n            if (equalValues.indexOf(equalValue) === -1) {\n              equalValues.push(equalValue);\n            }\n\n            equalData.push(_this.getLegendData(layerIndex, dataIndex, data, dataPath, layerData, propertyPath, equalValue));\n          } else {\n            if (outOfRangeValues.indexOf(equalValue) === -1) {\n              outOfRangeValues.push(equalValue);\n            }\n          }\n        });\n\n        for (var x = 0; x < equalValues.length; x++) {\n          for (var y = 0; y < outOfRangeValues.length; y++) {\n            if (equalValues[x] === outOfRangeValues[y]) {\n              var equalIndex = outOfRangeValues.indexOf(equalValues[x]);\n              outOfRangeValues.splice(equalIndex, 1);\n            }\n          }\n        }\n\n        if (!eqaulColorProcess_1) {\n          equalData.push({\n            layerIndex: layerIndex,\n            shapeIndex: null,\n            dataIndex: null,\n            name: null,\n            value: null\n          });\n        }\n\n        var legendFill = isNullOrUndefined(fill) ? Object.prototype.toString.call(colorMap.color) === '[object Array]' ? colorMap.color[0] : colorMap.color : fill;\n        legendIndex++;\n        this_2.getOverallLegendItemsCollection(legendText, legendFill, equalData, colorMap.showLegend);\n      } else if (isNullOrUndefined(colorMap.minOpacity) && isNullOrUndefined(colorMap.maxOpacity) && isNullOrUndefined(colorMap.value) && isNullOrUndefined(colorMap.from) && isNullOrUndefined(colorMap.to) && !isNullOrUndefined(colorMap.color)) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        Array.prototype.forEach.call(dataSource, function (data, dataIndex) {\n          var equalValue = colorValuePath.indexOf('.') > -1 ? getValueFromObject(data, colorValuePath) : data[colorValuePath];\n\n          for (var k = 0; k < outOfRangeValues.length; k++) {\n            if (equalValue === outOfRangeValues[k]) {\n              outOfRange.push(_this.getLegendData(layerIndex, dataIndex, data, dataPath, layerData, propertyPath, equalValue));\n            }\n          }\n        });\n\n        if (outOfRangeValues.length === 0) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          var range_1 = false;\n          var outRange = []; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n          Array.prototype.forEach.call(dataSource, function (data, dataIndex) {\n            range_1 = false;\n            var rangeValue = data[colorValuePath];\n\n            for (var z = 0; z < colorMapping.length; z++) {\n              if (!isNullOrUndefined(rangeValue) && !isNaN(rangeValue)) {\n                if (rangeValue >= colorMapping[z].from && rangeValue <= colorMapping[z].to) {\n                  range_1 = true;\n                }\n              } else if (!range_1) {\n                range_1 = false;\n              }\n            }\n\n            if (!range_1) {\n              outOfRange.push(_this.getLegendData(layerIndex, dataIndex, data, dataPath, layerData, propertyPath, rangeValue));\n            }\n          });\n        }\n\n        legendText = !isNullOrUndefined(colorMap.label) ? colorMap.label : 'Others';\n        var outfill = Object.prototype.toString.call(colorMap.color) === '[object Array]' ? colorMap.color[0] : colorMap.color;\n        var legendOutFill = outfill;\n        legendIndex++;\n        this_2.getOverallLegendItemsCollection(legendText, legendOutFill, outOfRange, colorMap.showLegend);\n      }\n    };\n\n    var this_2 = this;\n\n    for (var _i = 0, colorMapping_2 = colorMapping; _i < colorMapping_2.length; _i++) {\n      var colorMap = colorMapping_2[_i];\n\n      _loop_2(colorMap);\n    }\n  };\n\n  Legend.prototype.getDataLegendCollection = function ( // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath) {\n    var _this = this;\n\n    var legendText;\n    var fill = this.maps.legendSettings.fill;\n    var valuePath = this.maps.legendSettings.valuePath;\n\n    if (!isNullOrUndefined(colorValuePath) && !isNullOrUndefined(dataSource)) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      Array.prototype.forEach.call(dataSource, function (data, dataIndex) {\n        var showLegend = isNullOrUndefined(_this.maps.legendSettings.showLegendPath) ? true : isNullOrUndefined(data[_this.maps.legendSettings.showLegendPath]) ? false : data[_this.maps.legendSettings.showLegendPath];\n        var dataValue = colorValuePath.indexOf('.') > -1 ? getValueFromObject(data, colorValuePath) : data[colorValuePath]; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n        var newData = [];\n        var legendFill = isNullOrUndefined(fill) ? dataValue : fill;\n\n        if (!isNullOrUndefined(dataValue) && colorMapping.length === 0) {\n          legendText = !isNullOrUndefined(data[valuePath]) ? valuePath.indexOf('.') > -1 ? getValueFromObject(data, valuePath) : data[valuePath] : dataPath.indexOf('.') > -1 ? getValueFromObject(data, dataPath) : data[dataPath];\n          newData.push(_this.getLegendData(layerIndex, dataIndex, data, dataPath, layerData, propertyPath, dataValue));\n        }\n\n        _this.getOverallLegendItemsCollection(legendText, legendFill, newData, showLegend);\n      });\n    }\n  };\n\n  Legend.prototype.interactiveHandler = function (e) {\n    var target = e.target;\n    var legend = this.maps.legendSettings;\n    var id = this.maps.element.id + '_Interactive_Legend';\n    var hoverId = legend.type === 'Layers' ? '_shapeIndex_' : legend.type === 'Markers' ? '_MarkerIndex_' : '_BubbleIndex_';\n\n    if (target.id.indexOf(hoverId) > 1) {\n      var layerIndex = parseFloat(target.id.split('_LayerIndex_')[1].split('_')[0]);\n      var dataIndex = parseFloat(target.id.split(/_dataIndex_/i)[1].split('_')[0]);\n      var fill = void 0;\n      var stroke = void 0;\n      var strokeWidth = void 0;\n\n      if (!isNullOrUndefined(querySelector(id, this.maps.element.id))) {\n        remove(querySelector(id, this.maps.element.id));\n      }\n\n      var layer = this.maps.layersCollection[layerIndex];\n      var markerVisible = legend.type === 'Layers' ? layer.visible : legend.type === 'Markers' ? layer.markerSettings[parseFloat(target.id.split('_MarkerIndex_')[1].split('_')[0])].visible : this.maps.getBubbleVisible(this.maps.layersCollection[layerIndex]);\n\n      if (legend.visible && this.legendRenderingCollections.length > 0 && legend.mode === 'Interactive' && markerVisible) {\n        var svgRect = this.maps.svgObject.getBoundingClientRect();\n\n        for (var i = 0; i < this.legendCollection.length; i++) {\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          var currentData = this.legendCollection[i];\n          var legendElement = querySelector(this.maps.element.id + '_Legend_Index_' + i, this.maps.element.id);\n          var legendRect = legendElement.getBoundingClientRect();\n          var rect = new Rect(Math.abs(legendRect.left - svgRect.left), Math.abs(legendRect.top - svgRect.top), legendRect.width, legendRect.height);\n          fill = legendElement.getAttribute('fill');\n          stroke = legend.shapeBorder.color;\n          strokeWidth = legend.shapeBorder.width;\n\n          if (!isNullOrUndefined(currentData['data'])) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var data = currentData['data'];\n\n            for (var j = 0; j < data.length; j++) {\n              if (dataIndex === data[j]['dataIndex'] && layerIndex === data[j]['layerIndex']) {\n                this.renderInteractivePointer(legend, fill, stroke, id, strokeWidth, rect);\n                break;\n              }\n            }\n          }\n        }\n      }\n    } else {\n      if (!isNullOrUndefined(querySelector(id, this.maps.element.id))) {\n        remove(querySelector(id, this.maps.element.id));\n      }\n    }\n  };\n\n  Legend.prototype.renderInteractivePointer = function (legend, fill, stroke, id, strokeWidth, rect) {\n    var path;\n    var locX;\n    var locY;\n    var height = 10;\n    var width = 10;\n    var direction = legend.orientation === 'None' ? legend.position === 'Top' || legend.position === 'Bottom' ? 'Horizontal' : 'Vertical' : legend.orientation;\n\n    if (direction === 'Horizontal') {\n      if (!legend.invertedPointer) {\n        locX = rect.x + rect.width / 2;\n        locY = rect.y;\n        path = ' M ' + locX + ' ' + locY + ' L ' + (locX - width) + ' ' + (locY - height) + ' L ' + (locX + width) + ' ' + (locY - height) + ' Z ';\n      } else {\n        locX = rect.x + rect.width / 2;\n        locY = rect.y + rect.height;\n        path = ' M ' + locX + ' ' + locY + ' L ' + (locX - width) + ' ' + (locY + height) + ' L ' + (locX + width) + ' ' + (locY + height) + ' Z ';\n      }\n    } else {\n      if (!legend.invertedPointer) {\n        locX = rect.x + rect.width;\n        locY = rect.y + rect.height / 2;\n        path = ' M ' + locX + ' ' + locY + ' L ' + (locX + width) + ' ' + (locY - height) + ' L ' + (locX + width) + ' ' + (locY + height) + ' z ';\n      } else {\n        locX = rect.x;\n        locY = rect.y + rect.height / 2;\n        path = ' M ' + locX + ' ' + locY + ' L ' + (locX - width) + ' ' + (locY - height) + ' L ' + (locX - width) + ' ' + (locY + height) + ' z ';\n      }\n    }\n\n    var pathOptions = new PathOption(id, fill, strokeWidth, stroke, 1, 1, '', path);\n    this.maps.svgObject.appendChild(this.maps.renderer.drawPath(pathOptions));\n  };\n\n  Legend.prototype.wireEvents = function (element) {\n    EventHandler.add(element, Browser.touchStartEvent, this.changeNextPage, this);\n  };\n\n  Legend.prototype.addEventListener = function () {\n    if (this.maps.isDestroyed) {\n      return;\n    }\n\n    this.maps.on(Browser.touchMoveEvent, this.interactiveHandler, this);\n    this.maps.on(Browser.touchEndEvent, this.interactiveHandler, this);\n    this.maps.on(click, this.legendClick, this);\n  };\n\n  Legend.prototype.markerToggleSelection = function (mapElement, layerIndex, markerIndex, legendIndex) {\n    mapElement.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n    mapElement.setAttribute('stroke', this.maps.layers[layerIndex].markerSettings[markerIndex].border.color);\n    mapElement.setAttribute('fill-opacity', this.maps.layers[layerIndex].markerSettings[markerIndex].opacity.toString());\n    mapElement.setAttribute('stroke-width', this.maps.layers[layerIndex].markerSettings[markerIndex].border.width.toString());\n    mapElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[layerIndex].markerSettings[markerIndex].border.opacity) ? this.maps.layers[layerIndex].markerSettings[markerIndex].opacity : this.maps.layers[layerIndex].markerSettings[markerIndex].border.opacity).toString());\n  };\n\n  Legend.prototype.bubbleToggleSelection = function (mapElement, layerIndex, bubbleIndex, legendIndex) {\n    mapElement.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n    mapElement.setAttribute('stroke', this.maps.layers[layerIndex].bubbleSettings[bubbleIndex].border.color);\n    mapElement.setAttribute('fill-opacity', this.maps.layers[layerIndex].bubbleSettings[bubbleIndex].opacity.toString());\n    mapElement.setAttribute('stroke-width', this.maps.layers[layerIndex].bubbleSettings[bubbleIndex].border.width.toString());\n    mapElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[layerIndex].bubbleSettings[bubbleIndex].border.opacity) ? this.maps.layers[layerIndex].bubbleSettings[bubbleIndex].opacity : this.maps.layers[layerIndex].bubbleSettings[bubbleIndex].border.opacity).toString());\n  };\n\n  Legend.prototype.legendClick = function (targetEle) {\n    var legendShapeId;\n    var legendTextId;\n    var legendTextColor;\n    var legendToggleFill = this.maps.legendSettings.toggleLegendSettings.fill;\n    var legendToggleOpacity = this.maps.legendSettings.toggleLegendSettings.opacity;\n    var legendToggleBorderColor = this.maps.legendSettings.toggleLegendSettings.border.color;\n    var legendToggleBorderWidth = this.maps.legendSettings.toggleLegendSettings.border.width;\n    var legendToggleBorderOpacity = isNullOrUndefined(this.maps.legendSettings.toggleLegendSettings.border.opacity) ? this.maps.legendSettings.toggleLegendSettings.opacity : this.maps.legendSettings.toggleLegendSettings.border.opacity;\n\n    if (targetEle.parentNode['id'].indexOf(this.maps.element.id + '_Legend_Index_') > -1) {\n      var mapElement = void 0;\n      var legendIndex = parseFloat(targetEle.parentElement.id.substr((this.maps.element.id + '_Legend_Index_').length)); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n      var selectedItem = this.legendCollection[legendIndex]['data'];\n      var isVisible = selectedItem['_isVisible']; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n      var shape = void 0;\n\n      if (this.maps.legendSettings.toggleLegendSettings.enable && (this.maps.legendSettings.type === 'Bubbles' || this.maps.legendSettings.type === 'Markers')) {\n        for (var k = 0; k < this.maps.layers.length; k++) {\n          for (var j = 0; j < (this.maps.legendSettings.type === 'Bubbles' ? this.maps.layers[k].bubbleSettings.length : this.maps.layers[k].markerSettings.length); j++) {\n            for (var i = 0; i < selectedItem.length; i++) {\n              shape = this.legendCollection[legendIndex]['data'][i];\n              mapElement = this.maps.legendSettings.type === 'Bubbles' ? querySelector(this.maps.element.id + '_LayerIndex_' + shape['layerIndex'] + '_BubbleIndex_' + j + '_dataIndex_' + shape['dataIndex'], this.maps.element.id) : querySelector(this.maps.element.id + '_LayerIndex_' + shape['layerIndex'] + '_MarkerIndex_' + shape['markerIndex'] + '_dataIndex_' + shape['dataIndex'], this.maps.element.id);\n\n              if (!isNullOrUndefined(shape['shape']) && shape['shape'] === 'Balloon') {\n                mapElement = mapElement.children[0];\n              }\n\n              if (isVisible && mapElement !== null) {\n                if (this.maps.legendSettings.toggleLegendSettings.applyShapeSettings) {\n                  mapElement.setAttribute('fill', this.maps.layers[k].shapeSettings.fill);\n                  mapElement.setAttribute('stroke', this.maps.layers[k].shapeSettings.border.color);\n                  mapElement.setAttribute('fill-opacity', this.maps.layers[k].shapeSettings.opacity.toString());\n                  mapElement.setAttribute('stroke-width', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.width) ? 0 : this.maps.layers[k].shapeSettings.border.width).toString());\n                  mapElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.opacity) ? this.maps.layers[k].shapeSettings.opacity : this.maps.layers[k].shapeSettings.border.opacity).toString());\n                } else {\n                  mapElement.setAttribute('fill', legendToggleFill);\n                  mapElement.setAttribute('fill-opacity', legendToggleOpacity.toString());\n                  mapElement.setAttribute('stroke', legendToggleBorderColor);\n                  mapElement.setAttribute('stroke-width', legendToggleBorderWidth.toString());\n                  mapElement.setAttribute('stroke-opacity', legendToggleBorderOpacity.toString());\n                }\n\n                if (targetEle !== null) {\n                  legendShapeId = querySelector(this.maps.element.id + '_Legend_Shape_Index_' + legendIndex, this.maps.element.id);\n                  legendShapeId.setAttribute('fill', '#E5E5E5');\n\n                  if (this.maps.legendSettings.shape === 'HorizontalLine' || this.maps.legendSettings.shape === 'VerticalLine' || this.maps.legendSettings.shape === 'Cross') {\n                    legendShapeId.setAttribute('stroke', '#E5E5E5');\n                  }\n\n                  legendTextId = querySelector(this.maps.element.id + '_Legend_Text_Index_' + legendIndex, this.maps.element.id);\n                  legendTextId.setAttribute('fill', '#E5E5E5');\n                }\n              } else {\n                if (this.maps.legendSettings.type === 'Markers') {\n                  this.markerToggleSelection(mapElement, k, j, legendIndex);\n                } else {\n                  this.bubbleToggleSelection(mapElement, k, j, legendIndex);\n                }\n\n                if (targetEle !== null) {\n                  legendShapeId = querySelector(this.maps.element.id + '_Legend_Shape_Index_' + legendIndex, this.maps.element.id);\n                  legendShapeId.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n\n                  if (this.maps.legendSettings.shape === 'HorizontalLine' || this.maps.legendSettings.shape === 'VerticalLine' || this.maps.legendSettings.shape === 'Cross') {\n                    legendShapeId.setAttribute('stroke', this.legendCollection[legendIndex]['fill']);\n                  }\n\n                  legendTextId = querySelector(this.maps.element.id + '_Legend_Text_Index_' + legendIndex, this.maps.element.id);\n                  legendTextId.setAttribute('fill', '#757575');\n                }\n              }\n            }\n\n            selectedItem['_isVisible'] = isVisible ? false : true;\n          }\n        }\n      }\n\n      if (this.maps.legendSettings.type === 'Layers' && this.maps.legendSettings.toggleLegendSettings.enable) {\n        var layerElement = void 0;\n        this.removeCollections(targetEle, legendIndex);\n        var toggledLegendIdIndex = this.maps.toggledLegendId.indexOf(legendIndex);\n\n        if (toggledLegendIdIndex !== -1) {\n          isVisible = false;\n        }\n\n        for (var j = 0; j < this.maps.layers.length; j++) {\n          for (var i = 0; i < selectedItem.length; i++) {\n            shape = this.legendCollection[legendIndex]['data'][i];\n            layerElement = querySelector(this.maps.element.id + '_LayerIndex_' + shape['layerIndex'] + '_shapeIndex_' + shape['shapeIndex'] + '_dataIndex_' + shape['dataIndex'], this.maps.element.id);\n\n            if (layerElement !== null) {\n              var toggledShapeIdIndex = this.maps.toggledShapeElementId.indexOf(layerElement.id);\n\n              if (isVisible) {\n                if (i === 0) {\n                  this.maps.toggledLegendId.push(legendIndex);\n                }\n\n                if (toggledShapeIdIndex === -1) {\n                  this.maps.toggledShapeElementId.push(layerElement.id);\n                }\n\n                if (this.maps.legendSettings.toggleLegendSettings.applyShapeSettings) {\n                  layerElement.setAttribute('fill', this.maps.layers[j].shapeSettings.fill);\n                  layerElement.setAttribute('fill-opacity', this.maps.layers[j].shapeSettings.opacity.toString());\n                  layerElement.setAttribute('stroke', this.maps.layers[j].shapeSettings.border.color);\n                  layerElement.setAttribute('stroke-width', (isNullOrUndefined(this.maps.layers[j].shapeSettings.border.width) ? 0 : this.maps.layers[j].shapeSettings.border.width).toString());\n                  layerElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[j].shapeSettings.border.opacity) ? this.maps.layers[j].shapeSettings.opacity : this.maps.layers[j].shapeSettings.border.opacity).toString());\n                } else {\n                  layerElement.setAttribute('fill', legendToggleFill);\n                  layerElement.setAttribute('fill-opacity', legendToggleOpacity.toString());\n                  layerElement.setAttribute('stroke', legendToggleBorderColor);\n                  layerElement.setAttribute('stroke-width', legendToggleBorderWidth.toString());\n                  layerElement.setAttribute('stroke-opacity', legendToggleBorderOpacity.toString());\n                }\n\n                if (targetEle !== null) {\n                  legendTextId = querySelector(this.maps.element.id + '_Legend_Text_Index_' + legendIndex, this.maps.element.id);\n                  legendTextId.setAttribute('fill', '#E5E5E5');\n                  legendShapeId = querySelector(this.maps.element.id + '_Legend_Shape_Index_' + legendIndex, this.maps.element.id);\n                  legendShapeId.setAttribute('fill', '#E5E5E5');\n                }\n              } else {\n                if (toggledLegendIdIndex !== -1 && i === 0) {\n                  this.maps.toggledLegendId.splice(toggledLegendIdIndex, 1);\n                }\n\n                if (toggledShapeIdIndex !== -1) {\n                  this.maps.toggledShapeElementId.splice(toggledShapeIdIndex, 1);\n                }\n\n                layerElement.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n                layerElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[j].shapeSettings.border.opacity) ? this.maps.layers[j].shapeSettings.opacity : this.maps.layers[j].shapeSettings.border.opacity).toString());\n                layerElement.setAttribute('stroke-width', (isNullOrUndefined(this.maps.layers[j].shapeSettings.border.width) ? 0 : this.maps.layers[j].shapeSettings.border.width).toString());\n                layerElement.setAttribute('fill-opacity', this.maps.layers[j].shapeSettings.opacity.toString());\n                layerElement.setAttribute('stroke', this.maps.layers[j].shapeSettings.border.color);\n\n                if (targetEle !== null) {\n                  legendTextId = querySelector(this.maps.element.id + '_Legend_Text_Index_' + legendIndex, this.maps.element.id);\n                  legendTextId.setAttribute('fill', '#757575');\n                  legendShapeId = querySelector(this.maps.element.id + '_Legend_Shape_Index_' + legendIndex, this.maps.element.id);\n                  legendShapeId.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n                }\n              }\n            }\n          }\n        }\n\n        selectedItem['_isVisible'] = isVisible ? false : true;\n      }\n    } else if (!isNullOrUndefined(targetEle.id) && (targetEle.id.indexOf(this.maps.element.id + '_Legend_Shape_Index') > -1 || targetEle.id.indexOf(this.maps.element.id + '_Legend_Index') !== -1) && this.maps.legendSettings.visible && targetEle.id.indexOf('_Text') === -1) {\n      var LegendInteractive = void 0;\n      var legendIndex = parseFloat(targetEle.id.split(this.maps.element.id + '_Legend_Index_')[1]); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n      var mapdata = void 0; // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n      var selectedItem = this.legendCollection[legendIndex]['data'];\n      var isVisible = selectedItem['_isVisible'];\n\n      if ((this.maps.legendSettings.type === 'Bubbles' || this.maps.legendSettings.type === 'Markers') && this.maps.legendSettings.toggleLegendSettings.enable) {\n        for (var k = 0; k < this.maps.layers.length; k++) {\n          for (var j = 0; j < (this.maps.legendSettings.type === 'Bubbles' ? this.maps.layers[k].bubbleSettings.length : this.maps.layers[k].markerSettings.length); j++) {\n            for (var i = 0; i < selectedItem.length; i++) {\n              mapdata = this.legendCollection[legendIndex]['data'][i];\n              LegendInteractive = this.maps.legendSettings.type === 'Bubbles' ? querySelector(this.maps.element.id + '_LayerIndex_' + mapdata['layerIndex'] + '_BubbleIndex_' + j + '_dataIndex_' + mapdata['dataIndex'], this.maps.element.id) : querySelector(this.maps.element.id + '_LayerIndex_' + mapdata['layerIndex'] + '_MarkerIndex_' + j + '_dataIndex_' + mapdata['dataIndex'], this.maps.element.id);\n\n              if (!isNullOrUndefined(mapdata['shape']) && mapdata['shape'] === 'Balloon') {\n                LegendInteractive = LegendInteractive.children[0];\n              }\n\n              if (isVisible && LegendInteractive !== null) {\n                if (this.maps.legendSettings.toggleLegendSettings.applyShapeSettings) {\n                  LegendInteractive.setAttribute('fill', this.maps.layers[k].shapeSettings.fill);\n                  LegendInteractive.setAttribute('stroke', this.maps.layers[k].shapeSettings.border.color);\n                  LegendInteractive.setAttribute('stroke-width', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.width) ? 0 : this.maps.layers[k].shapeSettings.border.width).toString());\n                  LegendInteractive.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.opacity) ? this.maps.layers[k].shapeSettings.opacity : this.maps.layers[k].shapeSettings.border.opacity).toString());\n                  LegendInteractive.setAttribute('fill-opacity', this.maps.layers[k].shapeSettings.opacity.toString());\n                } else {\n                  LegendInteractive.setAttribute('fill', legendToggleFill);\n                  LegendInteractive.setAttribute('fill-opacity', legendToggleOpacity.toString());\n                  LegendInteractive.setAttribute('stroke', legendToggleBorderColor);\n                  LegendInteractive.setAttribute('stroke-width', legendToggleBorderWidth.toString());\n                  LegendInteractive.setAttribute('stroke-opacity', legendToggleBorderOpacity.toString());\n                }\n\n                if (targetEle !== null) {\n                  legendTextId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex + '_Text', this.maps.element.id);\n                  legendTextId.setAttribute('fill', '#E5E5E5');\n                  legendShapeId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex, this.maps.element.id);\n                  legendShapeId.setAttribute('fill', '#E5E5E5');\n                }\n              } else {\n                if (this.maps.legendSettings.type === 'Markers') {\n                  this.markerToggleSelection(LegendInteractive, k, j, legendIndex);\n                } else {\n                  this.bubbleToggleSelection(LegendInteractive, k, j, legendIndex);\n                }\n\n                if (targetEle !== null) {\n                  legendShapeId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex, this.maps.element.id);\n                  legendShapeId.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n                  legendTextId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex + '_Text', this.maps.element.id);\n                  legendTextId.setAttribute('fill', '#757575');\n                }\n              }\n            }\n\n            selectedItem['_isVisible'] = isVisible ? false : true;\n          }\n        }\n      }\n\n      if (this.maps.legendSettings.type === 'Layers' && this.maps.legendSettings.toggleLegendSettings.enable) {\n        var mapLegendElement = void 0;\n        this.removeCollections(targetEle, legendIndex);\n        var toggleLegendIdIndex = this.maps.toggledLegendId.indexOf(legendIndex);\n\n        if (toggleLegendIdIndex !== -1) {\n          isVisible = false;\n        }\n\n        for (var k = 0; k < this.maps.layers.length; k++) {\n          for (var i = 0; i < selectedItem.length; i++) {\n            mapdata = this.legendCollection[legendIndex]['data'][i];\n            mapLegendElement = querySelector(this.maps.element.id + '_LayerIndex_' + mapdata['layerIndex'] + '_shapeIndex_' + mapdata['shapeIndex'] + '_dataIndex_' + mapdata['dataIndex'], this.maps.element.id);\n\n            if (mapLegendElement !== null) {\n              var toggledShapeIdIndex = this.maps.toggledShapeElementId.indexOf(mapLegendElement.id);\n\n              if (isVisible) {\n                if (i === 0) {\n                  this.maps.toggledLegendId.push(legendIndex);\n                }\n\n                if (toggledShapeIdIndex === -1) {\n                  this.maps.toggledShapeElementId.push(mapLegendElement.id);\n                }\n\n                if (this.maps.legendSettings.toggleLegendSettings.applyShapeSettings) {\n                  mapLegendElement.setAttribute('fill', this.maps.layers[0].shapeSettings.fill);\n                  mapLegendElement.setAttribute('stroke', this.maps.layers[0].shapeSettings.border.color);\n                  mapLegendElement.setAttribute('fill-opacity', this.maps.layers[k].shapeSettings.opacity.toString());\n                  mapLegendElement.setAttribute('stroke-width', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.width) ? 0 : this.maps.layers[k].shapeSettings.border.width).toString());\n                  mapLegendElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.opacity) ? this.maps.layers[k].shapeSettings.opacity : this.maps.layers[k].shapeSettings.border.opacity).toString());\n                } else {\n                  mapLegendElement.setAttribute('fill', legendToggleFill);\n                  mapLegendElement.setAttribute('fill-opacity', legendToggleOpacity.toString());\n                  mapLegendElement.setAttribute('stroke', legendToggleBorderColor);\n                  mapLegendElement.setAttribute('stroke-width', legendToggleBorderWidth.toString());\n                  mapLegendElement.setAttribute('stroke-opacity', legendToggleBorderOpacity.toString());\n                }\n\n                if (targetEle !== null) {\n                  legendShapeId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex, this.maps.element.id);\n                  legendShapeId.setAttribute('fill', '#E5E5E5');\n                  legendTextId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex + '_Text', this.maps.element.id);\n                  legendTextId.setAttribute('fill', '#E5E5E5');\n                }\n              } else {\n                if (toggleLegendIdIndex !== -1 && i === 0) {\n                  this.maps.toggledLegendId.splice(toggleLegendIdIndex, 1);\n                }\n\n                if (toggledShapeIdIndex !== -1) {\n                  this.maps.toggledShapeElementId.splice(toggledShapeIdIndex, 1);\n                }\n\n                mapLegendElement.setAttribute('fill-opacity', this.maps.layers[k].shapeSettings.opacity.toString());\n                mapLegendElement.setAttribute('stroke-width', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.width) ? 0 : this.maps.layers[k].shapeSettings.border.width).toString());\n                mapLegendElement.setAttribute('stroke', this.maps.layers[0].shapeSettings.border.color);\n                mapLegendElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.opacity) ? this.maps.layers[k].shapeSettings.opacity : this.maps.layers[k].shapeSettings.border.opacity).toString());\n                mapLegendElement.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n\n                if (targetEle !== null) {\n                  legendTextId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex + '_Text', this.maps.element.id);\n                  legendTextId.setAttribute('fill', '#757575');\n                  legendShapeId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex, this.maps.element.id);\n                  legendShapeId.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n                }\n              }\n            }\n          }\n        }\n\n        selectedItem['_isVisible'] = isVisible ? false : true;\n      }\n    }\n  };\n\n  Legend.prototype.removeCollections = function (targetEle, legendIndex) {\n    this.removeLegendSelectionCollection(targetEle);\n    var legendSelectionIndex = this.getIndexofLegend(this.maps.legendSelectionCollection, targetEle);\n\n    if (legendSelectionIndex !== -1) {\n      this.maps.legendSelectionCollection.splice(legendSelectionIndex, 1);\n    }\n\n    var legendHighlightIndex = this.getIndexofLegend(this.legendHighlightCollection, targetEle);\n\n    if (legendHighlightIndex !== -1) {\n      this.legendHighlightCollection.splice(legendSelectionIndex, 1);\n    }\n\n    var shapeHighlightIndex = this.getIndexofLegend(this.shapeHighlightCollection, targetEle);\n\n    if (shapeHighlightIndex !== -1) {\n      this.shapeHighlightCollection.splice(shapeHighlightIndex, 1);\n    }\n\n    var selectedIndex = this.maps.selectedLegendElementId.indexOf(legendIndex);\n\n    if (selectedIndex !== -1) {\n      this.maps.selectedLegendElementId.splice(selectedIndex, 1);\n    }\n  };\n\n  Legend.prototype.removeEventListener = function () {\n    if (this.maps.isDestroyed) {\n      return;\n    }\n\n    this.maps.off(Browser.touchMoveEvent, this.interactiveHandler);\n    this.maps.off(Browser.touchEndEvent, this.interactiveHandler);\n    this.maps.off(click, this.legendClick);\n  };\n\n  Legend.prototype.getLegendData = function ( // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  layerIndex, dataIndex, data, dataPath, // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  layerData, shapePropertyPath, value // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  ) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    var legendData = [];\n\n    if (Object.prototype.toString.call(layerData) === '[object Array]') {\n      for (var i = 0; i < layerData.length; i++) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var shapeData = layerData[i];\n        var dataPathValue = dataPath.indexOf('.') > -1 ? getValueFromObject(data, dataPath) : data[dataPath];\n        var shapePath = checkPropertyPath(data[dataPath], shapePropertyPath, shapeData['properties']);\n        var dataPathValueCase = !isNullOrUndefined(dataPathValue) ? dataPathValue.toLowerCase() : dataPathValue;\n        var shapeDataValueCase = !isNullOrUndefined(shapeData['properties'][shapePath]) && isNaN(shapeData['properties'][shapePath]) ? shapeData['properties'][shapePath].toLowerCase() : shapeData['properties'][shapePath];\n\n        if (shapeDataValueCase === dataPathValueCase) {\n          legendData.push({\n            layerIndex: layerIndex,\n            shapeIndex: i,\n            dataIndex: dataIndex,\n            name: data[dataPath],\n            value: value\n          });\n        }\n      }\n    }\n\n    return legendData;\n  };\n\n  Legend.prototype.legendGradientColor = function (colorMap, legendIndex) {\n    var legendFillColor;\n    var xmlns = 'http://www.w3.org/2000/svg';\n\n    if (!isNullOrUndefined(colorMap.color) && typeof colorMap.color === 'object') {\n      var linerGradientEle = document.createElementNS(xmlns, 'linearGradient');\n      var opacity = 1;\n      var position = this.maps.legendSettings.position;\n      var x2 = position === 'Top' || position === 'Bottom' ? '100' : '0';\n      var y2 = position === 'Top' || position === 'Bottom' ? '0' : '100';\n      linerGradientEle.setAttribute('id', 'linear_' + legendIndex + '_' + this.maps.element.id);\n      linerGradientEle.setAttribute('x1', 0 + '%');\n      linerGradientEle.setAttribute('y1', 0 + '%');\n      linerGradientEle.setAttribute('x2', x2 + '%');\n      linerGradientEle.setAttribute('y2', y2 + '%');\n\n      for (var b = 0; b < colorMap.color.length; b++) {\n        var offsetColor = 100 / (colorMap.color.length - 1);\n        var stopEle = document.createElementNS(xmlns, 'stop');\n        stopEle.setAttribute('offset', b * offsetColor + '%');\n        stopEle.setAttribute('stop-color', colorMap.color[b]);\n        stopEle.setAttribute('stop-opacity', opacity.toString());\n        linerGradientEle.appendChild(stopEle);\n      }\n\n      this.legendLinearGradient = linerGradientEle;\n      var color = 'url(' + '#linear_' + legendIndex + '_' + this.maps.element.id + ')';\n      this.defsElement.appendChild(linerGradientEle);\n      legendFillColor = color;\n    }\n\n    return legendFillColor;\n  };\n  /**\n   * Get module name.\n   *\n   * @returns {string} - Returns the module name\n   */\n\n\n  Legend.prototype.getModuleName = function () {\n    return 'Legend';\n  };\n  /**\n   * To destroy the legend.\n   *\n   * @param {Maps} maps - Specifies the instance of the maps\n   * @returns {void}\n   * @private\n   */\n\n\n  Legend.prototype.destroy = function (maps) {\n    /**\n     * Destroy method performed here\n     */\n    this.removeEventListener();\n  };\n\n  return Legend;\n}();\n\nexport { Legend };","map":{"version":3,"sources":["C:/Users/vinay/Desktop/world-map-dashboard/world-map/node_modules/@syncfusion/ej2-maps/src/maps/layers/legend.js"],"names":["click","legendRendering","Rect","measureText","PathOption","textTrim","drawBalloon","removeClass","querySelector","getTemplateFunction","maintainStyleClass","getValueFromObject","RectOption","Size","TextOption","Point","renderTextElement","drawSymbol","checkPropertyPath","getElement","isNullOrUndefined","Browser","EventHandler","remove","extend","Legend","maps","legendBorderRect","legendTotalRect","totalPages","page","currentPage","legendItemRect","heightIncrement","widthIncrement","textMaxWidth","shapeHighlightCollection","legendHighlightCollection","shapePreviousColor","selectedNonLegendShapes","shapeToggled","legendElement","addEventListener","prototype","renderLegend","legendRenderingCollections","legendCollection","defsElement","renderer","createDefs","svgObject","appendChild","calculateLegendBounds","drawLegend","_this","map","legend","legendSettings","spacing","leftPadding","topPadding","mapAreaRect","y","Array","forEach","call","layersCollection","layer","layerIndex","shapeData","layerData","dataPath","shapeDataPath","propertyPath","shapePropertyPath","dataSource","colorValuePath","colorMapping","type","visible","shapeSettings","getLegends","_i","_a","bubbleSettings","length","bubble","getMarkersLegendCollections","markerSettings","i","legendItem","eventArgs","name","cancel","fill","shape","shapeBorder","text","toString","trigger","splice","defaultSize","legendTitle","title","titleTextStyle","titleStyle","legendMode","mode","shapeX","shapeY","textX","textY","shapePadding","textPadding","shapeHeight","shapeWidth","shapeLocation","textLocation","legendRectCollection","location_1","position","labelAction","labelDisplayMode","arrangement","orientation","legendWidth","width","indexOf","availableSize","parseInt","legendHeight","height","legendItemStartX_1","legendItemStartY_1","startX","startY","legendtitleSize","itemTextStyle","textStyle","legendLength","rectWidth","rectHeight","position_1","labelPosition","textX_1","textY_1","textPadding_1","itemStartX","itemStartY","maxTextHeight","maxTextWidth","legendText","itemTextSize","Math","max","abs","push","x","textWidth","textHeight","j","Page","Collection","legendTextSize","maxSize","prvePositionX","nextPositionY","getPageChanged","prevPositionY","nextPositionX","DisplayText","ImageSrc","Shape","Text","Fill","legendShape","idIndex","collection","legendObj","index","legendRect","getRangeLegendCollection","getEqualLegendCollection","getDataLegendCollection","legendTextTrim","maxWidth","font","legendRectSize","label","size","legendWithoutTextSize","textLength","substring","totalSize","render","textOptions","textFont","legendGroup","createGroup","id","element","itemId","textId","item","bounds","renderLegendBorder","color","themeStyle","legendTextColor","rectOptions","opacity","fontFamily","legendFontSize","drawRectangle","legendToggle","drawLegendItem","shapeSize","renderOptions","pagingArrowPadding","strokeColor","strokeWidth","shapeId","imageUrl","renderOptions_1","legendTextStyle","fontStyle","fontWeight","useMarkerShape","legendShapeData","data","marker","layers","trimmedText","pagingGroup","pagingText","pagingFont","pagingTextSize","leftPageX","rightPageX","pageTextX","locY","leftPageElement","rightPageElement","rightPath","leftPath","leftPageOptions","drawPath","leftRectPageOptions","pathEle","setAttribute","tabIndex","wireEvents","rightPageOptions","rightRectPageOptions","pageTextOptions","createText","legendHighLightAndSelection","targetElement","value","shapeIndex","dataIndex","textEle","document","getElementById","replace","legendModule","multiSelectEnable","selectionSettings","enableMultiSelect","selectLength","interactProcess","parseFloat","charAt","updateLegendElement","toggleLegendCheck","toggledLegendId","toggleLegendSettings","enable","collectionIndex","getIndexofLegend","removeLegendHighlightCollection","shapeSelections","removeAllSelections","legendSelectionCollection","k","removeLegendSelectionCollection","selectedLegendElementId","legendSelection","z","idIndex_1","split","textContent","module","highlightSettings","shapeEle","shapeMatch","i_1","pushCollection","legendHighlightColor","shapeItemCount","shapeOldFillColor","getAttribute","shapeOldColor","setColor","border","legendSelectionClass","legendSelectionColor","selectedElementId","removeLegend","borderColor","borderWidth","Number","scale","oldElement","legendOldFill","legendOldOpacity","legendOldBorderColor","legendOldBorderWidth","shapeOpacity","shapeOldBorderColor","shapeOldBorderWidth","Elements","dataCount","shapeFillColor","shapeElements","shapesOfLegend","shapeElement","selectedElementIdIndex","removeShapeHighlightCollection","removeFill","shapeHighLightAndSelection","getValue","undefined","indexes","legendIndexOnShape","shapeDataOnLegend","checkSelection","selectionIndex","content","oldShapeElement","length_1","shapeMatched","selectionEle","isTargetSelected","selectedLegendIndex","multiSelection","legendSelectionIndex","addId","getElementsByClassName","target","selectEle","IsSelected","SelectionIndex","targetCollection","legendIndex","e","selectedElement","actualIndex","path","legendType","currentCollection","currentCollectionLength","dataValue","currentIndex","process","elements","currentElement","legendShapeElements","legendTextId","textElement","legendShapeId","trimTitle","textSize","legendBorder","background","getLegendAlignment","translate","legendTitleFontColor","changeNextPage","style","pointerEvents","totalRect","areaX","areaY","areaHeight","areaWidth","totalWidth","totalHeight","location","alignment","markers","markerIndex","field","templateFn","isDuplicate","imageSrc","showLegend","showLegendPath","template","templateElement","markerEle","childElementCount","src","legendFill","newData","removeDuplicateLegend","getMarkerLegendData","getOverallLegendItemsCollection","shapeValuePath","legendData","markerData","rangeData","_loop_1","colorMap","from","to","colorMapProcess_1","colorValue","getLegendData","Object","this_1","legendGradientColor","colorMapping_1","newColllection","removeDuplicates","equalValues","equalData","outOfRangeValues","outOfRange","_loop_2","eqaulColorProcess_1","equalValue","equalIndex","this_2","minOpacity","maxOpacity","range_1","outRange","rangeValue","isNaN","outfill","legendOutFill","colorMapping_2","valuePath","interactiveHandler","hoverId","stroke","markerVisible","getBubbleVisible","svgRect","getBoundingClientRect","currentData","rect","left","top","renderInteractivePointer","locX","direction","invertedPointer","pathOptions","add","touchStartEvent","isDestroyed","on","touchMoveEvent","touchEndEvent","legendClick","markerToggleSelection","mapElement","bubbleToggleSelection","bubbleIndex","targetEle","legendToggleFill","legendToggleOpacity","legendToggleBorderColor","legendToggleBorderWidth","legendToggleBorderOpacity","parentNode","parentElement","substr","selectedItem","isVisible","children","applyShapeSettings","layerElement","removeCollections","toggledLegendIdIndex","toggledShapeIdIndex","toggledShapeElementId","LegendInteractive","mapdata","mapLegendElement","toggleLegendIdIndex","legendHighlightIndex","shapeHighlightIndex","selectedIndex","removeEventListener","off","dataPathValue","shapePath","dataPathValueCase","toLowerCase","shapeDataValueCase","legendFillColor","xmlns","linerGradientEle","createElementNS","x2","y2","b","offsetColor","stopEle","legendLinearGradient","getModuleName","destroy"],"mappings":"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","sourcesContent":["import { click, legendRendering } from '../index';\nimport { Rect, measureText, PathOption, textTrim, drawBalloon, removeClass, querySelector, getTemplateFunction, maintainStyleClass, getValueFromObject } from '../utils/helper';\nimport { RectOption, Size, TextOption, Point, renderTextElement, drawSymbol, checkPropertyPath, getElement } from '../utils/helper';\nimport { isNullOrUndefined, Browser, EventHandler, remove, extend } from '@syncfusion/ej2-base';\n/**\n * Legend module is used to render legend for the maps\n */\nvar Legend = /** @class */ (function () {\n    function Legend(maps) {\n        /**\n         * @private\n         */\n        this.legendBorderRect = new Rect(0, 0, 0, 0);\n        /**\n         * @private\n         */\n        this.legendTotalRect = new Rect(0, 0, 0, 0);\n        /**\n         * @private\n         */\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        this.totalPages = [];\n        this.page = 0;\n        /**\n         * @private\n         */\n        this.currentPage = 0;\n        this.legendItemRect = new Rect(0, 0, 0, 0);\n        this.heightIncrement = 0;\n        this.widthIncrement = 0;\n        this.textMaxWidth = 0;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        this.shapeHighlightCollection = [];\n        /**\n         * @private\n         */\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        this.legendHighlightCollection = [];\n        /**\n         * @private\n         */\n        this.shapePreviousColor = [];\n        /**\n         * @private\n         */\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        this.selectedNonLegendShapes = [];\n        /**\n         * @private\n         */\n        this.shapeToggled = true;\n        /**\n         * @private\n         */\n        this.legendElement = null;\n        this.maps = maps;\n        this.addEventListener();\n    }\n    /**\n     * To calculate legend bounds and draw the legend shape and text.\n     *\n     * @returns {void}\n     */\n    Legend.prototype.renderLegend = function () {\n        this.legendRenderingCollections = [];\n        this.legendCollection = [];\n        this.totalPages = [];\n        this.widthIncrement = 0;\n        this.heightIncrement = 0;\n        this.defsElement = this.maps.renderer.createDefs();\n        this.maps.svgObject.appendChild(this.defsElement);\n        this.calculateLegendBounds();\n        this.drawLegend();\n    };\n    Legend.prototype.calculateLegendBounds = function () {\n        var _this = this;\n        var map = this.maps;\n        var legend = map.legendSettings;\n        this.legendCollection = [];\n        var spacing = 10;\n        var leftPadding = 10;\n        var topPadding = map.mapAreaRect.y;\n        this.legendRenderingCollections = [];\n        Array.prototype.forEach.call(map.layersCollection, function (layer, layerIndex) {\n            if (!isNullOrUndefined(layer.shapeData)) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                var layerData = layer.shapeData['features'];\n                var dataPath = layer.shapeDataPath;\n                var propertyPath = layer.shapePropertyPath;\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                var dataSource = layer.dataSource;\n                var colorValuePath = void 0;\n                var colorMapping = void 0;\n                if (legend.type === 'Layers' && layer.visible) {\n                    colorValuePath = layer.shapeSettings.colorValuePath;\n                    colorMapping = layer.shapeSettings.colorMapping;\n                    _this.getLegends(layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath);\n                }\n                else if (legend.type === 'Bubbles') {\n                    for (var _i = 0, _a = layer.bubbleSettings; _i < _a.length; _i++) {\n                        var bubble = _a[_i];\n                        if (bubble.visible) {\n                            colorValuePath = bubble.colorValuePath;\n                            colorMapping = bubble.colorMapping;\n                            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                            dataSource = bubble.dataSource;\n                            _this.getLegends(layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath);\n                        }\n                    }\n                }\n                else {\n                    _this.getMarkersLegendCollections(layerIndex, layer.markerSettings);\n                }\n            }\n        });\n        if (this.legendCollection.length > 0) {\n            for (var i = 0; i < this.legendCollection.length; i++) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                var legendItem = this.legendCollection[i];\n                var eventArgs = {\n                    name: legendRendering, cancel: false, fill: legendItem['fill'], shape: legend.shape,\n                    shapeBorder: legend.shapeBorder,\n                    text: typeof legendItem['text'] === 'number' ? legendItem['text'].toString() : legendItem['text']\n                };\n                map.trigger('legendRendering', eventArgs);\n                legendItem['fill'] = eventArgs.fill;\n                legendItem['shape'] = eventArgs.shape;\n                legendItem['shapeBorder'] = eventArgs.shapeBorder;\n                legendItem['text'] = eventArgs.text;\n                if (eventArgs.cancel) {\n                    this.legendCollection.splice(i, 1);\n                    i--;\n                }\n            }\n        }\n        var defaultSize = 25;\n        var legendTitle = map.legendSettings.title.text;\n        var titleTextStyle = map.legendSettings.titleStyle;\n        if (this.legendCollection.length > 0) {\n            var legendMode = legend.mode;\n            var shapeX = 0;\n            var shapeY = 0;\n            var textX = 0;\n            var textY = 0;\n            var shapePadding = legend.shapePadding;\n            var textPadding = 10;\n            var shapeHeight = legend.shapeHeight;\n            var shapeWidth = legend.shapeWidth;\n            var shapeLocation = [];\n            var textLocation = [];\n            var legendRectCollection = [];\n            var location_1;\n            var position = legend.position;\n            var labelAction = legend.labelDisplayMode;\n            var arrangement = (legend.orientation === 'None') ? ((position === 'Top' || position === 'Bottom')\n                ? 'Horizontal' : 'Vertical') : legend.orientation;\n            var legendWidth = (legend.width.length > 1) ? (legend.width.indexOf('%') > -1) ? (map.availableSize.width / 100)\n                * parseInt(legend.width, 10) : parseInt(legend.width, 10) : null;\n            var legendHeight = (legend.height.length > 1) ? (legend.height.indexOf('%') > -1) ? (map.availableSize.height / 100) *\n                parseInt(legend.height, 10) : parseInt(legend.height, 10) : null;\n            var legendItemStartX_1;\n            var legendItemStartY_1;\n            var startX = 0;\n            var startY = 0;\n            var legendtitleSize = measureText(legendTitle, titleTextStyle);\n            if (legendMode === 'Interactive') {\n                var itemTextStyle = legend.textStyle;\n                var legendLength = this.legendCollection.length;\n                var rectWidth = (arrangement === 'Horizontal') ? (isNullOrUndefined(legendWidth)) ? (map.mapAreaRect.width / legendLength) :\n                    (legendWidth / legendLength) : (isNullOrUndefined(legendWidth)) ? defaultSize : legendWidth;\n                var rectHeight = (arrangement === 'Horizontal') ? (isNullOrUndefined(legendHeight)) ? defaultSize : legendHeight :\n                    (isNullOrUndefined(legendHeight)) ? (map.mapAreaRect.height / legendLength) : (legendHeight / legendLength);\n                startX = 0;\n                startY = legendtitleSize.height + spacing;\n                var position_1 = legend.labelPosition;\n                var textX_1 = 0;\n                var textY_1 = 0;\n                var textPadding_1 = 10;\n                var itemStartX = 0;\n                var itemStartY = 0;\n                var maxTextHeight = 0;\n                var maxTextWidth = 0;\n                for (var i = 0; i < this.legendCollection.length; i++) {\n                    startX = (arrangement === 'Horizontal') ? (startX + rectWidth) : startX;\n                    startY = (arrangement === 'Horizontal') ? startY : (startY + rectHeight);\n                    var legendText = this.legendCollection[i]['text'];\n                    var itemTextSize = new Size(0, 0);\n                    if (labelAction === 'None') {\n                        itemTextSize = measureText(legendText, itemTextStyle);\n                    }\n                    else if (labelAction === 'Trim') {\n                        legendText = textTrim((arrangement === 'Horizontal' ? rectWidth : rectHeight), legendText, itemTextStyle);\n                        itemTextSize = measureText(legendText, itemTextStyle);\n                    }\n                    else {\n                        legendText = '';\n                    }\n                    maxTextHeight = Math.max(maxTextHeight, itemTextSize.height);\n                    maxTextWidth = Math.max(maxTextWidth, itemTextSize.width);\n                    if (itemTextSize.width > 0 && itemTextSize.height > 0) {\n                        if (arrangement === 'Horizontal') {\n                            textX_1 = startX + (rectWidth / 2);\n                            textY_1 = (position_1 === 'After') ? (startY + rectHeight + (itemTextSize.height / 2)) + textPadding_1 :\n                                (startY - textPadding_1);\n                        }\n                        else {\n                            textX_1 = (position_1 === 'After') ? startX - (itemTextSize.width / 2) - textPadding_1\n                                : (startX + rectWidth + itemTextSize.width / 2) + textPadding_1;\n                            textY_1 = startY + (rectHeight / 2) + (itemTextSize.height / 4);\n                        }\n                    }\n                    if (i === 0) {\n                        itemStartX = (arrangement === 'Horizontal') ? startX : (position_1 === 'After') ?\n                            textX_1 - (itemTextSize.width / 2) : startX;\n                        itemStartY = (arrangement === 'Horizontal') ? (position_1 === 'After') ? startY :\n                            textY_1 - (itemTextSize.height / 2) : startY;\n                        if (this.legendCollection.length === 1) {\n                            legendWidth = (arrangement === 'Horizontal') ? Math.abs((startX + rectWidth) - itemStartX) :\n                                (rectWidth + maxTextWidth + textPadding_1);\n                            legendHeight = (arrangement === 'Horizontal') ? (rectHeight + (maxTextHeight / 2) + textPadding_1) :\n                                Math.abs((startY + rectHeight) - itemStartY);\n                        }\n                    }\n                    else if (i === this.legendCollection.length - 1) {\n                        legendWidth = (arrangement === 'Horizontal') ? Math.abs((startX + rectWidth) - itemStartX) :\n                            (rectWidth + maxTextWidth + textPadding_1);\n                        legendHeight = (arrangement === 'Horizontal') ? (rectHeight + (maxTextHeight / 2) + textPadding_1) :\n                            Math.abs((startY + rectHeight) - itemStartY);\n                    }\n                    this.legendRenderingCollections.push({\n                        fill: this.legendCollection[i]['fill'], x: startX, y: startY,\n                        width: rectWidth, height: rectHeight,\n                        text: legendText, textX: textX_1, textY: textY_1,\n                        textWidth: itemTextSize.width, textHeight: itemTextSize.height,\n                        shapeBorder: this.legendCollection[i]['shapeBorder']\n                    });\n                }\n                if (this.legendCollection.length === 1) {\n                    legendHeight = rectHeight;\n                    legendWidth = rectWidth;\n                }\n                this.legendItemRect = { x: itemStartX, y: itemStartY, width: legendWidth, height: legendHeight };\n            }\n            else {\n                legendWidth = (isNullOrUndefined(legendWidth)) ? map.mapAreaRect.width : legendWidth;\n                legendHeight = (isNullOrUndefined(legendHeight)) ? map.mapAreaRect.height : legendHeight;\n                var j = 0;\n                this.page = 0;\n                for (var i = 0; i < this.legendCollection.length; i++) {\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    var legendItem = this.legendCollection[i];\n                    if (isNullOrUndefined(this.totalPages[this.page])) {\n                        this.totalPages[this.page] = { Page: (this.page + 1), Collection: [] };\n                    }\n                    var legendTextSize = measureText(legendItem['text'], legend.textStyle);\n                    this.textMaxWidth = Math.max(this.textMaxWidth, legendTextSize.width);\n                    if (i === 0) {\n                        startX = shapeX = (leftPadding + (shapeWidth / 2));\n                        startY = shapeY = topPadding + legendtitleSize.height + (shapeHeight > legendTextSize.height ? shapeHeight / 2\n                            : (legendTextSize.height / 4));\n                    }\n                    else {\n                        var maxSize = (legendTextSize.height > shapeHeight) ? legendTextSize.height : shapeHeight;\n                        if (arrangement === 'Horizontal') {\n                            var prvePositionX = (textLocation[j - 1].x + textLocation[j - 1].width) + textPadding + shapeWidth;\n                            if ((prvePositionX + shapePadding + legendTextSize.width) > legendWidth) {\n                                var nextPositionY = (textLocation[j - 1].y > (shapeLocation[j - 1].y + (shapeHeight / 2)) ?\n                                    textLocation[j - 1].y : (shapeLocation[j - 1].y + (shapeHeight / 2))) + topPadding;\n                                if ((nextPositionY + maxSize) > legendHeight) {\n                                    this.getPageChanged();\n                                    j = 0;\n                                    shapeLocation = [];\n                                    textLocation = [];\n                                    legendRectCollection = [];\n                                    shapeX = startX;\n                                    shapeY = startY;\n                                }\n                                else {\n                                    shapeX = (shapeLocation[0].x);\n                                    shapeY = (nextPositionY + (maxSize / 2));\n                                }\n                            }\n                            else {\n                                shapeX = (prvePositionX - (shapeWidth / 2));\n                                shapeY = (shapeLocation[j - 1]).y;\n                            }\n                        }\n                        else {\n                            var prevPositionY = textLocation[j - 1].y > shapeLocation[j - 1].y + (shapeHeight / 2) ?\n                                textLocation[j - 1].y : shapeLocation[j - 1].y + (shapeHeight / 2);\n                            if ((prevPositionY + topPadding + maxSize) > legendHeight) {\n                                var nextPositionX = (textLocation[j - 1].x + this.textMaxWidth + textPadding);\n                                if ((nextPositionX + shapePadding + legendTextSize.width) > legendWidth) {\n                                    shapeX = startX;\n                                    shapeY = startY;\n                                    legendRectCollection = [];\n                                    textLocation = [];\n                                    shapeLocation = [];\n                                    this.getPageChanged();\n                                    j = 0;\n                                }\n                                else {\n                                    shapeX = nextPositionX + (shapeWidth / 2);\n                                    shapeY = (shapeLocation[0].y);\n                                }\n                            }\n                            else {\n                                shapeX = shapeLocation[j - 1].x;\n                                shapeY = prevPositionY + topPadding + (shapeHeight / 2);\n                            }\n                        }\n                    }\n                    textX = shapeX + (shapeWidth / 2) + shapePadding;\n                    textY = shapeY + (legendTextSize.height / 4);\n                    shapeLocation.push({ x: shapeX, y: shapeY });\n                    textLocation.push({ x: textX, y: textY, width: legendTextSize.width, height: (legendTextSize.height / 2) });\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    this.totalPages[this.page]['Collection'].push({\n                        DisplayText: legendItem['text'],\n                        ImageSrc: legendItem['imageSrc'],\n                        Shape: { x: shapeX, y: shapeY },\n                        Text: { x: textX, y: textY },\n                        Fill: legendItem['fill'],\n                        legendShape: legendItem['shape'],\n                        shapeBorder: legendItem['shapeBorder'],\n                        idIndex: i,\n                        Rect: {\n                            x: shapeLocation[j].x - (shapeWidth / 2),\n                            y: (shapeLocation[j].y - (shapeHeight / 2)) < (textY - legendTextSize.height) ?\n                                (shapeLocation[j].y - (shapeHeight / 2)) : (textY - legendTextSize.height),\n                            width: Math.abs((shapeLocation[j].x - (shapeWidth / 2)) - (textX + legendTextSize.width)),\n                            height: ((shapeHeight > legendTextSize.height) ? shapeHeight : legendTextSize.height)\n                        }\n                    });\n                    j++;\n                }\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                var collection = this.totalPages[0]['Collection'];\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                Array.prototype.forEach.call(collection, function (legendObj, index) {\n                    var legendRect = new Rect(legendObj['Rect']['x'], legendObj['Rect']['y'], legendObj['Rect']['width'], legendObj['Rect']['height']);\n                    if (index === 0) {\n                        legendItemStartX_1 = legendRect.x;\n                        legendItemStartY_1 = legendRect.y;\n                    }\n                    _this.widthIncrement = Math.max(_this.widthIncrement, Math.abs(legendItemStartX_1 - (legendRect.x + legendRect.width)));\n                    _this.heightIncrement = Math.max(_this.heightIncrement, Math.abs(legendItemStartY_1 - (legendRect.y + legendRect.height)));\n                });\n                legendWidth = ((this.widthIncrement < legendWidth) ? this.widthIncrement : legendWidth);\n                legendHeight = ((this.heightIncrement < legendHeight) ? this.heightIncrement : legendHeight);\n                this.legendItemRect = {\n                    x: collection[0]['Rect']['x'], y: collection[0]['Rect']['y'],\n                    width: legendWidth, height: legendHeight\n                };\n            }\n        }\n    };\n    /**\n     * Get the legend collections\n     *\n     * @param {number} layerIndex - Specifies the layer index\n     * @param {object[]} layerData - Specifies the layer data\n     * @param {ColorMappingSettings[]} colorMapping - Specifies the color mapping\n     * @param {object[]} dataSource - Specifies the data source\n     * @param {string} dataPath - Specifies the data path\n     * @param {string} colorValuePath - Specifies the color value path\n     * @param {string | string[]} propertyPath - Specifies the property path\n     * @returns {void}\n     */\n    Legend.prototype.getLegends = function (\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath) {\n        this.getRangeLegendCollection(layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath);\n        this.getEqualLegendCollection(layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath);\n        this.getDataLegendCollection(layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath);\n    };\n    Legend.prototype.getPageChanged = function () {\n        this.page++;\n        if (isNullOrUndefined(this.totalPages[this.page])) {\n            this.totalPages[this.page] = { Page: (this.page + 1), Collection: [] };\n        }\n    };\n    Legend.prototype.legendTextTrim = function (maxWidth, text, font, legendRectSize) {\n        var label = text;\n        var size = measureText(text, font).width;\n        var legendWithoutTextSize = legendRectSize - size;\n        if (legendRectSize > maxWidth) {\n            var textLength = text.length;\n            for (var i = textLength - 1; i >= 0; --i) {\n                label = text.substring(0, i) + '...';\n                size = measureText(label, font).width;\n                var totalSize = legendWithoutTextSize + size;\n                if (totalSize <= maxWidth || label.length < 4) {\n                    if (label.length < 4) {\n                        label = ' ';\n                    }\n                    return label;\n                }\n            }\n        }\n        return label;\n    };\n    // eslint-disable-next-line valid-jsdoc\n    /**\n     * To draw the legend shape and text.\n     */\n    Legend.prototype.drawLegend = function () {\n        var map = this.maps;\n        var legend = map.legendSettings;\n        var render = map.renderer;\n        var textOptions;\n        var textFont = legend.textStyle;\n        this.legendGroup = render.createGroup({ id: map.element.id + '_Legend_Group' });\n        if (legend.mode === 'Interactive') {\n            for (var i = 0; i < this.legendRenderingCollections.length; i++) {\n                var itemId = map.element.id + '_Legend_Index_' + i;\n                var textId = map.element.id + '_Legend_Index_' + i + '_Text';\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                var item = this.legendRenderingCollections[i];\n                var bounds = new Rect(item['x'], item['y'], item['width'], item['height']);\n                if (i === 0) {\n                    this.renderLegendBorder();\n                }\n                var textLocation = new Point(item['textX'], item['textY']);\n                textFont.color = (textFont.color !== null) ? textFont.color : this.maps.themeStyle.legendTextColor;\n                var rectOptions = new RectOption(itemId, item['fill'], item['shapeBorder'], legend.opacity, bounds);\n                textOptions = new TextOption(textId, textLocation.x, textLocation.y, 'middle', item['text'], '', '');\n                textFont.fontFamily = map.themeStyle.fontFamily || textFont.fontFamily;\n                textFont.size = map.themeStyle.legendFontSize || textFont.size;\n                renderTextElement(textOptions, textFont, textFont.color, this.legendGroup);\n                this.legendGroup.appendChild(render.drawRectangle(rectOptions));\n                this.legendToggle();\n            }\n        }\n        else {\n            this.drawLegendItem(this.currentPage);\n        }\n    };\n    /**\n     * @param {string} page - Specifies the legend page.\n     * @returns {void}\n     * @private\n     */\n    Legend.prototype.drawLegendItem = function (page) {\n        var map = this.maps;\n        var legend = map.legendSettings;\n        var spacing = 10;\n        var shapeSize = new Size(legend.shapeWidth, legend.shapeHeight);\n        var textOptions;\n        var renderOptions;\n        var render = map.renderer;\n        var legendShape = legend.shape;\n        if (page >= 0 && page < this.totalPages.length) {\n            if (querySelector(this.legendGroup.id, this.maps.element.id)) {\n                remove(querySelector(this.legendGroup.id, this.maps.element.id));\n            }\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            for (var i = 0; i < this.totalPages[page]['Collection'].length; i++) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                var collection = this.totalPages[page]['Collection'][i];\n                var shapeBorder = collection['shapeBorder'];\n                var legendElement = render.createGroup({ id: map.element.id + '_Legend_Index_' + collection['idIndex'] });\n                var legendText = collection['DisplayText'];\n                var pagingArrowPadding = 4;\n                var shape = ((legend.type === 'Markers') ? ((isNullOrUndefined(collection['ImageSrc'])) ?\n                    legend.shape : 'Image') : collection['legendShape']);\n                var strokeColor = (legend.shape === 'HorizontalLine' || legend.shape === 'VerticalLine'\n                    || legend.shape === 'Cross') ? isNullOrUndefined(legend.fill) ? '#000000' : legend.fill : shapeBorder.color;\n                var strokeWidth = (legend.shape === 'HorizontalLine' || legend.shape === 'VerticalLine'\n                    || legend.shape === 'Cross') ? (shapeBorder.width === 0) ?\n                    1 : shapeBorder.width : shapeBorder.width;\n                var shapeId = map.element.id + '_Legend_Shape_Index_' + collection['idIndex'];\n                var textId = map.element.id + '_Legend_Text_Index_' + collection['idIndex'];\n                var shapeLocation = new Point(collection['Shape']['x'], (collection['Shape']['y'] - pagingArrowPadding));\n                var textLocation = new Point(collection['Text']['x'], (collection['Text']['y'] - pagingArrowPadding));\n                var imageUrl = ((isNullOrUndefined(collection['ImageSrc'])) ? legend.shape : collection['ImageSrc']);\n                var renderOptions_1 = new PathOption(shapeId, collection['Fill'], strokeWidth, strokeColor, legend.opacity, isNullOrUndefined(shapeBorder.opacity) ? legend.opacity : shapeBorder.opacity, '');\n                var legendTextStyle = {\n                    fontFamily: legend.textStyle.fontFamily, fontStyle: legend.textStyle.fontStyle,\n                    fontWeight: legend.textStyle.fontWeight, size: legend.textStyle.size, color: legend.textStyle.color, opacity: legend.textStyle.opacity\n                };\n                legendTextStyle.color = (legendTextStyle.color !== null) ? legendTextStyle.color :\n                    this.maps.themeStyle.legendTextColor;\n                legendTextStyle.fontFamily = map.themeStyle.fontFamily || legendTextStyle.fontFamily;\n                legendTextStyle.size = map.themeStyle.legendFontSize || legendTextStyle.size;\n                if (i === 0) {\n                    this.renderLegendBorder();\n                }\n                if (legend.type === 'Markers' && legend.useMarkerShape) {\n                    var legendShapeData = this.legendCollection[collection['idIndex']].data[0];\n                    var marker = map.layers[legendShapeData['layerIndex']].markerSettings[legendShapeData['markerIndex']];\n                    legendShape = !isNullOrUndefined(marker.dataSource[legendShapeData['dataIndex']][marker['shapeValuePath']]) && marker.dataSource[legendShapeData['dataIndex']][marker['shapeValuePath']] !== '' ? marker.dataSource[legendShapeData['dataIndex']][marker['shapeValuePath']] : marker.shape;\n                }\n                if (legendShape === \"Balloon\") {\n                    legendElement.appendChild(drawBalloon(map, renderOptions_1, shapeSize, { x: shapeLocation.x, y: (shapeLocation.y + 5) }, 'Legend'));\n                }\n                else {\n                    legendElement.appendChild(drawSymbol(shapeLocation, legendShape, shapeSize, collection['ImageSrc'], renderOptions_1));\n                }\n                var legendRectSize = collection['Rect']['x'] + collection['Rect']['width'];\n                if (legendRectSize > this.legendBorderRect.width) {\n                    var trimmedText = this.legendTextTrim(this.legendBorderRect.width, legendText, legendTextStyle, legendRectSize);\n                    legendText = trimmedText;\n                }\n                textOptions = new TextOption(textId, textLocation.x, textLocation.y, 'start', legendText, '', '');\n                renderTextElement(textOptions, legendTextStyle, legendTextStyle.color, legendElement);\n                this.legendGroup.appendChild(legendElement);\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                if (i === (this.totalPages[page]['Collection'].length - 1)) {\n                    var pagingGroup = void 0;\n                    var width = spacing;\n                    var height = (spacing / 2);\n                    if (this.page !== 0) {\n                        var pagingText = (page + 1) + '/' + this.totalPages.length;\n                        var pagingFont = legend.textStyle;\n                        var pagingTextSize = measureText(pagingText, pagingFont);\n                        var leftPageX = (this.legendItemRect.x + this.legendItemRect.width) - pagingTextSize.width -\n                            (width * 2) - (spacing * 2) + (pagingArrowPadding / 2);\n                        var rightPageX = (this.legendItemRect.x + this.legendItemRect.width);\n                        var pageTextX = rightPageX - width - (pagingTextSize.width / 2) - (spacing / 2) - pagingArrowPadding;\n                        var locY = (this.legendItemRect.y + this.legendItemRect.height) + (height / 2) + spacing;\n                        pagingGroup = render.createGroup({ id: map.element.id + '_Legend_Paging_Group' });\n                        var leftPageElement = render.createGroup({ id: map.element.id + '_Legend_Left_Paging_Group' });\n                        var rightPageElement = render.createGroup({ id: map.element.id + '_Legend_Right_Paging_Group' });\n                        var rightPath = ' M ' + rightPageX + ' ' + locY + ' L ' + (rightPageX - width) + ' ' + (locY - height) +\n                            ' L ' + (rightPageX - width) + ' ' + (locY + height) + ' z ';\n                        var leftPath = ' M ' + leftPageX + ' ' + locY + ' L ' + (leftPageX + width) + ' ' + (locY - height) +\n                            ' L ' + (leftPageX + width) + ' ' + (locY + height) + ' z ';\n                        var leftPageOptions = new PathOption(map.element.id + '_Left_Page', '#a6a6a6', 0, '#a6a6a6', ((page + 1) === 1 ? 0.5 : 1), 1, '', leftPath);\n                        leftPageElement.appendChild(render.drawPath(leftPageOptions));\n                        var leftRectPageOptions = new RectOption(map.element.id + '_Left_Page_Rect', 'transparent', {}, 1, new Rect(leftPageX - (width / 2), (locY - (height * 2)), width * 2, spacing * 2), null, null, '', '');\n                        var pathEle = render.drawRectangle(leftRectPageOptions);\n                        pathEle.setAttribute('tabindex', ((page + 1) === 1 ? -1 : map.tabIndex + 1).toString());\n                        leftPageElement.appendChild(pathEle);\n                        this.wireEvents(leftPageElement);\n                        var rightPageOptions = new PathOption(map.element.id + '_Right_Page', '#a6a6a6', 0, '#a6a6a6', ((page + 1) === this.totalPages.length ? 0.5 : 1), 1, '', rightPath);\n                        rightPageElement.appendChild(render.drawPath(rightPageOptions));\n                        var rightRectPageOptions = new RectOption(map.element.id + '_Right_Page_Rect', 'transparent', {}, 1, new Rect(rightPageX - spacing - (width / 2), (locY - (height * 2)), width * 2, spacing * 2), null, null, '', '');\n                        pathEle = render.drawRectangle(rightRectPageOptions);\n                        pathEle.setAttribute('tabindex', ((page + 1) === this.totalPages.length ? -1 : map.tabIndex + 2).toString());\n                        rightPageElement.appendChild(pathEle);\n                        this.wireEvents(rightPageElement);\n                        pagingGroup.appendChild(leftPageElement);\n                        pagingGroup.appendChild(rightPageElement);\n                        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                        var pageTextOptions = {\n                            'id': map.element.id + '_Paging_Text',\n                            'x': pageTextX,\n                            'y': locY + (pagingTextSize.height / 4),\n                            'fill': '#a6a6a6',\n                            'font-size': '14px',\n                            'font-style': pagingFont.fontStyle,\n                            'font-family': pagingFont.fontFamily,\n                            'font-weight': pagingFont.fontWeight,\n                            'text-anchor': 'middle',\n                            'transform': '',\n                            'opacity': 1,\n                            'dominant-baseline': ''\n                        };\n                        pagingGroup.appendChild(render.createText(pageTextOptions, pagingText));\n                        this.legendGroup.appendChild(pagingGroup);\n                    }\n                    this.legendToggle();\n                }\n            }\n        }\n    };\n    Legend.prototype.legendHighLightAndSelection = function (targetElement, value) {\n        var shapeIndex;\n        var layerIndex;\n        var dataIndex;\n        var legend = this.maps.legendSettings;\n        var textEle = legend.mode === 'Default' ? document.getElementById(targetElement.id.replace('Shape', 'Text')) :\n            document.getElementById(targetElement.id + '_Text');\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var collection = this.maps.legendModule.legendCollection;\n        var length;\n        var multiSelectEnable = !isNullOrUndefined(collection[0]['data'][0]['layerIndex']) ? this.maps.layers[collection[0]['data'][0]['layerIndex']].selectionSettings.enableMultiSelect : false;\n        var selectLength = 0;\n        var interactProcess = true;\n        var idIndex = parseFloat(targetElement.id.charAt(targetElement.id.length - 1));\n        this.updateLegendElement();\n        var toggleLegendCheck = this.maps.toggledLegendId.indexOf(idIndex);\n        if (this.maps.legendSettings.toggleLegendSettings.enable && value === 'highlight' && toggleLegendCheck !== -1) {\n            var collectionIndex = this.getIndexofLegend(this.legendHighlightCollection, targetElement);\n            if (collectionIndex !== -1) {\n                this.legendHighlightCollection.splice(collectionIndex, 1);\n            }\n            this.removeLegendHighlightCollection();\n            return null;\n        }\n        if (value === 'selection') {\n            this.shapeHighlightCollection = [];\n            if (!this.maps.shapeSelections && !multiSelectEnable) {\n                this.removeAllSelections();\n                this.maps.shapeSelections = true;\n            }\n            if (this.maps.legendSelectionCollection.length > 0 && (!multiSelectEnable ? this.maps.shapeSelections : true)) {\n                for (var k = 0; k < this.maps.legendSelectionCollection.length; k++) {\n                    if (targetElement === this.maps.legendSelectionCollection[k]['legendElement']) {\n                        this.maps.legendSelectionCollection[k]['legendElement'] = targetElement;\n                        interactProcess = false;\n                        this.removeLegendSelectionCollection(this.maps.legendSelectionCollection[k]['legendElement']);\n                        this.maps.selectedLegendElementId.splice(this.maps.selectedLegendElementId.indexOf(idIndex), 1);\n                        this.maps.legendSelectionCollection.splice(k, 1);\n                        this.maps.legendSelection = this.maps.legendSelectionCollection.length > 0 ? false : true;\n                        break;\n                    }\n                    else if (!multiSelectEnable) {\n                        if (this.maps.legendSelectionCollection.length > 1) {\n                            for (var z = 0; z < this.maps.legendSelectionCollection.length; z++) {\n                                this.removeLegendSelectionCollection(this.maps.legendSelectionCollection[z]['legendElement']);\n                            }\n                            this.maps.legendSelectionCollection = [];\n                        }\n                        else {\n                            this.removeLegendSelectionCollection(this.maps.legendSelectionCollection[k]['legendElement']);\n                            this.maps.legendSelectionCollection.splice(k, 1);\n                        }\n                    }\n                }\n            }\n        }\n        else {\n            if (this.maps.legendSelectionCollection.length > 0) {\n                for (var k = 0; k < this.maps.legendSelectionCollection.length; k++) {\n                    if ((targetElement.id.indexOf('_Legend_Shape') > -1 || targetElement.id.indexOf('_Legend_Index')) &&\n                        targetElement === this.maps.legendSelectionCollection[k]['legendElement']) {\n                        interactProcess = false;\n                        break;\n                    }\n                    else {\n                        this.removeLegendHighlightCollection();\n                    }\n                }\n            }\n            this.removeLegendHighlightCollection();\n        }\n        if (interactProcess) {\n            for (var i = 0; i < collection.length; i++) {\n                var idIndex_1 = this.maps.legendSettings.mode === 'Interactive' ?\n                    parseFloat(targetElement.id.split('_Legend_Index_')[1]) :\n                    parseFloat(targetElement.id.split('_Legend_Shape_Index_')[1]);\n                if (textEle.textContent === collection[i]['text'] && collection[i]['data'].length > 0\n                    && idIndex_1 === i) {\n                    var layer = this.maps.layers[collection[i]['data'][0]['layerIndex']];\n                    var enable = void 0;\n                    var module = void 0;\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    var data = void 0;\n                    if (!isNullOrUndefined(layer)) {\n                        enable = (value === 'selection') ? layer.selectionSettings.enable : layer.highlightSettings.enable;\n                        module = void 0;\n                        module = (value === 'selection') ? layer.selectionSettings : layer.highlightSettings;\n                        data = collection[i]['data'];\n                    }\n                    if (enable) {\n                        for (var j = 0; j < data.length; j++) {\n                            shapeIndex = data[j]['shapeIndex'];\n                            layerIndex = data[j]['layerIndex'];\n                            dataIndex = data[j]['dataIndex'];\n                            var shapeEle = document.getElementById(this.maps.element.id + '_LayerIndex_' +\n                                layerIndex + '_shapeIndex_' + shapeIndex + '_dataIndex_' + dataIndex);\n                            if (shapeEle !== null) {\n                                var shapeMatch = true;\n                                if (this.maps.legendSelectionCollection !== null) {\n                                    for (var i_1 = 0; i_1 < this.maps.legendSelectionCollection.length; i_1++) {\n                                        if (this.maps.legendSelectionCollection[i_1]['legendElement'] === targetElement) {\n                                            shapeMatch = false;\n                                            break;\n                                        }\n                                    }\n                                }\n                                if (value === 'highlight' && shapeMatch) {\n                                    if (j === 0) {\n                                        this.legendHighlightCollection = [];\n                                        this.pushCollection(targetElement, this.legendHighlightCollection, collection[i], layer.shapeSettings);\n                                    }\n                                    length = this.legendHighlightCollection.length;\n                                    var legendHighlightColor = this.legendHighlightCollection[length - 1]['legendOldFill'];\n                                    this.legendHighlightCollection[length - 1]['MapShapeCollection']['Elements'].push(shapeEle);\n                                    var shapeItemCount = this.legendHighlightCollection[length - 1]['MapShapeCollection']['Elements'].length - 1;\n                                    var shapeOldFillColor = shapeEle.getAttribute('fill');\n                                    this.legendHighlightCollection[length - 1]['shapeOldFillColor'].push(shapeOldFillColor);\n                                    var shapeOldColor = this.legendHighlightCollection[length - 1]['shapeOldFillColor'][shapeItemCount];\n                                    this.shapePreviousColor = this.legendHighlightCollection[length - 1]['shapeOldFillColor'];\n                                    this.setColor(shapeEle, !isNullOrUndefined(module.fill) ? module.fill : shapeOldColor, module.opacity.toString(), module.border.color, module.border.width.toString(), 'highlight');\n                                    this.setColor(targetElement, !isNullOrUndefined(module.fill) ? module.fill : legendHighlightColor, module.opacity.toString(), module.border.color, module.border.width.toString(), 'highlight');\n                                }\n                                else if (value === 'selection') {\n                                    this.legendHighlightCollection = [];\n                                    this.maps.legendSelectionClass = module;\n                                    if (j === 0) {\n                                        this.pushCollection(targetElement, this.maps.legendSelectionCollection, collection[i], layer.shapeSettings);\n                                        if (multiSelectEnable) {\n                                            this.maps.selectedLegendElementId.push(i);\n                                        }\n                                        else {\n                                            if (this.maps.selectedLegendElementId.length === 0) {\n                                                this.maps.selectedLegendElementId.push(i);\n                                            }\n                                            else {\n                                                this.maps.selectedLegendElementId = [];\n                                                this.maps.selectedLegendElementId.push(i);\n                                            }\n                                        }\n                                    }\n                                    selectLength = this.maps.legendSelectionCollection.length;\n                                    var legendSelectionColor = this.maps.legendSelectionCollection[selectLength - 1]['legendOldFill'];\n                                    this.maps.legendSelectionCollection[selectLength - 1]['MapShapeCollection']['Elements'].push(shapeEle);\n                                    this.maps.legendSelectionCollection[selectLength - 1]['shapeOldFillColor'] = this.shapePreviousColor;\n                                    this.setColor(targetElement, !isNullOrUndefined(module.fill) ? module.fill : legendSelectionColor, module.opacity.toString(), module.border.color, module.border.width.toString(), 'selection');\n                                    this.setColor(shapeEle, !isNullOrUndefined(module.fill) ? module.fill : legendSelectionColor, module.opacity.toString(), module.border.color, module.border.width.toString(), 'selection');\n                                    if (this.maps.selectedElementId.indexOf(shapeEle.getAttribute('id')) === -1) {\n                                        this.maps.selectedElementId.push(shapeEle.getAttribute('id'));\n                                    }\n                                    if (j === data.length - 1) {\n                                        this.maps.legendSelection = false;\n                                        this.removeLegend(this.maps.legendSelectionCollection);\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    };\n    Legend.prototype.setColor = function (element, fill, opacity, borderColor, borderWidth, type) {\n        if (type === 'selection') {\n            maintainStyleClass('ShapeselectionMap', 'ShapeselectionMapStyle', fill, opacity, borderColor, borderWidth, this.maps);\n            element.setAttribute('class', 'ShapeselectionMapStyle');\n        }\n        else {\n            element.setAttribute('fill', fill);\n            element.setAttribute('fill-opacity', opacity);\n            element.setAttribute('stroke', borderColor);\n            element.setAttribute('stroke-width', (Number(borderWidth) / this.maps.scale).toString());\n        }\n    };\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Legend.prototype.pushCollection = function (targetElement, collection, oldElement, shapeSettings) {\n        collection.push({\n            legendElement: targetElement, legendOldFill: oldElement['fill'], legendOldOpacity: oldElement['opacity'],\n            legendOldBorderColor: oldElement['borderColor'], legendOldBorderWidth: oldElement['borderWidth'],\n            shapeOpacity: shapeSettings.opacity, shapeOldBorderColor: shapeSettings.border.color,\n            shapeOldBorderWidth: shapeSettings.border.width\n        });\n        var length = collection.length;\n        collection[length - 1]['MapShapeCollection'] = { Elements: [] };\n        collection[length - 1]['shapeOldFillColor'] = [];\n    };\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Legend.prototype.removeLegend = function (collection) {\n        for (var i = 0; i < collection.length; i++) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var item = collection[i];\n            this.setColor(item['legendElement'], item['legendOldFill'], item['legendOldOpacity'], item['legendOldBorderColor'], item['legendOldBorderWidth'], 'highlight');\n            var dataCount = item['MapShapeCollection']['Elements'].length;\n            for (var j = 0; j < dataCount; j++) {\n                var shapeFillColor = item['legendOldFill'].indexOf('url') !== -1\n                    ? item['shapeOldFillColor'][j] : item['legendOldFill'];\n                this.setColor(item['MapShapeCollection']['Elements'][j], shapeFillColor, item['shapeOpacity'], item['shapeOldBorderColor'], item['shapeOldBorderWidth'], 'highlight');\n            }\n        }\n    };\n    Legend.prototype.removeLegendHighlightCollection = function () {\n        if (this.legendHighlightCollection.length > 0) {\n            this.removeLegend(this.legendHighlightCollection);\n            this.legendHighlightCollection = [];\n        }\n    };\n    Legend.prototype.removeLegendSelectionCollection = function (targetElement) {\n        if (this.maps.legendSelectionCollection.length > 0) {\n            removeClass(targetElement);\n            var shapeElements = this.shapesOfLegend(targetElement);\n            var dataCount = shapeElements.length;\n            for (var j = 0; j < dataCount; j++) {\n                var shapeElement = getElement(shapeElements[j]);\n                if (shapeElement.getAttribute('class') === 'ShapeselectionMapStyle') {\n                    removeClass(shapeElement);\n                    var selectedElementIdIndex = this.maps.selectedElementId.indexOf(shapeElement.id);\n                    if (selectedElementIdIndex !== -1) {\n                        this.maps.selectedElementId.splice(selectedElementIdIndex, 1);\n                    }\n                }\n            }\n        }\n    };\n    Legend.prototype.removeShapeHighlightCollection = function () {\n        if (this.shapeHighlightCollection.length > 0) {\n            for (var i = 0; i < this.shapeHighlightCollection.length; i++) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                var item = this.shapeHighlightCollection[i];\n                var removeFill = true;\n                for (var j = 0; j < this.maps.legendSelectionCollection.length; j++) {\n                    if (this.maps.legendSelectionCollection[j]['legendElement'] === item['legendElement']) {\n                        removeFill = false;\n                    }\n                }\n                if (removeFill) {\n                    this.setColor(item['legendElement'], item['legendOldFill'], item['legendOldOpacity'], item['legendOldBorderColor'], item['legendOldBorderWidth'], 'highlight');\n                }\n            }\n        }\n    };\n    Legend.prototype.shapeHighLightAndSelection = function (\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    targetElement, data, module, getValue, layerIndex) {\n        if (data !== undefined) {\n            this.updateLegendElement();\n            this.shapeToggled = true;\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var collection = this.maps.legendModule.legendCollection;\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var indexes = this.legendIndexOnShape(data, layerIndex);\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var shapeElement = this.shapeDataOnLegend(targetElement);\n            var toggleLegendCheck = this.maps.toggledLegendId.indexOf(indexes['actualIndex']);\n            if (this.maps.legendSettings.toggleLegendSettings.enable && toggleLegendCheck !== -1) {\n                this.shapeToggled = false;\n                this.legendHighlightCollection = [];\n                var collectionIndex = this.getIndexofLegend(this.shapeHighlightCollection, shapeElement['LegendEle']);\n                if (collectionIndex !== -1) {\n                    this.shapeHighlightCollection.splice(collectionIndex, 1);\n                }\n                this.removeShapeHighlightCollection();\n                return null;\n            }\n            if (indexes['currentIndex'] === undefined && indexes['actualIndex'] === undefined) {\n                this.removeShapeHighlightCollection();\n                return null;\n            }\n            if (indexes['currentIndex'] === undefined && getValue === 'selection'\n                && !this.maps.layers[layerIndex].selectionSettings.enableMultiSelect &&\n                targetElement.getAttribute('class') !== 'ShapeselectionMapStyle') {\n                this.maps.legendSelection = false;\n            }\n            if (getValue === 'selection' && !this.maps.layers[layerIndex].selectionSettings.enableMultiSelect &&\n                !this.maps.legendSelection) {\n                this.removeAllSelections();\n                this.maps.legendSelection = true;\n            }\n            if (indexes['currentIndex'] === undefined) {\n                if (getValue === 'selection' && indexes['actualIndex'] !== undefined) {\n                    var checkSelection = 0;\n                    for (var i = 0; i < shapeElement['Elements'].length; i++) {\n                        if (shapeElement['Elements'][i].getAttribute('class') === 'ShapeselectionMapStyle') {\n                            checkSelection++;\n                        }\n                    }\n                    var selectionIndex = this.maps.selectedLegendElementId.indexOf(indexes['actualIndex']);\n                    if (selectionIndex === -1) {\n                        this.maps.selectedLegendElementId.push(indexes['actualIndex']);\n                        this.maps.legendSelectionClass = module;\n                    }\n                    else {\n                        if ((checkSelection <= 1) && targetElement.getAttribute('class') === 'ShapeselectionMapStyle') {\n                            if (!this.maps.layers[layerIndex].selectionSettings.enableMultiSelect) {\n                                this.maps.selectedLegendElementId.splice(selectionIndex, 1);\n                            }\n                            else {\n                                if (checkSelection <= 1 && targetElement.getAttribute('class') === 'ShapeselectionMapStyle') {\n                                    this.maps.selectedLegendElementId.splice(selectionIndex, 1);\n                                }\n                            }\n                        }\n                    }\n                }\n                this.removeShapeHighlightCollection();\n                return null;\n            }\n            var text = collection[indexes['actualIndex']]['text'];\n            var content = void 0;\n            var legendShape = void 0;\n            if (this.maps.legendSettings.mode === 'Default') {\n                if (indexes['currentIndex'] !== undefined) {\n                    content = document.getElementById(this.maps.element.id + '_Legend_Text_Index_' + indexes['actualIndex']).textContent;\n                    legendShape = document.getElementById(this.maps.element.id + '_Legend_Shape_Index_' + indexes['actualIndex']);\n                }\n            }\n            else {\n                content = document.getElementById(this.maps.element.id + '_Legend_Index_' + indexes['actualIndex']\n                    + '_Text').textContent;\n                legendShape = document.getElementById(this.maps.element.id + '_Legend_Index_' + indexes['actualIndex']);\n            }\n            this.oldShapeElement = shapeElement['LegendEle'];\n            var length_1 = this.maps.legendSelectionCollection.length;\n            if (text === content) {\n                var shapeMatched = true;\n                if (this.maps.legendSelectionCollection) {\n                    for (var i = 0; i < this.maps.legendSelectionCollection.length; i++) {\n                        if (this.maps.legendSelectionCollection[i]['legendElement'] === shapeElement['LegendEle']) {\n                            shapeMatched = false;\n                            break;\n                        }\n                    }\n                }\n                if (getValue === 'highlight' && shapeMatched) {\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    var selectionEle = this.isTargetSelected(shapeElement, this.shapeHighlightCollection);\n                    if (selectionEle === undefined || (selectionEle && !selectionEle['IsSelected'])) {\n                        this.pushCollection(legendShape, this.shapeHighlightCollection, collection[indexes['actualIndex']], this.maps.layers[layerIndex].shapeSettings);\n                    }\n                    for (var j = 0; j < this.shapeHighlightCollection.length; j++) {\n                        if (shapeElement['LegendEle'].id === this.shapeHighlightCollection[j]['legendElement'].id) {\n                            this.shapeHighlightCollection[j]['legendElement'] = shapeElement['LegendEle'];\n                        }\n                    }\n                    if (length_1 > 0) {\n                        for (var j = 0; j < length_1; j++) {\n                            if (shapeElement['LegendEle'] === this.maps.legendSelectionCollection[j]['legendElement']) {\n                                this.maps.legendSelectionCollection[j]['legendElement'] = shapeElement['LegendEle'];\n                                this.removeShapeHighlightCollection();\n                                break;\n                            }\n                            else if (j === length_1 - 1) {\n                                this.removeShapeHighlightCollection();\n                                this.setColor(legendShape, !isNullOrUndefined(module.fill) ? module.fill : legendShape.getAttribute('fill'), module.opacity.toString(), module.border.color, module.border.width.toString(), 'highlight');\n                            }\n                        }\n                    }\n                    else {\n                        this.removeShapeHighlightCollection();\n                        this.setColor(legendShape, !isNullOrUndefined(module.fill) ? module.fill : legendShape.getAttribute('fill'), module.opacity.toString(), module.border.color, module.border.width.toString(), 'highlight');\n                    }\n                }\n                else if (getValue === 'selection') {\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    var selectionEle = this.isTargetSelected(shapeElement, this.maps.legendSelectionCollection);\n                    if (length_1 > 0) {\n                        var j = 0;\n                        while (j < this.maps.legendSelectionCollection.length) {\n                            if (shapeElement['LegendEle'] !== this.maps.legendSelectionCollection[j]['legendElement'] &&\n                                !module.enableMultiSelect) {\n                                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                                var element = this.maps.legendSelectionCollection[j];\n                                var selectedLegendIndex = this.maps.selectedLegendElementId.indexOf(indexes['actualIndex']);\n                                this.maps.selectedLegendElementId.splice(selectedLegendIndex, 1);\n                                this.maps.legendSelectionCollection.splice(j, 1);\n                                removeClass(element['legendElement']);\n                                this.maps.shapeSelections = true;\n                                j = 0;\n                            }\n                            else {\n                                j++;\n                            }\n                        }\n                    }\n                    if (selectionEle && (selectionEle['IsSelected'] && targetElement.getAttribute('class') === 'ShapeselectionMapStyle')) {\n                        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                        var element = this.maps.legendSelectionCollection[selectionEle['SelectionIndex']];\n                        var multiSelection = 0;\n                        if (module.enableMultiSelect) {\n                            for (var i = 0; i < shapeElement['Elements'].length; i++) {\n                                if (targetElement.getAttribute('class') === shapeElement['Elements'][i].getAttribute('class')) {\n                                    multiSelection++;\n                                }\n                            }\n                        }\n                        if (multiSelection <= 1 && (!module.enableMultiSelect ?\n                            this.maps.legendSelection : true)) {\n                            this.maps.selectedLegendElementId.splice(this.maps.selectedLegendElementId.indexOf(indexes['actualIndex']), 1);\n                            if (!isNullOrUndefined(shapeElement['LegendEle'])) {\n                                removeClass(shapeElement['LegendEle']);\n                            }\n                            this.maps.legendSelectionCollection.splice(selectionEle['SelectionIndex'], 1);\n                            this.maps.shapeSelections = true;\n                        }\n                    }\n                    else {\n                        if ((selectionEle === undefined || (selectionEle && !selectionEle['IsSelected'])) &&\n                            !isNullOrUndefined(legendShape)) {\n                            var legendSelectionIndex = this.getIndexofLegend(this.maps.legendSelectionCollection, legendShape);\n                            if (legendSelectionIndex === -1) {\n                                this.pushCollection(legendShape, this.maps.legendSelectionCollection, collection[indexes['actualIndex']], this.maps.layers[layerIndex].shapeSettings);\n                            }\n                        }\n                        var addId = true;\n                        for (var i = 0; i < this.maps.selectedLegendElementId.length; i++) {\n                            if (indexes['actualIndex'] === this.maps.selectedLegendElementId[i]) {\n                                addId = false;\n                            }\n                        }\n                        if (addId) {\n                            this.maps.selectedLegendElementId.push(indexes['actualIndex']);\n                        }\n                        this.maps.legendSelectionClass = module;\n                        this.removeLegend(this.shapeHighlightCollection);\n                        if (!isNullOrUndefined(legendShape)) {\n                            this.setColor(legendShape, !isNullOrUndefined(module.fill) ? module.fill : legendShape.getAttribute('fill'), module.opacity.toString(), module.border.color, module.border.width.toString(), 'selection');\n                            var legendSelectionIndex = this.getIndexofLegend(this.maps.legendSelectionCollection, legendShape);\n                            this.maps.legendSelectionCollection[legendSelectionIndex]['MapShapeCollection']['Elements'].push(targetElement);\n                        }\n                        this.maps.shapeSelections = false;\n                    }\n                }\n                else if (document.getElementsByClassName('highlightMapStyle').length > 0) {\n                    this.removeShapeHighlightCollection();\n                    removeClass(document.getElementsByClassName('highlightMapStyle')[0]);\n                }\n            }\n        }\n        else {\n            this.removeShapeHighlightCollection();\n        }\n    };\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Legend.prototype.isTargetSelected = function (target, collection) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var selectEle;\n        for (var i = 0; i < collection.length; i++) {\n            if (!isNullOrUndefined(target['LegendEle'].getAttribute('id')) &&\n                (target['LegendEle'].getAttribute('id') === collection[i]['legendElement'].getAttribute('id'))) {\n                selectEle = { IsSelected: true, SelectionIndex: i };\n            }\n        }\n        return selectEle;\n    };\n    Legend.prototype.updateLegendElement = function () {\n        for (var i = 0; i < this.maps.legendSelectionCollection.length; i++) {\n            if (document.getElementById(this.maps.legendSelectionCollection[i]['legendElement'].id)) {\n                this.maps.legendSelectionCollection[i]['legendElement'] =\n                    document.getElementById(this.maps.legendSelectionCollection[i]['legendElement'].id);\n            }\n        }\n    };\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Legend.prototype.getIndexofLegend = function (targetCollection, targetElement) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var legendIndex = targetCollection.map(function (e) { return e['legendElement']; }).indexOf(targetElement);\n        return legendIndex;\n    };\n    Legend.prototype.removeAllSelections = function () {\n        for (var i = 0; i < this.maps.selectedElementId.length; i++) {\n            var selectedElement = document.getElementById(this.maps.selectedElementId[i]);\n            removeClass(selectedElement);\n        }\n        for (var j = 0; j < this.maps.selectedLegendElementId.length; j++) {\n            var idIndex = this.maps.legendSettings.mode === 'Interactive' ?\n                'container_Legend_Index_' : 'container_Legend_Shape_Index_';\n            var selectedElement = idIndex + this.maps.selectedLegendElementId[j];\n            var legendElement = document.getElementById(selectedElement);\n            if (!isNullOrUndefined(legendElement)) {\n                removeClass(document.getElementById(selectedElement));\n            }\n        }\n        this.maps.legendSelectionCollection = [];\n        this.maps.selectedLegendElementId = [];\n        this.maps.selectedElementId = [];\n    };\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Legend.prototype.legendIndexOnShape = function (data, index) {\n        var legendIndex;\n        var actualIndex;\n        var path = this.maps.layers[index].shapeDataPath;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var value = data[path];\n        var legendType = this.maps.legendSettings.mode;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var collection = this.maps.legendModule.legendCollection;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var currentCollection;\n        if (legendType === 'Default' && !isNullOrUndefined(this.maps.legendModule.totalPages)) {\n            currentCollection = this.maps.legendModule.totalPages[this.maps.legendModule.currentPage]['Collection'];\n        }\n        var currentCollectionLength = legendType === 'Default' ? currentCollection['length'] : 1;\n        for (var i = 0; i < collection.length; i++) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var dataValue = collection[i]['data'];\n            for (var k = 0; k < currentCollectionLength; k++) {\n                if (legendType !== 'Default' || collection[i]['text'] === currentCollection[k]['DisplayText']) {\n                    for (var j = 0; j < dataValue.length; j++) {\n                        if (value === dataValue[j]['name']) {\n                            legendIndex = k;\n                        }\n                    }\n                }\n            }\n            for (var j = 0; j < dataValue.length; j++) {\n                if (value === dataValue[j]['name']) {\n                    actualIndex = i;\n                }\n            }\n        }\n        return { currentIndex: legendIndex, actualIndex: actualIndex };\n    };\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Legend.prototype.shapeDataOnLegend = function (targetElement) {\n        var shapeIndex;\n        var layerIndex;\n        var dataIndex;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var collection = this.maps.legendModule.legendCollection;\n        var legend = this.maps.legendSettings;\n        for (var i = 0; i < collection.length; i++) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var data = collection[i]['data'];\n            var process = false;\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var elements = [];\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var currentElement = { Elements: [] };\n            for (var j = 0; j < data.length; j++) {\n                shapeIndex = data[j]['shapeIndex'];\n                layerIndex = data[j]['layerIndex'];\n                dataIndex = data[j]['dataIndex'];\n                var shapeEle = document.getElementById(this.maps.element.id + '_LayerIndex_' +\n                    layerIndex + '_shapeIndex_' + shapeIndex + '_dataIndex_' + dataIndex);\n                if (targetElement === shapeEle) {\n                    process = true;\n                }\n                elements.push(shapeEle);\n            }\n            if (process) {\n                if (isNullOrUndefined(currentElement['LegendEle'])) {\n                    currentElement['LegendEle'] = legend.mode === 'Default' ?\n                        document.getElementById(this.maps.element.id + '_Legend_Shape_Index_' + i) :\n                        document.getElementById(this.maps.element.id + '_Legend_Index_' + i);\n                }\n                currentElement['Elements'] = elements;\n                return currentElement;\n            }\n        }\n        return null;\n    };\n    Legend.prototype.shapesOfLegend = function (targetElement) {\n        var shapeIndex;\n        var layerIndex;\n        var dataIndex;\n        var idIndex = parseFloat(targetElement.id.charAt(targetElement.id.length - 1));\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var data = this.maps.legendModule.legendCollection[idIndex]['data'];\n        var legendShapeElements = [];\n        for (var i = 0; i < data.length; i++) {\n            shapeIndex = data[i]['shapeIndex'];\n            layerIndex = data[i]['layerIndex'];\n            dataIndex = data[i]['dataIndex'];\n            var shapeElement = document.getElementById(this.maps.element.id + '_LayerIndex_' +\n                layerIndex + '_shapeIndex_' + shapeIndex + '_dataIndex_' + dataIndex);\n            if (!isNullOrUndefined(shapeElement)) {\n                legendShapeElements.push(shapeElement.id);\n            }\n        }\n        return legendShapeElements;\n    };\n    Legend.prototype.legendToggle = function () {\n        var map = this.maps;\n        var legend = map.legendSettings;\n        if (this.maps.selectedLegendElementId) {\n            // To maintain the state of legend selection during page resize.\n            for (var j = 0; j < this.maps.selectedLegendElementId.length; j++) {\n                var idIndex = legend.mode === 'Interactive' ? this.maps.element.id + '_Legend_Index_' : this.maps.element.id + '_Legend_Shape_Index_';\n                var selectedElement = map.svgObject.querySelector('#' + idIndex + this.maps.selectedLegendElementId[j]);\n                if (!isNullOrUndefined(selectedElement)) {\n                    var fill = !isNullOrUndefined(this.maps.legendSelectionClass.fill) ?\n                        this.maps.legendSelectionClass.fill : selectedElement.getAttribute('fill');\n                    this.setColor(selectedElement, fill, this.maps.legendSelectionClass.opacity.toString(), this.maps.legendSelectionClass.border.color, this.maps.legendSelectionClass.border.width.toString(), 'selection');\n                    for (var i = 0; i < this.maps.legendSelectionCollection.length; i++) {\n                        if (this.maps.legendSelectionCollection[i]['legendElement'].id === selectedElement.id) {\n                            this.maps.legendSelectionCollection[i]['legendElement'] = selectedElement;\n                        }\n                    }\n                    var legendSelectionIndex = this.getIndexofLegend(this.maps.legendSelectionCollection, selectedElement);\n                    if (legendSelectionIndex === -1) {\n                        var layerIndex = this.maps.legendModule.legendCollection[this.maps.selectedLegendElementId[j]]['data'][j]['layerIndex'];\n                        this.pushCollection(selectedElement, this.maps.legendSelectionCollection, this.maps.legendModule.legendCollection[this.maps.selectedLegendElementId[j]], this.maps.layers[layerIndex].shapeSettings);\n                    }\n                }\n            }\n        }\n        if (this.maps.toggledLegendId) {\n            for (var j = 0; j < this.maps.toggledLegendId.length; j++) {\n                var legendTextId = legend.mode === 'Interactive' ? ('#' + this.maps.element.id + '_Legend_Index_' + this.maps.toggledLegendId[j] + '_Text') : ('#' + this.maps.element.id + '_Legend_Text_Index_' + this.maps.toggledLegendId[j]);\n                var textElement = map.svgObject.querySelector(legendTextId);\n                if (!isNullOrUndefined(textElement)) {\n                    textElement.setAttribute('fill', '#E5E5E5');\n                }\n                var legendShapeId = legend.mode === 'Interactive' ? ('#' + this.maps.element.id + '_Legend_Index_' + this.maps.toggledLegendId[j]) : ('#' + this.maps.element.id + '_Legend_Shape_Index_' + this.maps.toggledLegendId[j]);\n                var legendElement = map.svgObject.querySelector(legendShapeId);\n                if (!isNullOrUndefined(legendElement)) {\n                    legendElement.setAttribute('fill', '#E5E5E5');\n                }\n            }\n        }\n    };\n    Legend.prototype.renderLegendBorder = function () {\n        var map = this.maps;\n        var legend = map.legendSettings;\n        var legendTitle = legend.title.text;\n        var textStyle = {\n            fontFamily: legend.titleStyle.fontFamily, fontStyle: legend.titleStyle.fontStyle,\n            fontWeight: legend.titleStyle.fontWeight, size: legend.titleStyle.size, color: legend.titleStyle.color, opacity: legend.titleStyle.opacity\n        };\n        var textOptions;\n        var spacing = 10;\n        var trimTitle = textTrim((this.legendItemRect.width + (spacing * 2)), legendTitle, textStyle);\n        var textSize = measureText(trimTitle, textStyle);\n        this.legendBorderRect = new Rect((this.legendItemRect.x - spacing), (this.legendItemRect.y - spacing - textSize.height), (this.legendItemRect.width) + (spacing * 2), (this.legendItemRect.height) + (spacing * 2) + textSize.height +\n            (legend.mode === 'Interactive' ? 0 : (this.page !== 0) ? spacing : 0));\n        var legendBorder = {\n            color: legend.border.color, width: legend.border.width, opacity: legend.border.opacity\n        };\n        legendBorder.opacity = isNullOrUndefined(legendBorder.opacity) ? 1 : legendBorder.opacity;\n        var renderOptions = new RectOption(map.element.id + '_Legend_Border', legend.background, legendBorder, 1, this.legendBorderRect, null, null, '', '');\n        this.legendGroup.appendChild(map.renderer.drawRectangle(renderOptions));\n        this.getLegendAlignment(map, this.legendBorderRect.width, this.legendBorderRect.height, legend);\n        this.legendGroup.setAttribute('transform', 'translate( ' + (this.translate.x + (-(this.legendBorderRect.x))) + ' ' +\n            (this.translate.y + (-(this.legendBorderRect.y))) + ' )');\n        map.svgObject.appendChild(this.legendGroup);\n        if (legendTitle) {\n            textStyle.color = (textStyle.color !== null) ? textStyle.color : this.maps.themeStyle.legendTitleFontColor;\n            textStyle.fontFamily = !isNullOrUndefined(textStyle.fontFamily) ? textStyle.fontFamily : this.maps.themeStyle.fontFamily;\n            textOptions = new TextOption(map.element.id + '_LegendTitle', (this.legendItemRect.x) + (this.legendItemRect.width / 2), this.legendItemRect.y - (textSize.height / 2) - spacing / 2, 'middle', trimTitle, '');\n            renderTextElement(textOptions, textStyle, textStyle.color, this.legendGroup);\n        }\n    };\n    Legend.prototype.changeNextPage = function (e) {\n        this.currentPage = (e.target.id.indexOf('_Left_Page_') > -1) ? (this.currentPage - 1) :\n            (this.currentPage + 1);\n        this.legendGroup = this.maps.renderer.createGroup({ id: this.maps.element.id + '_Legend_Group' });\n        this.drawLegendItem(this.currentPage);\n        if (querySelector(this.maps.element.id + '_Legend_Border', this.maps.element.id)) {\n            querySelector(this.maps.element.id + '_Legend_Border', this.maps.element.id).style.pointerEvents = 'none';\n        }\n    };\n    Legend.prototype.getLegendAlignment = function (map, width, height, legend) {\n        var x;\n        var y;\n        var spacing = 10;\n        var totalRect;\n        // eslint-disable-next-line prefer-const\n        totalRect = extend({}, map.mapAreaRect, totalRect, true);\n        var areaX = totalRect.x;\n        var areaY = totalRect.y;\n        var areaHeight = totalRect.height;\n        var areaWidth = totalRect.width;\n        var totalWidth = map.availableSize.width;\n        var totalHeight = map.availableSize.height;\n        if (legend.position === 'Float') {\n            this.translate = legend.location;\n        }\n        else {\n            switch (legend.position) {\n                case 'Top':\n                case 'Bottom':\n                    totalRect.height = (areaHeight - height);\n                    x = (totalWidth / 2) - (width / 2);\n                    y = (legend.position === 'Top') ? areaY : (areaY + totalRect.height);\n                    totalRect.y = (legend.position === 'Top') ? areaY + height + spacing : areaY;\n                    break;\n                case 'Left':\n                case 'Right':\n                    totalRect.width = (areaWidth - width);\n                    x = (legend.position === 'Left') ? areaX : (areaX + totalRect.width) - spacing;\n                    y = (totalHeight / 2) - (height / 2);\n                    totalRect.x = (legend.position === 'Left') ? areaX + width : areaX;\n                    break;\n            }\n            switch (legend.alignment) {\n                case 'Near':\n                    if (legend.position === 'Top' || legend.position === 'Bottom') {\n                        x = totalRect.x;\n                    }\n                    else {\n                        y = totalRect.y;\n                    }\n                    break;\n                case 'Far':\n                    if (legend.position === 'Top' || legend.position === 'Bottom') {\n                        x = (totalWidth - width) - spacing;\n                    }\n                    else {\n                        y = totalHeight - height;\n                    }\n                    break;\n            }\n            if ((legend.height || legend.width) && legend.mode !== 'Interactive') {\n                this.legendTotalRect = map.totalRect = totalRect;\n            }\n            else {\n                if ((legend.height || legend.width) && legend.mode === 'Interactive') {\n                    map.totalRect = totalRect;\n                }\n                this.legendTotalRect = map.mapAreaRect = totalRect;\n            }\n            this.translate = new Point(x, y);\n        }\n    };\n    Legend.prototype.getMarkersLegendCollections = function (layerIndex, markers) {\n        var _this = this;\n        Array.prototype.forEach.call(markers, function (marker, markerIndex) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var dataSource = marker.dataSource;\n            var field = marker.legendText;\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var templateFn;\n            var isDuplicate;\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            Array.prototype.forEach.call(dataSource, function (data, dataIndex) {\n                var imageSrc = null;\n                var showLegend = isNullOrUndefined(data[_this.maps.legendSettings.showLegendPath]) ? true :\n                    data[_this.maps.legendSettings.showLegendPath];\n                if (marker.visible && showLegend && (!isNullOrUndefined(data['latitude'])) && (!isNullOrUndefined(data['longitude']))) {\n                    if (marker.template) {\n                        templateFn = getTemplateFunction(marker.template);\n                        var templateElement = templateFn(_this.maps);\n                        var markerEle = isNullOrUndefined(templateElement.childElementCount) ? templateElement[0] :\n                            templateElement;\n                        imageSrc = markerEle.querySelector('img').src;\n                    }\n                    var text = isNullOrUndefined(data[field]) ? '' : data[field];\n                    var legendFill = !isNullOrUndefined(marker.colorValuePath) ? data[marker.colorValuePath] : marker.fill;\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    var newData = [];\n                    if (_this.maps.legendSettings.removeDuplicateLegend) {\n                        newData.push(_this.getMarkerLegendData(layerIndex, text, legendFill));\n                        _this.getOverallLegendItemsCollection(text, legendFill, newData, showLegend);\n                    }\n                    else {\n                        newData.push({ layerIndex: layerIndex, markerIndex: markerIndex, dataIndex: dataIndex, value: legendFill, name: text,\n                            shape: (!isNullOrUndefined(marker.shapeValuePath) && !isNullOrUndefined(data[marker.shapeValuePath]) && data[marker.shapeValuePath] !== '') ? data[marker.shapeValuePath] : (_this.maps.legendSettings.useMarkerShape ? marker.shape : _this.maps.legendSettings.shape) });\n                        _this.getOverallLegendItemsCollection(text, legendFill, newData, showLegend);\n                    }\n                }\n            });\n        });\n    };\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Legend.prototype.getMarkerLegendData = function (layerIndex, text, legendFill) {\n        var _this = this;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var legendData = [];\n        this.maps.layers[layerIndex].markerSettings.map(function (markerSettings, markerIndex) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var markerData = markerSettings.dataSource;\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            Array.prototype.forEach.call(markerData, function (data, dataIndex) {\n                var marker = _this.maps.layers[layerIndex].markerSettings[markerIndex];\n                if ((text === data[marker.legendText] || text === '') && legendFill === data[marker.colorValuePath]) {\n                    legendData.push({ layerIndex: layerIndex, markerIndex: markerIndex, dataIndex: dataIndex, value: legendFill, name: text,\n                        shape: !isNullOrUndefined(marker.shapeValuePath) ? data[marker.shapeValuePath] : marker.shape });\n                }\n            });\n        });\n        return legendData;\n    };\n    Legend.prototype.getRangeLegendCollection = function (\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath) {\n        var _this = this;\n        var legendText;\n        var legendIndex = 0;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var fill = this.maps.legendSettings.fill;\n        var rangeData = [];\n        var _loop_1 = function (colorMap) {\n            if (!isNullOrUndefined(colorMap.from) && !isNullOrUndefined(colorMap.to)) {\n                legendText = !isNullOrUndefined(colorMap.label) ? colorMap.label : colorMap.from + ' - ' + colorMap.to;\n                rangeData = [];\n                var colorMapProcess_1 = false;\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                Array.prototype.forEach.call(dataSource, function (data, dataIndex) {\n                    var colorValue = (colorValuePath.indexOf('.') > -1) ? Number(getValueFromObject(data, colorValuePath)) :\n                        parseFloat(data[colorValuePath]);\n                    if (colorValue >= colorMap.from && colorValue <= colorMap.to) {\n                        colorMapProcess_1 = true;\n                        rangeData.push(_this.getLegendData(layerIndex, dataIndex, data, dataPath, layerData, propertyPath, colorValue));\n                    }\n                });\n                if (!colorMapProcess_1) {\n                    rangeData.push({\n                        layerIndex: layerIndex, shapeIndex: null, dataIndex: null,\n                        name: null, value: null\n                    });\n                }\n                var legendFill = (isNullOrUndefined(fill)) ? Object.prototype.toString.call(colorMap.color) === '[object Array]' ?\n                    !isNullOrUndefined(colorMap.value) ? colorMap.color[0] : this_1.legendGradientColor(colorMap, legendIndex) :\n                    colorMap.color : fill;\n                legendIndex++;\n                this_1.getOverallLegendItemsCollection(legendText, legendFill, rangeData, colorMap.showLegend);\n            }\n        };\n        var this_1 = this;\n        for (var _i = 0, colorMapping_1 = colorMapping; _i < colorMapping_1.length; _i++) {\n            var colorMap = colorMapping_1[_i];\n            _loop_1(colorMap);\n        }\n    };\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Legend.prototype.getOverallLegendItemsCollection = function (legendText, legendFill, legendData, showLegend) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var newColllection = [];\n        var legend = this.maps.legendSettings;\n        if (legendData.length > 0 && showLegend) {\n            for (var i = 0; i < legendData.length; i++) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                var collection = legendData[i];\n                if (collection.length > 0) {\n                    for (var j = 0; j < collection.length; j++) {\n                        newColllection.push(collection[j]);\n                    }\n                }\n                else {\n                    newColllection.push(legendData[i]);\n                }\n                newColllection['_isVisible'] = true;\n            }\n            var isDuplicate = this.maps.legendSettings.removeDuplicateLegend ?\n                this.removeDuplicates(this.legendCollection, legendText, legendFill) : false;\n            if (!isDuplicate) {\n                this.legendCollection.push({\n                    text: legendText, fill: legendFill, data: newColllection, opacity: legend.opacity,\n                    borderColor: legend.shapeBorder.color, borderWidth: legend.shapeBorder.width\n                });\n            }\n        }\n    };\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    Legend.prototype.removeDuplicates = function (legendCollection, text, legendFill) {\n        var isDuplicate = false;\n        for (var i = 0; i < legendCollection.length; i++) {\n            if ((legendCollection[i]['text'] === text || legendCollection[i]['text'] === '') && legendCollection[i]['fill'] === legendFill) {\n                isDuplicate = true;\n                break;\n            }\n            else {\n                continue;\n            }\n        }\n        return isDuplicate;\n    };\n    Legend.prototype.getEqualLegendCollection = function (\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath) {\n        var _this = this;\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var fill = this.maps.legendSettings.fill;\n        var equalValues = [];\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var legendText;\n        var legendIndex = 0;\n        var equalData = [];\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var outOfRangeValues = [];\n        var outOfRange = [];\n        var _loop_2 = function (colorMap) {\n            if (!isNullOrUndefined(colorMap.value)) {\n                legendText = !isNullOrUndefined(colorMap.label) ? colorMap.label : colorMap.value;\n                equalData = [];\n                var eqaulColorProcess_1 = false;\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                Array.prototype.forEach.call(dataSource, function (data, dataIndex) {\n                    var equalValue = ((colorValuePath.indexOf('.') > -1) ? (getValueFromObject(data, colorValuePath)) :\n                        (data[colorValuePath]));\n                    if (equalValue === colorMap.value) {\n                        eqaulColorProcess_1 = true;\n                        if (equalValues.indexOf(equalValue) === -1) {\n                            equalValues.push(equalValue);\n                        }\n                        equalData.push(_this.getLegendData(layerIndex, dataIndex, data, dataPath, layerData, propertyPath, equalValue));\n                    }\n                    else {\n                        if (outOfRangeValues.indexOf(equalValue) === -1) {\n                            outOfRangeValues.push(equalValue);\n                        }\n                    }\n                });\n                for (var x = 0; x < equalValues.length; x++) {\n                    for (var y = 0; y < outOfRangeValues.length; y++) {\n                        if (equalValues[x] === outOfRangeValues[y]) {\n                            var equalIndex = outOfRangeValues.indexOf(equalValues[x]);\n                            outOfRangeValues.splice(equalIndex, 1);\n                        }\n                    }\n                }\n                if (!eqaulColorProcess_1) {\n                    equalData.push({\n                        layerIndex: layerIndex, shapeIndex: null, dataIndex: null,\n                        name: null, value: null\n                    });\n                }\n                var legendFill = (isNullOrUndefined(fill)) ? Object.prototype.toString.call(colorMap.color) === '[object Array]'\n                    ? colorMap.color[0] : colorMap.color : fill;\n                legendIndex++;\n                this_2.getOverallLegendItemsCollection(legendText, legendFill, equalData, colorMap.showLegend);\n            }\n            else if (isNullOrUndefined(colorMap.minOpacity) && isNullOrUndefined(colorMap.maxOpacity) && isNullOrUndefined(colorMap.value)\n                && isNullOrUndefined(colorMap.from) && isNullOrUndefined(colorMap.to) && !isNullOrUndefined(colorMap.color)) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                Array.prototype.forEach.call(dataSource, function (data, dataIndex) {\n                    var equalValue = ((colorValuePath.indexOf('.') > -1) ? (getValueFromObject(data, colorValuePath)) :\n                        (data[colorValuePath]));\n                    for (var k = 0; k < outOfRangeValues.length; k++) {\n                        if (equalValue === outOfRangeValues[k]) {\n                            outOfRange.push(_this.getLegendData(layerIndex, dataIndex, data, dataPath, layerData, propertyPath, equalValue));\n                        }\n                    }\n                });\n                if (outOfRangeValues.length === 0) {\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    var range_1 = false;\n                    var outRange = [];\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    Array.prototype.forEach.call(dataSource, function (data, dataIndex) {\n                        range_1 = false;\n                        var rangeValue = data[colorValuePath];\n                        for (var z = 0; z < colorMapping.length; z++) {\n                            if (!isNullOrUndefined(rangeValue) && !isNaN(rangeValue)) {\n                                if (rangeValue >= colorMapping[z].from && rangeValue <= colorMapping[z].to) {\n                                    range_1 = true;\n                                }\n                            }\n                            else if (!range_1) {\n                                range_1 = false;\n                            }\n                        }\n                        if (!range_1) {\n                            outOfRange.push(_this.getLegendData(layerIndex, dataIndex, data, dataPath, layerData, propertyPath, rangeValue));\n                        }\n                    });\n                }\n                legendText = !isNullOrUndefined(colorMap.label) ? colorMap.label : 'Others';\n                var outfill = ((Object.prototype.toString.call(colorMap.color) === '[object Array]'))\n                    ? colorMap.color[0] : colorMap.color;\n                var legendOutFill = outfill;\n                legendIndex++;\n                this_2.getOverallLegendItemsCollection(legendText, legendOutFill, outOfRange, colorMap.showLegend);\n            }\n        };\n        var this_2 = this;\n        for (var _i = 0, colorMapping_2 = colorMapping; _i < colorMapping_2.length; _i++) {\n            var colorMap = colorMapping_2[_i];\n            _loop_2(colorMap);\n        }\n    };\n    Legend.prototype.getDataLegendCollection = function (\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    layerIndex, layerData, colorMapping, dataSource, dataPath, colorValuePath, propertyPath) {\n        var _this = this;\n        var legendText;\n        var fill = this.maps.legendSettings.fill;\n        var valuePath = this.maps.legendSettings.valuePath;\n        if (!isNullOrUndefined(colorValuePath) && !isNullOrUndefined(dataSource)) {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            Array.prototype.forEach.call(dataSource, function (data, dataIndex) {\n                var showLegend = isNullOrUndefined(_this.maps.legendSettings.showLegendPath) ?\n                    true : isNullOrUndefined(data[_this.maps.legendSettings.showLegendPath]) ?\n                    false : data[_this.maps.legendSettings.showLegendPath];\n                var dataValue = ((colorValuePath.indexOf('.') > -1) ? (getValueFromObject(data, colorValuePath)) :\n                    (data[colorValuePath]));\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                var newData = [];\n                var legendFill = (isNullOrUndefined(fill)) ? dataValue : fill;\n                if (!isNullOrUndefined(dataValue) && colorMapping.length === 0) {\n                    legendText = !isNullOrUndefined(data[valuePath]) ? ((valuePath.indexOf('.') > -1) ?\n                        getValueFromObject(data, valuePath) : data[valuePath]) : ((dataPath.indexOf('.') > -1) ?\n                        getValueFromObject(data, dataPath) : data[dataPath]);\n                    newData.push(_this.getLegendData(layerIndex, dataIndex, data, dataPath, layerData, propertyPath, dataValue));\n                }\n                _this.getOverallLegendItemsCollection(legendText, legendFill, newData, showLegend);\n            });\n        }\n    };\n    Legend.prototype.interactiveHandler = function (e) {\n        var target = e.target;\n        var legend = this.maps.legendSettings;\n        var id = this.maps.element.id + '_Interactive_Legend';\n        var hoverId = legend.type === 'Layers' ? '_shapeIndex_' : (legend.type === 'Markers') ? '_MarkerIndex_' :\n            '_BubbleIndex_';\n        if (target.id.indexOf(hoverId) > 1) {\n            var layerIndex = parseFloat(target.id.split('_LayerIndex_')[1].split('_')[0]);\n            var dataIndex = parseFloat(target.id.split(/_dataIndex_/i)[1].split('_')[0]);\n            var fill = void 0;\n            var stroke = void 0;\n            var strokeWidth = void 0;\n            if (!(isNullOrUndefined(querySelector(id, this.maps.element.id)))) {\n                remove(querySelector(id, this.maps.element.id));\n            }\n            var layer = this.maps.layersCollection[layerIndex];\n            var markerVisible = (legend.type === 'Layers' ? layer.visible :\n                legend.type === 'Markers' ? layer.markerSettings[parseFloat(target.id.split('_MarkerIndex_')[1].split('_')[0])].visible :\n                    (this.maps.getBubbleVisible(this.maps.layersCollection[layerIndex])));\n            if (legend.visible && this.legendRenderingCollections.length > 0\n                && legend.mode === 'Interactive' && markerVisible) {\n                var svgRect = this.maps.svgObject.getBoundingClientRect();\n                for (var i = 0; i < this.legendCollection.length; i++) {\n                    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                    var currentData = this.legendCollection[i];\n                    var legendElement = querySelector(this.maps.element.id + '_Legend_Index_' + i, this.maps.element.id);\n                    var legendRect = legendElement.getBoundingClientRect();\n                    var rect = new Rect(Math.abs(legendRect.left - svgRect.left), Math.abs(legendRect.top - svgRect.top), legendRect.width, legendRect.height);\n                    fill = legendElement.getAttribute('fill');\n                    stroke = legend.shapeBorder.color;\n                    strokeWidth = legend.shapeBorder.width;\n                    if (!isNullOrUndefined(currentData['data'])) {\n                        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                        var data = currentData['data'];\n                        for (var j = 0; j < data.length; j++) {\n                            if (dataIndex === data[j]['dataIndex'] && layerIndex === data[j]['layerIndex']) {\n                                this.renderInteractivePointer(legend, fill, stroke, id, strokeWidth, rect);\n                                break;\n                            }\n                        }\n                    }\n                }\n            }\n        }\n        else {\n            if (!(isNullOrUndefined(querySelector(id, this.maps.element.id)))) {\n                remove(querySelector(id, this.maps.element.id));\n            }\n        }\n    };\n    Legend.prototype.renderInteractivePointer = function (legend, fill, stroke, id, strokeWidth, rect) {\n        var path;\n        var locX;\n        var locY;\n        var height = 10;\n        var width = 10;\n        var direction = (legend.orientation === 'None') ? (legend.position === 'Top' || legend.position === 'Bottom')\n            ? 'Horizontal' : 'Vertical' : legend.orientation;\n        if (direction === 'Horizontal') {\n            if (!legend.invertedPointer) {\n                locX = rect.x + (rect.width / 2);\n                locY = rect.y;\n                path = ' M ' + locX + ' ' + locY + ' L ' + (locX - width) + ' ' + (locY - height) +\n                    ' L ' + (locX + width) + ' ' + (locY - height) + ' Z ';\n            }\n            else {\n                locX = rect.x + (rect.width / 2);\n                locY = rect.y + (rect.height);\n                path = ' M ' + locX + ' ' + locY + ' L ' + (locX - width) + ' ' + (locY + height) +\n                    ' L ' + (locX + width) + ' ' + (locY + height) + ' Z ';\n            }\n        }\n        else {\n            if (!legend.invertedPointer) {\n                locX = rect.x + (rect.width);\n                locY = rect.y + (rect.height / 2);\n                path = ' M ' + locX + ' ' + locY + ' L ' + (locX + width) + ' ' + (locY - height) +\n                    ' L ' + (locX + width) + ' ' + (locY + height) + ' z ';\n            }\n            else {\n                locX = rect.x;\n                locY = rect.y + (rect.height / 2);\n                path = ' M ' + locX + ' ' + locY + ' L ' + (locX - width) + ' ' + (locY - height) +\n                    ' L ' + (locX - width) + ' ' + (locY + height) + ' z ';\n            }\n        }\n        var pathOptions = new PathOption(id, fill, strokeWidth, stroke, 1, 1, '', path);\n        this.maps.svgObject.appendChild(this.maps.renderer.drawPath(pathOptions));\n    };\n    Legend.prototype.wireEvents = function (element) {\n        EventHandler.add(element, Browser.touchStartEvent, this.changeNextPage, this);\n    };\n    Legend.prototype.addEventListener = function () {\n        if (this.maps.isDestroyed) {\n            return;\n        }\n        this.maps.on(Browser.touchMoveEvent, this.interactiveHandler, this);\n        this.maps.on(Browser.touchEndEvent, this.interactiveHandler, this);\n        this.maps.on(click, this.legendClick, this);\n    };\n    Legend.prototype.markerToggleSelection = function (mapElement, layerIndex, markerIndex, legendIndex) {\n        mapElement.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n        mapElement.setAttribute('stroke', this.maps.layers[layerIndex].markerSettings[markerIndex].border.color);\n        mapElement.setAttribute('fill-opacity', (this.maps.layers[layerIndex].markerSettings[markerIndex].opacity).toString());\n        mapElement.setAttribute('stroke-width', (this.maps.layers[layerIndex].markerSettings[markerIndex].border.width).toString());\n        mapElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[layerIndex].markerSettings[markerIndex].border.opacity) ?\n            this.maps.layers[layerIndex].markerSettings[markerIndex].opacity :\n            this.maps.layers[layerIndex].markerSettings[markerIndex].border.opacity).toString());\n    };\n    Legend.prototype.bubbleToggleSelection = function (mapElement, layerIndex, bubbleIndex, legendIndex) {\n        mapElement.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n        mapElement.setAttribute('stroke', this.maps.layers[layerIndex].bubbleSettings[bubbleIndex].border.color);\n        mapElement.setAttribute('fill-opacity', (this.maps.layers[layerIndex].bubbleSettings[bubbleIndex].opacity).toString());\n        mapElement.setAttribute('stroke-width', (this.maps.layers[layerIndex].bubbleSettings[bubbleIndex].border.width).toString());\n        mapElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[layerIndex].bubbleSettings[bubbleIndex].border.opacity) ?\n            this.maps.layers[layerIndex].bubbleSettings[bubbleIndex].opacity :\n            this.maps.layers[layerIndex].bubbleSettings[bubbleIndex].border.opacity).toString());\n    };\n    Legend.prototype.legendClick = function (targetEle) {\n        var legendShapeId;\n        var legendTextId;\n        var legendTextColor;\n        var legendToggleFill = this.maps.legendSettings.toggleLegendSettings.fill;\n        var legendToggleOpacity = this.maps.legendSettings.toggleLegendSettings.opacity;\n        var legendToggleBorderColor = this.maps.legendSettings.toggleLegendSettings.border.color;\n        var legendToggleBorderWidth = this.maps.legendSettings.toggleLegendSettings.border.width;\n        var legendToggleBorderOpacity = isNullOrUndefined(this.maps.legendSettings.toggleLegendSettings.border.opacity) ?\n            this.maps.legendSettings.toggleLegendSettings.opacity : this.maps.legendSettings.toggleLegendSettings.border.opacity;\n        if (targetEle.parentNode['id'].indexOf(this.maps.element.id + '_Legend_Index_') > -1) {\n            var mapElement = void 0;\n            var legendIndex = parseFloat(targetEle.parentElement.id.substr((this.maps.element.id + '_Legend_Index_').length));\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var selectedItem = this.legendCollection[legendIndex]['data'];\n            var isVisible = selectedItem['_isVisible'];\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var shape = void 0;\n            if (this.maps.legendSettings.toggleLegendSettings.enable && (this.maps.legendSettings.type === 'Bubbles' || this.maps.legendSettings.type === 'Markers')) {\n                for (var k = 0; k < this.maps.layers.length; k++) {\n                    for (var j = 0; j < (this.maps.legendSettings.type === 'Bubbles' ? this.maps.layers[k].bubbleSettings.length : this.maps.layers[k].markerSettings.length); j++) {\n                        for (var i = 0; i < selectedItem.length; i++) {\n                            shape = this.legendCollection[legendIndex]['data'][i];\n                            mapElement = this.maps.legendSettings.type === 'Bubbles' ? querySelector(this.maps.element.id + '_LayerIndex_' + shape['layerIndex'] +\n                                '_BubbleIndex_' + j + '_dataIndex_' + shape['dataIndex'], this.maps.element.id) : querySelector(this.maps.element.id + '_LayerIndex_' + shape['layerIndex'] +\n                                '_MarkerIndex_' + shape['markerIndex'] + '_dataIndex_' + shape['dataIndex'], this.maps.element.id);\n                            if (!isNullOrUndefined(shape['shape']) && shape['shape'] === 'Balloon') {\n                                mapElement = mapElement.children[0];\n                            }\n                            if (isVisible && mapElement !== null) {\n                                if (this.maps.legendSettings.toggleLegendSettings.applyShapeSettings) {\n                                    mapElement.setAttribute('fill', this.maps.layers[k].shapeSettings.fill);\n                                    mapElement.setAttribute('stroke', this.maps.layers[k].shapeSettings.border.color);\n                                    mapElement.setAttribute('fill-opacity', (this.maps.layers[k].shapeSettings.opacity).toString());\n                                    mapElement.setAttribute('stroke-width', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.width) ? 0 : this.maps.layers[k].shapeSettings.border.width).toString());\n                                    mapElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.opacity) ?\n                                        this.maps.layers[k].shapeSettings.opacity :\n                                        this.maps.layers[k].shapeSettings.border.opacity).toString());\n                                }\n                                else {\n                                    mapElement.setAttribute('fill', legendToggleFill);\n                                    mapElement.setAttribute('fill-opacity', (legendToggleOpacity).toString());\n                                    mapElement.setAttribute('stroke', legendToggleBorderColor);\n                                    mapElement.setAttribute('stroke-width', (legendToggleBorderWidth).toString());\n                                    mapElement.setAttribute('stroke-opacity', (legendToggleBorderOpacity).toString());\n                                }\n                                if (targetEle !== null) {\n                                    legendShapeId = querySelector(this.maps.element.id + '_Legend_Shape_Index_' + legendIndex, this.maps.element.id);\n                                    legendShapeId.setAttribute('fill', '#E5E5E5');\n                                    if (this.maps.legendSettings.shape === 'HorizontalLine' || this.maps.legendSettings.shape === 'VerticalLine' || this.maps.legendSettings.shape === 'Cross') {\n                                        legendShapeId.setAttribute('stroke', '#E5E5E5');\n                                    }\n                                    legendTextId = querySelector(this.maps.element.id + '_Legend_Text_Index_' + legendIndex, this.maps.element.id);\n                                    legendTextId.setAttribute('fill', '#E5E5E5');\n                                }\n                            }\n                            else {\n                                if (this.maps.legendSettings.type === 'Markers') {\n                                    this.markerToggleSelection(mapElement, k, j, legendIndex);\n                                }\n                                else {\n                                    this.bubbleToggleSelection(mapElement, k, j, legendIndex);\n                                }\n                                if (targetEle !== null) {\n                                    legendShapeId = querySelector(this.maps.element.id + '_Legend_Shape_Index_' + legendIndex, this.maps.element.id);\n                                    legendShapeId.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n                                    if (this.maps.legendSettings.shape === 'HorizontalLine' || this.maps.legendSettings.shape === 'VerticalLine' || this.maps.legendSettings.shape === 'Cross') {\n                                        legendShapeId.setAttribute('stroke', this.legendCollection[legendIndex]['fill']);\n                                    }\n                                    legendTextId = querySelector(this.maps.element.id + '_Legend_Text_Index_' + legendIndex, this.maps.element.id);\n                                    legendTextId.setAttribute('fill', '#757575');\n                                }\n                            }\n                        }\n                        selectedItem['_isVisible'] = isVisible ? false : true;\n                    }\n                }\n            }\n            if (this.maps.legendSettings.type === 'Layers' && this.maps.legendSettings.toggleLegendSettings.enable) {\n                var layerElement = void 0;\n                this.removeCollections(targetEle, legendIndex);\n                var toggledLegendIdIndex = this.maps.toggledLegendId.indexOf(legendIndex);\n                if (toggledLegendIdIndex !== -1) {\n                    isVisible = false;\n                }\n                for (var j = 0; j < this.maps.layers.length; j++) {\n                    for (var i = 0; i < selectedItem.length; i++) {\n                        shape = this.legendCollection[legendIndex]['data'][i];\n                        layerElement = querySelector(this.maps.element.id + '_LayerIndex_' + shape['layerIndex'] +\n                            '_shapeIndex_' + shape['shapeIndex'] + '_dataIndex_' + shape['dataIndex'], this.maps.element.id);\n                        if (layerElement !== null) {\n                            var toggledShapeIdIndex = this.maps.toggledShapeElementId.indexOf(layerElement.id);\n                            if (isVisible) {\n                                if (i === 0) {\n                                    this.maps.toggledLegendId.push(legendIndex);\n                                }\n                                if (toggledShapeIdIndex === -1) {\n                                    this.maps.toggledShapeElementId.push(layerElement.id);\n                                }\n                                if (this.maps.legendSettings.toggleLegendSettings.applyShapeSettings) {\n                                    layerElement.setAttribute('fill', this.maps.layers[j].shapeSettings.fill);\n                                    layerElement.setAttribute('fill-opacity', (this.maps.layers[j].shapeSettings.opacity).toString());\n                                    layerElement.setAttribute('stroke', this.maps.layers[j].shapeSettings.border.color);\n                                    layerElement.setAttribute('stroke-width', (isNullOrUndefined(this.maps.layers[j].shapeSettings.border.width) ? 0 : this.maps.layers[j].shapeSettings.border.width).toString());\n                                    layerElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[j].shapeSettings.border.opacity) ?\n                                        this.maps.layers[j].shapeSettings.opacity :\n                                        this.maps.layers[j].shapeSettings.border.opacity).toString());\n                                }\n                                else {\n                                    layerElement.setAttribute('fill', legendToggleFill);\n                                    layerElement.setAttribute('fill-opacity', (legendToggleOpacity).toString());\n                                    layerElement.setAttribute('stroke', legendToggleBorderColor);\n                                    layerElement.setAttribute('stroke-width', (legendToggleBorderWidth).toString());\n                                    layerElement.setAttribute('stroke-opacity', (legendToggleBorderOpacity).toString());\n                                }\n                                if (targetEle !== null) {\n                                    legendTextId = querySelector(this.maps.element.id + '_Legend_Text_Index_' + legendIndex, this.maps.element.id);\n                                    legendTextId.setAttribute('fill', '#E5E5E5');\n                                    legendShapeId = querySelector(this.maps.element.id + '_Legend_Shape_Index_' + legendIndex, this.maps.element.id);\n                                    legendShapeId.setAttribute('fill', '#E5E5E5');\n                                }\n                            }\n                            else {\n                                if (toggledLegendIdIndex !== -1 && i === 0) {\n                                    this.maps.toggledLegendId.splice(toggledLegendIdIndex, 1);\n                                }\n                                if (toggledShapeIdIndex !== -1) {\n                                    this.maps.toggledShapeElementId.splice(toggledShapeIdIndex, 1);\n                                }\n                                layerElement.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n                                layerElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[j].shapeSettings.border.opacity) ?\n                                    this.maps.layers[j].shapeSettings.opacity :\n                                    this.maps.layers[j].shapeSettings.border.opacity).toString());\n                                layerElement.setAttribute('stroke-width', (isNullOrUndefined(this.maps.layers[j].shapeSettings.border.width) ? 0 : this.maps.layers[j].shapeSettings.border.width).toString());\n                                layerElement.setAttribute('fill-opacity', (this.maps.layers[j].shapeSettings.opacity).toString());\n                                layerElement.setAttribute('stroke', this.maps.layers[j].shapeSettings.border.color);\n                                if (targetEle !== null) {\n                                    legendTextId = querySelector(this.maps.element.id + '_Legend_Text_Index_' + legendIndex, this.maps.element.id);\n                                    legendTextId.setAttribute('fill', '#757575');\n                                    legendShapeId = querySelector(this.maps.element.id + '_Legend_Shape_Index_' + legendIndex, this.maps.element.id);\n                                    legendShapeId.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n                                }\n                            }\n                        }\n                    }\n                }\n                selectedItem['_isVisible'] = isVisible ? false : true;\n            }\n        }\n        else if (!isNullOrUndefined(targetEle.id) && (targetEle.id.indexOf(this.maps.element.id + '_Legend_Shape_Index') > -1 ||\n            targetEle.id.indexOf(this.maps.element.id + '_Legend_Index') !== -1) && this.maps.legendSettings.visible &&\n            targetEle.id.indexOf('_Text') === -1) {\n            var LegendInteractive = void 0;\n            var legendIndex = parseFloat(targetEle.id.split(this.maps.element.id + '_Legend_Index_')[1]);\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var mapdata = void 0;\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            var selectedItem = this.legendCollection[legendIndex]['data'];\n            var isVisible = selectedItem['_isVisible'];\n            if ((this.maps.legendSettings.type === 'Bubbles' || this.maps.legendSettings.type === 'Markers') && this.maps.legendSettings.toggleLegendSettings.enable) {\n                for (var k = 0; k < this.maps.layers.length; k++) {\n                    for (var j = 0; j < (this.maps.legendSettings.type === 'Bubbles' ? this.maps.layers[k].bubbleSettings.length : this.maps.layers[k].markerSettings.length); j++) {\n                        for (var i = 0; i < selectedItem.length; i++) {\n                            mapdata = this.legendCollection[legendIndex]['data'][i];\n                            LegendInteractive = this.maps.legendSettings.type === 'Bubbles' ? querySelector(this.maps.element.id + '_LayerIndex_' + mapdata['layerIndex'] +\n                                '_BubbleIndex_' + j + '_dataIndex_' + mapdata['dataIndex'], this.maps.element.id) : querySelector(this.maps.element.id + '_LayerIndex_' + mapdata['layerIndex'] +\n                                '_MarkerIndex_' + j + '_dataIndex_' + mapdata['dataIndex'], this.maps.element.id);\n                            if (!isNullOrUndefined(mapdata['shape']) && mapdata['shape'] === 'Balloon') {\n                                LegendInteractive = LegendInteractive.children[0];\n                            }\n                            if (isVisible && LegendInteractive !== null) {\n                                if (this.maps.legendSettings.toggleLegendSettings.applyShapeSettings) {\n                                    LegendInteractive.setAttribute('fill', this.maps.layers[k].shapeSettings.fill);\n                                    LegendInteractive.setAttribute('stroke', this.maps.layers[k].shapeSettings.border.color);\n                                    LegendInteractive.setAttribute('stroke-width', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.width) ? 0 : this.maps.layers[k].shapeSettings.border.width).toString());\n                                    LegendInteractive.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.opacity) ?\n                                        this.maps.layers[k].shapeSettings.opacity :\n                                        this.maps.layers[k].shapeSettings.border.opacity).toString());\n                                    LegendInteractive.setAttribute('fill-opacity', (this.maps.layers[k].shapeSettings.opacity).toString());\n                                }\n                                else {\n                                    LegendInteractive.setAttribute('fill', legendToggleFill);\n                                    LegendInteractive.setAttribute('fill-opacity', (legendToggleOpacity).toString());\n                                    LegendInteractive.setAttribute('stroke', legendToggleBorderColor);\n                                    LegendInteractive.setAttribute('stroke-width', (legendToggleBorderWidth).toString());\n                                    LegendInteractive.setAttribute('stroke-opacity', (legendToggleBorderOpacity).toString());\n                                }\n                                if (targetEle !== null) {\n                                    legendTextId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex + '_Text', this.maps.element.id);\n                                    legendTextId.setAttribute('fill', '#E5E5E5');\n                                    legendShapeId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex, this.maps.element.id);\n                                    legendShapeId.setAttribute('fill', '#E5E5E5');\n                                }\n                            }\n                            else {\n                                if (this.maps.legendSettings.type === 'Markers') {\n                                    this.markerToggleSelection(LegendInteractive, k, j, legendIndex);\n                                }\n                                else {\n                                    this.bubbleToggleSelection(LegendInteractive, k, j, legendIndex);\n                                }\n                                if (targetEle !== null) {\n                                    legendShapeId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex, this.maps.element.id);\n                                    legendShapeId.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n                                    legendTextId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex + '_Text', this.maps.element.id);\n                                    legendTextId.setAttribute('fill', '#757575');\n                                }\n                            }\n                        }\n                        selectedItem['_isVisible'] = isVisible ? false : true;\n                    }\n                }\n            }\n            if (this.maps.legendSettings.type === 'Layers' && this.maps.legendSettings.toggleLegendSettings.enable) {\n                var mapLegendElement = void 0;\n                this.removeCollections(targetEle, legendIndex);\n                var toggleLegendIdIndex = this.maps.toggledLegendId.indexOf(legendIndex);\n                if (toggleLegendIdIndex !== -1) {\n                    isVisible = false;\n                }\n                for (var k = 0; k < this.maps.layers.length; k++) {\n                    for (var i = 0; i < selectedItem.length; i++) {\n                        mapdata = this.legendCollection[legendIndex]['data'][i];\n                        mapLegendElement = querySelector(this.maps.element.id + '_LayerIndex_' + mapdata['layerIndex'] +\n                            '_shapeIndex_' + mapdata['shapeIndex'] + '_dataIndex_' + mapdata['dataIndex'], this.maps.element.id);\n                        if (mapLegendElement !== null) {\n                            var toggledShapeIdIndex = this.maps.toggledShapeElementId.indexOf(mapLegendElement.id);\n                            if (isVisible) {\n                                if (i === 0) {\n                                    this.maps.toggledLegendId.push(legendIndex);\n                                }\n                                if (toggledShapeIdIndex === -1) {\n                                    this.maps.toggledShapeElementId.push(mapLegendElement.id);\n                                }\n                                if (this.maps.legendSettings.toggleLegendSettings.applyShapeSettings) {\n                                    mapLegendElement.setAttribute('fill', this.maps.layers[0].shapeSettings.fill);\n                                    mapLegendElement.setAttribute('stroke', this.maps.layers[0].shapeSettings.border.color);\n                                    mapLegendElement.setAttribute('fill-opacity', (this.maps.layers[k].shapeSettings.opacity).toString());\n                                    mapLegendElement.setAttribute('stroke-width', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.width) ? 0 : this.maps.layers[k].shapeSettings.border.width).toString());\n                                    mapLegendElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.opacity) ?\n                                        this.maps.layers[k].shapeSettings.opacity :\n                                        this.maps.layers[k].shapeSettings.border.opacity).toString());\n                                }\n                                else {\n                                    mapLegendElement.setAttribute('fill', legendToggleFill);\n                                    mapLegendElement.setAttribute('fill-opacity', (legendToggleOpacity).toString());\n                                    mapLegendElement.setAttribute('stroke', legendToggleBorderColor);\n                                    mapLegendElement.setAttribute('stroke-width', (legendToggleBorderWidth).toString());\n                                    mapLegendElement.setAttribute('stroke-opacity', (legendToggleBorderOpacity).toString());\n                                }\n                                if (targetEle !== null) {\n                                    legendShapeId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex, this.maps.element.id);\n                                    legendShapeId.setAttribute('fill', '#E5E5E5');\n                                    legendTextId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex + '_Text', this.maps.element.id);\n                                    legendTextId.setAttribute('fill', '#E5E5E5');\n                                }\n                            }\n                            else {\n                                if (toggleLegendIdIndex !== -1 && i === 0) {\n                                    this.maps.toggledLegendId.splice(toggleLegendIdIndex, 1);\n                                }\n                                if (toggledShapeIdIndex !== -1) {\n                                    this.maps.toggledShapeElementId.splice(toggledShapeIdIndex, 1);\n                                }\n                                mapLegendElement.setAttribute('fill-opacity', (this.maps.layers[k].shapeSettings.opacity).toString());\n                                mapLegendElement.setAttribute('stroke-width', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.width) ? 0 : this.maps.layers[k].shapeSettings.border.width).toString());\n                                mapLegendElement.setAttribute('stroke', this.maps.layers[0].shapeSettings.border.color);\n                                mapLegendElement.setAttribute('stroke-opacity', (isNullOrUndefined(this.maps.layers[k].shapeSettings.border.opacity) ?\n                                    this.maps.layers[k].shapeSettings.opacity : this.maps.layers[k].shapeSettings.border.opacity).toString());\n                                mapLegendElement.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n                                if (targetEle !== null) {\n                                    legendTextId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex + '_Text', this.maps.element.id);\n                                    legendTextId.setAttribute('fill', '#757575');\n                                    legendShapeId = querySelector(this.maps.element.id + '_Legend_Index_' + legendIndex, this.maps.element.id);\n                                    legendShapeId.setAttribute('fill', this.legendCollection[legendIndex]['fill']);\n                                }\n                            }\n                        }\n                    }\n                }\n                selectedItem['_isVisible'] = isVisible ? false : true;\n            }\n        }\n    };\n    Legend.prototype.removeCollections = function (targetEle, legendIndex) {\n        this.removeLegendSelectionCollection(targetEle);\n        var legendSelectionIndex = this.getIndexofLegend(this.maps.legendSelectionCollection, targetEle);\n        if (legendSelectionIndex !== -1) {\n            this.maps.legendSelectionCollection.splice(legendSelectionIndex, 1);\n        }\n        var legendHighlightIndex = this.getIndexofLegend(this.legendHighlightCollection, targetEle);\n        if (legendHighlightIndex !== -1) {\n            this.legendHighlightCollection.splice(legendSelectionIndex, 1);\n        }\n        var shapeHighlightIndex = this.getIndexofLegend(this.shapeHighlightCollection, targetEle);\n        if (shapeHighlightIndex !== -1) {\n            this.shapeHighlightCollection.splice(shapeHighlightIndex, 1);\n        }\n        var selectedIndex = this.maps.selectedLegendElementId.indexOf(legendIndex);\n        if (selectedIndex !== -1) {\n            this.maps.selectedLegendElementId.splice(selectedIndex, 1);\n        }\n    };\n    Legend.prototype.removeEventListener = function () {\n        if (this.maps.isDestroyed) {\n            return;\n        }\n        this.maps.off(Browser.touchMoveEvent, this.interactiveHandler);\n        this.maps.off(Browser.touchEndEvent, this.interactiveHandler);\n        this.maps.off(click, this.legendClick);\n    };\n    Legend.prototype.getLegendData = function (\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    layerIndex, dataIndex, data, dataPath, \n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    layerData, shapePropertyPath, value\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    ) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        var legendData = [];\n        if (Object.prototype.toString.call(layerData) === '[object Array]') {\n            for (var i = 0; i < layerData.length; i++) {\n                // eslint-disable-next-line @typescript-eslint/no-explicit-any\n                var shapeData = layerData[i];\n                var dataPathValue = (dataPath.indexOf('.') > -1) ? getValueFromObject(data, dataPath) : data[dataPath];\n                var shapePath = checkPropertyPath(data[dataPath], shapePropertyPath, shapeData['properties']);\n                var dataPathValueCase = !isNullOrUndefined(dataPathValue)\n                    ? dataPathValue.toLowerCase() : dataPathValue;\n                var shapeDataValueCase = !isNullOrUndefined(shapeData['properties'][shapePath])\n                    && isNaN(shapeData['properties'][shapePath]) ? shapeData['properties'][shapePath].toLowerCase() : shapeData['properties'][shapePath];\n                if (shapeDataValueCase === dataPathValueCase) {\n                    legendData.push({\n                        layerIndex: layerIndex, shapeIndex: i, dataIndex: dataIndex,\n                        name: data[dataPath], value: value\n                    });\n                }\n            }\n        }\n        return legendData;\n    };\n    Legend.prototype.legendGradientColor = function (colorMap, legendIndex) {\n        var legendFillColor;\n        var xmlns = 'http://www.w3.org/2000/svg';\n        if (!isNullOrUndefined(colorMap.color) && typeof (colorMap.color) === 'object') {\n            var linerGradientEle = document.createElementNS(xmlns, 'linearGradient');\n            var opacity = 1;\n            var position = this.maps.legendSettings.position;\n            var x2 = position === 'Top' || position === 'Bottom' ? '100' : '0';\n            var y2 = position === 'Top' || position === 'Bottom' ? '0' : '100';\n            linerGradientEle.setAttribute('id', 'linear_' + legendIndex + '_' + this.maps.element.id);\n            linerGradientEle.setAttribute('x1', 0 + '%');\n            linerGradientEle.setAttribute('y1', 0 + '%');\n            linerGradientEle.setAttribute('x2', x2 + '%');\n            linerGradientEle.setAttribute('y2', y2 + '%');\n            for (var b = 0; b < colorMap.color.length; b++) {\n                var offsetColor = 100 / (colorMap.color.length - 1);\n                var stopEle = document.createElementNS(xmlns, 'stop');\n                stopEle.setAttribute('offset', b * offsetColor + '%');\n                stopEle.setAttribute('stop-color', colorMap.color[b]);\n                stopEle.setAttribute('stop-opacity', opacity.toString());\n                linerGradientEle.appendChild(stopEle);\n            }\n            this.legendLinearGradient = linerGradientEle;\n            var color = 'url(' + '#linear_' + legendIndex + '_' + this.maps.element.id + ')';\n            this.defsElement.appendChild(linerGradientEle);\n            legendFillColor = color;\n        }\n        return legendFillColor;\n    };\n    /**\n     * Get module name.\n     *\n     * @returns {string} - Returns the module name\n     */\n    Legend.prototype.getModuleName = function () {\n        return 'Legend';\n    };\n    /**\n     * To destroy the legend.\n     *\n     * @param {Maps} maps - Specifies the instance of the maps\n     * @returns {void}\n     * @private\n     */\n    Legend.prototype.destroy = function (maps) {\n        /**\n         * Destroy method performed here\n         */\n        this.removeEventListener();\n    };\n    return Legend;\n}());\nexport { Legend };\n"]},"metadata":{},"sourceType":"module"}